(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["main"],{

/***/ "./config.json":
/*!*********************!*\
  !*** ./config.json ***!
  \*********************/
/*! exports provided: APP, HOME, LANGUAGES, MAP, THEME, OPTIONS, default */
/***/ (function(module) {

module.exports = {"APP":{"name":"Merlot Reiser","id":"it.webmapp.merlot","customerName":"Merlot Reiser"},"HOME":[{"view":"expanded","title":"Self Guided Experience","subtitle":"Relax and enjoy your ride with our itineraries","taxonomy":"activity","types":["route"]}],"LANGUAGES":{"default":"en","available":[]},"MAP":{"maxZoom":17,"minZoom":6,"defZoom":9,"center":[10,44],"bbox":[9.45,41.71,13.11,45.16],"layers":[{"label":"Mappa","type":"maptile","tilesUrl":"https://api.webmapp.it/tiles/","default":false,"maxNativeZoom":17}]},"THEME":{"primary":"#6ca858"},"OPTIONS":{"baseUrl":"https://k.webmapp.it/merlot/","startUrl":"/main/explore","hideGlobalMap":true,"beBaseUrl":"http://merlot.be.webmapp.it/","addArrowsOverTracks":true}};

/***/ }),

/***/ "./node_modules/@ionic/core/dist/esm/es5/build lazy recursive ^\\.\\/.*\\.entry\\.js$ include: \\.entry\\.js$":
/*!*********************************************************************************************************************!*\
  !*** ./node_modules/@ionic/core/dist/esm/es5/build lazy ^\.\/.*\.entry\.js$ include: \.entry\.js$ namespace object ***!
  \*********************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var map = {
	"./1fcq78hk.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/1fcq78hk.entry.js",
		"common",
		102
	],
	"./1fcq78hk.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/1fcq78hk.sc.entry.js",
		"common",
		103
	],
	"./2i50w2lv.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/2i50w2lv.entry.js",
		"common",
		104
	],
	"./2i50w2lv.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/2i50w2lv.sc.entry.js",
		"common",
		105
	],
	"./39fhulxe.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/39fhulxe.entry.js",
		"common",
		106
	],
	"./39fhulxe.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/39fhulxe.sc.entry.js",
		"common",
		107
	],
	"./3hbcnxuc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/3hbcnxuc.entry.js",
		"common",
		54
	],
	"./3hbcnxuc.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/3hbcnxuc.sc.entry.js",
		"common",
		55
	],
	"./3kzauze7.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/3kzauze7.entry.js",
		"common",
		56
	],
	"./3kzauze7.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/3kzauze7.sc.entry.js",
		"common",
		57
	],
	"./3pkkvczk.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/3pkkvczk.entry.js",
		0,
		"common",
		128
	],
	"./3pkkvczk.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/3pkkvczk.sc.entry.js",
		0,
		"common",
		129
	],
	"./5zcdwzsx.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/5zcdwzsx.entry.js",
		"common",
		10
	],
	"./5zcdwzsx.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/5zcdwzsx.sc.entry.js",
		"common",
		11
	],
	"./6kgso7pq.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/6kgso7pq.entry.js",
		"common",
		12
	],
	"./6kgso7pq.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/6kgso7pq.sc.entry.js",
		"common",
		13
	],
	"./7hlpr3fd.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/7hlpr3fd.entry.js",
		0,
		"common",
		130
	],
	"./7hlpr3fd.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/7hlpr3fd.sc.entry.js",
		0,
		"common",
		131
	],
	"./8wdovu8e.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/8wdovu8e.entry.js",
		"common",
		58
	],
	"./8wdovu8e.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/8wdovu8e.sc.entry.js",
		"common",
		59
	],
	"./admmxern.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/admmxern.entry.js",
		"common",
		60
	],
	"./admmxern.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/admmxern.sc.entry.js",
		"common",
		61
	],
	"./aubabxbm.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/aubabxbm.entry.js",
		"common",
		14
	],
	"./aubabxbm.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/aubabxbm.sc.entry.js",
		"common",
		15
	],
	"./azzrjyyu.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/azzrjyyu.entry.js",
		0,
		"common",
		132
	],
	"./azzrjyyu.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/azzrjyyu.sc.entry.js",
		0,
		"common",
		133
	],
	"./b65tzyas.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/b65tzyas.entry.js",
		"common",
		16
	],
	"./b65tzyas.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/b65tzyas.sc.entry.js",
		"common",
		17
	],
	"./bb7q7tld.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/bb7q7tld.entry.js",
		"common",
		108
	],
	"./bb7q7tld.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/bb7q7tld.sc.entry.js",
		"common",
		109
	],
	"./bcmaaa8l.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/bcmaaa8l.entry.js",
		"common",
		62
	],
	"./bcmaaa8l.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/bcmaaa8l.sc.entry.js",
		"common",
		63
	],
	"./bygik61u.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/bygik61u.entry.js",
		"common",
		64
	],
	"./bygik61u.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/bygik61u.sc.entry.js",
		"common",
		65
	],
	"./ddlg9urb.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ddlg9urb.entry.js",
		"common",
		18
	],
	"./ddlg9urb.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ddlg9urb.sc.entry.js",
		"common",
		19
	],
	"./devt5yhg.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/devt5yhg.entry.js",
		0,
		"common",
		136
	],
	"./devt5yhg.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/devt5yhg.sc.entry.js",
		0,
		"common",
		137
	],
	"./dhprnqol.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/dhprnqol.entry.js",
		2,
		"common",
		138
	],
	"./dhprnqol.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/dhprnqol.sc.entry.js",
		2,
		"common",
		139
	],
	"./djkq5plb.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/djkq5plb.entry.js",
		"common",
		66
	],
	"./djkq5plb.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/djkq5plb.sc.entry.js",
		"common",
		67
	],
	"./efdsz9yy.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/efdsz9yy.entry.js",
		"common",
		94
	],
	"./efdsz9yy.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/efdsz9yy.sc.entry.js",
		"common",
		95
	],
	"./eghwkqif.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/eghwkqif.entry.js",
		"common",
		20
	],
	"./eghwkqif.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/eghwkqif.sc.entry.js",
		"common",
		21
	],
	"./ek05jvfc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ek05jvfc.entry.js",
		"common",
		22
	],
	"./ek05jvfc.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ek05jvfc.sc.entry.js",
		"common",
		23
	],
	"./ficmbhoi.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ficmbhoi.entry.js",
		2,
		"common",
		140
	],
	"./ficmbhoi.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ficmbhoi.sc.entry.js",
		2,
		"common",
		141
	],
	"./fkzdmlip.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/fkzdmlip.entry.js",
		142
	],
	"./fkzdmlip.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/fkzdmlip.sc.entry.js",
		143
	],
	"./fmzmhk3d.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/fmzmhk3d.entry.js",
		"common",
		68
	],
	"./fmzmhk3d.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/fmzmhk3d.sc.entry.js",
		"common",
		69
	],
	"./fz2rcnow.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/fz2rcnow.entry.js",
		"common",
		70
	],
	"./fz2rcnow.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/fz2rcnow.sc.entry.js",
		"common",
		71
	],
	"./gnkkjvvk.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/gnkkjvvk.entry.js",
		"common",
		72
	],
	"./gnkkjvvk.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/gnkkjvvk.sc.entry.js",
		"common",
		73
	],
	"./helxzsef.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/helxzsef.entry.js",
		144
	],
	"./helxzsef.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/helxzsef.sc.entry.js",
		145
	],
	"./i5bu78vq.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/i5bu78vq.entry.js",
		"common",
		74
	],
	"./i5bu78vq.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/i5bu78vq.sc.entry.js",
		"common",
		75
	],
	"./imcdx1xe.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/imcdx1xe.entry.js",
		"common",
		114
	],
	"./imcdx1xe.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/imcdx1xe.sc.entry.js",
		"common",
		115
	],
	"./iqlhkurd.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/iqlhkurd.entry.js",
		"common",
		76
	],
	"./iqlhkurd.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/iqlhkurd.sc.entry.js",
		"common",
		77
	],
	"./isuxxasv.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/isuxxasv.entry.js",
		"common",
		78
	],
	"./isuxxasv.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/isuxxasv.sc.entry.js",
		"common",
		79
	],
	"./iwgahuhw.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/iwgahuhw.entry.js",
		"common",
		24
	],
	"./iwgahuhw.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/iwgahuhw.sc.entry.js",
		"common",
		25
	],
	"./j20d1ikn.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/j20d1ikn.entry.js",
		"common",
		80
	],
	"./j20d1ikn.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/j20d1ikn.sc.entry.js",
		"common",
		81
	],
	"./jzwyowjw.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/jzwyowjw.entry.js",
		"common",
		26
	],
	"./jzwyowjw.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/jzwyowjw.sc.entry.js",
		"common",
		27
	],
	"./k6eoch7h.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/k6eoch7h.entry.js",
		0,
		"common",
		146
	],
	"./k6eoch7h.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/k6eoch7h.sc.entry.js",
		0,
		"common",
		147
	],
	"./kgjnfunx.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/kgjnfunx.entry.js",
		"common",
		28
	],
	"./kgjnfunx.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/kgjnfunx.sc.entry.js",
		"common",
		29
	],
	"./lb8tayd0.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/lb8tayd0.entry.js",
		"common",
		116
	],
	"./lb8tayd0.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/lb8tayd0.sc.entry.js",
		"common",
		117
	],
	"./ldqvnzrr.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ldqvnzrr.entry.js",
		"common",
		30
	],
	"./ldqvnzrr.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ldqvnzrr.sc.entry.js",
		"common",
		31
	],
	"./llyqw4no.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/llyqw4no.entry.js",
		"common",
		82
	],
	"./llyqw4no.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/llyqw4no.sc.entry.js",
		"common",
		83
	],
	"./lsxwd44p.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/lsxwd44p.entry.js",
		"common",
		32
	],
	"./lsxwd44p.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/lsxwd44p.sc.entry.js",
		"common",
		33
	],
	"./mf2ayo12.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/mf2ayo12.entry.js",
		"common",
		34
	],
	"./mf2ayo12.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/mf2ayo12.sc.entry.js",
		"common",
		35
	],
	"./migtpkzd.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/migtpkzd.entry.js",
		"common",
		36
	],
	"./migtpkzd.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/migtpkzd.sc.entry.js",
		"common",
		37
	],
	"./mo7qeek2.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/mo7qeek2.entry.js",
		"common",
		118
	],
	"./mo7qeek2.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/mo7qeek2.sc.entry.js",
		"common",
		119
	],
	"./mri9bdlj.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/mri9bdlj.entry.js",
		148
	],
	"./mri9bdlj.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/mri9bdlj.sc.entry.js",
		149
	],
	"./mrs0ks1r.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/mrs0ks1r.entry.js",
		0,
		"common",
		150
	],
	"./mrs0ks1r.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/mrs0ks1r.sc.entry.js",
		0,
		"common",
		151
	],
	"./najnlwm4.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/najnlwm4.entry.js",
		"common",
		38
	],
	"./najnlwm4.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/najnlwm4.sc.entry.js",
		"common",
		39
	],
	"./narso64l.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/narso64l.entry.js",
		0,
		"common",
		110
	],
	"./narso64l.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/narso64l.sc.entry.js",
		0,
		"common",
		111
	],
	"./nqozldol.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/nqozldol.entry.js",
		0,
		"common",
		152
	],
	"./nqozldol.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/nqozldol.sc.entry.js",
		0,
		"common",
		153
	],
	"./o6zsuoqi.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/o6zsuoqi.entry.js",
		"common",
		84
	],
	"./o6zsuoqi.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/o6zsuoqi.sc.entry.js",
		"common",
		85
	],
	"./oc7j8k7y.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/oc7j8k7y.entry.js",
		"common",
		120
	],
	"./oc7j8k7y.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/oc7j8k7y.sc.entry.js",
		"common",
		121
	],
	"./ofd4s8dw.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ofd4s8dw.entry.js",
		"common",
		96
	],
	"./ofd4s8dw.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ofd4s8dw.sc.entry.js",
		"common",
		97
	],
	"./pd9wflli.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/pd9wflli.entry.js",
		"common",
		98
	],
	"./pd9wflli.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/pd9wflli.sc.entry.js",
		"common",
		99
	],
	"./pdzm9bfy.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/pdzm9bfy.entry.js",
		"common",
		100
	],
	"./pdzm9bfy.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/pdzm9bfy.sc.entry.js",
		"common",
		101
	],
	"./r8dtlwvb.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/r8dtlwvb.entry.js",
		0,
		"common",
		154
	],
	"./r8dtlwvb.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/r8dtlwvb.sc.entry.js",
		0,
		"common",
		155
	],
	"./rkecsmgc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/rkecsmgc.entry.js",
		"common",
		122
	],
	"./rkecsmgc.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/rkecsmgc.sc.entry.js",
		"common",
		123
	],
	"./rrpxfm2a.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/rrpxfm2a.entry.js",
		156
	],
	"./rrpxfm2a.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/rrpxfm2a.sc.entry.js",
		157
	],
	"./senscofp.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/senscofp.entry.js",
		"common",
		40
	],
	"./senscofp.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/senscofp.sc.entry.js",
		"common",
		41
	],
	"./tjefn81q.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/tjefn81q.entry.js",
		"common",
		42
	],
	"./tjefn81q.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/tjefn81q.sc.entry.js",
		"common",
		43
	],
	"./tlbladaf.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/tlbladaf.entry.js",
		"common",
		44
	],
	"./tlbladaf.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/tlbladaf.sc.entry.js",
		"common",
		45
	],
	"./tn7df4wj.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/tn7df4wj.entry.js",
		"common",
		124
	],
	"./tn7df4wj.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/tn7df4wj.sc.entry.js",
		"common",
		125
	],
	"./uhyavx6a.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/uhyavx6a.entry.js",
		0,
		"common",
		158
	],
	"./uhyavx6a.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/uhyavx6a.sc.entry.js",
		0,
		"common",
		159
	],
	"./vompwuhi.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/vompwuhi.entry.js",
		"common",
		46
	],
	"./vompwuhi.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/vompwuhi.sc.entry.js",
		"common",
		47
	],
	"./vypdotd0.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/vypdotd0.entry.js",
		"common",
		48
	],
	"./vypdotd0.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/vypdotd0.sc.entry.js",
		"common",
		49
	],
	"./wb4mk1b9.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/wb4mk1b9.entry.js",
		0,
		"common",
		160
	],
	"./wb4mk1b9.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/wb4mk1b9.sc.entry.js",
		0,
		"common",
		161
	],
	"./whjbxjrd.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/whjbxjrd.entry.js",
		0,
		"common",
		112
	],
	"./whjbxjrd.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/whjbxjrd.sc.entry.js",
		0,
		"common",
		113
	],
	"./wjdsdnuu.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/wjdsdnuu.entry.js",
		"common",
		86
	],
	"./wjdsdnuu.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/wjdsdnuu.sc.entry.js",
		"common",
		87
	],
	"./wrpzmdqx.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/wrpzmdqx.entry.js",
		"common",
		50
	],
	"./wrpzmdqx.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/wrpzmdqx.sc.entry.js",
		"common",
		51
	],
	"./wzw9zscm.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/wzw9zscm.entry.js",
		0,
		"common",
		162
	],
	"./wzw9zscm.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/wzw9zscm.sc.entry.js",
		0,
		"common",
		163
	],
	"./x5xnv4jv.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/x5xnv4jv.entry.js",
		0,
		"common",
		164
	],
	"./x5xnv4jv.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/x5xnv4jv.sc.entry.js",
		0,
		"common",
		165
	],
	"./xajhwvib.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/xajhwvib.entry.js",
		"common",
		88
	],
	"./xajhwvib.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/xajhwvib.sc.entry.js",
		"common",
		89
	],
	"./xo7dncgt.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/xo7dncgt.entry.js",
		"common",
		90
	],
	"./xo7dncgt.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/xo7dncgt.sc.entry.js",
		"common",
		91
	],
	"./yifvz1ud.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/yifvz1ud.entry.js",
		"common",
		92
	],
	"./yifvz1ud.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/yifvz1ud.sc.entry.js",
		"common",
		93
	],
	"./ymem7pf1.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ymem7pf1.entry.js",
		"common",
		52
	],
	"./ymem7pf1.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ymem7pf1.sc.entry.js",
		"common",
		53
	],
	"./ziv0mko0.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ziv0mko0.entry.js",
		"common",
		126
	],
	"./ziv0mko0.sc.entry.js": [
		"./node_modules/@ionic/core/dist/esm/es5/build/ziv0mko0.sc.entry.js",
		"common",
		127
	]
};
function webpackAsyncContext(req) {
	var ids = map[req];
	if(!ids) {
		return Promise.resolve().then(function() {
			var e = new Error("Cannot find module '" + req + "'");
			e.code = 'MODULE_NOT_FOUND';
			throw e;
		});
	}
	return Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {
		var id = ids[0];
		return __webpack_require__(id);
	});
}
webpackAsyncContext.keys = function webpackAsyncContextKeys() {
	return Object.keys(map);
};
webpackAsyncContext.id = "./node_modules/@ionic/core/dist/esm/es5/build lazy recursive ^\\.\\/.*\\.entry\\.js$ include: \\.entry\\.js$";
module.exports = webpackAsyncContext;

/***/ }),

/***/ "./node_modules/i18n-iso-countries/langs lazy recursive ^\\.\\/.*\\.json$":
/*!************************************************************************************!*\
  !*** ./node_modules/i18n-iso-countries/langs lazy ^\.\/.*\.json$ namespace object ***!
  \************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var map = {
	"./ar.json": [
		"./node_modules/i18n-iso-countries/langs/ar.json",
		173
	],
	"./az.json": [
		"./node_modules/i18n-iso-countries/langs/az.json",
		174
	],
	"./be.json": [
		"./node_modules/i18n-iso-countries/langs/be.json",
		175
	],
	"./bg.json": [
		"./node_modules/i18n-iso-countries/langs/bg.json",
		176
	],
	"./bs.json": [
		"./node_modules/i18n-iso-countries/langs/bs.json",
		177
	],
	"./ca.json": [
		"./node_modules/i18n-iso-countries/langs/ca.json",
		178
	],
	"./cs.json": [
		"./node_modules/i18n-iso-countries/langs/cs.json",
		179
	],
	"./da.json": [
		"./node_modules/i18n-iso-countries/langs/da.json",
		180
	],
	"./de.json": [
		"./node_modules/i18n-iso-countries/langs/de.json",
		181
	],
	"./el.json": [
		"./node_modules/i18n-iso-countries/langs/el.json",
		182
	],
	"./en.json": [
		"./node_modules/i18n-iso-countries/langs/en.json",
		183
	],
	"./es.json": [
		"./node_modules/i18n-iso-countries/langs/es.json",
		184
	],
	"./et.json": [
		"./node_modules/i18n-iso-countries/langs/et.json",
		185
	],
	"./fa.json": [
		"./node_modules/i18n-iso-countries/langs/fa.json",
		186
	],
	"./fi.json": [
		"./node_modules/i18n-iso-countries/langs/fi.json",
		187
	],
	"./fr.json": [
		"./node_modules/i18n-iso-countries/langs/fr.json",
		188
	],
	"./he.json": [
		"./node_modules/i18n-iso-countries/langs/he.json",
		189
	],
	"./hr.json": [
		"./node_modules/i18n-iso-countries/langs/hr.json",
		190
	],
	"./hu.json": [
		"./node_modules/i18n-iso-countries/langs/hu.json",
		191
	],
	"./hy.json": [
		"./node_modules/i18n-iso-countries/langs/hy.json",
		192
	],
	"./id.json": [
		"./node_modules/i18n-iso-countries/langs/id.json",
		193
	],
	"./it.json": [
		"./node_modules/i18n-iso-countries/langs/it.json",
		194
	],
	"./ja.json": [
		"./node_modules/i18n-iso-countries/langs/ja.json",
		195
	],
	"./ka.json": [
		"./node_modules/i18n-iso-countries/langs/ka.json",
		196
	],
	"./kk.json": [
		"./node_modules/i18n-iso-countries/langs/kk.json",
		197
	],
	"./ko.json": [
		"./node_modules/i18n-iso-countries/langs/ko.json",
		198
	],
	"./ky.json": [
		"./node_modules/i18n-iso-countries/langs/ky.json",
		199
	],
	"./lt.json": [
		"./node_modules/i18n-iso-countries/langs/lt.json",
		200
	],
	"./lv.json": [
		"./node_modules/i18n-iso-countries/langs/lv.json",
		201
	],
	"./mk.json": [
		"./node_modules/i18n-iso-countries/langs/mk.json",
		202
	],
	"./mn.json": [
		"./node_modules/i18n-iso-countries/langs/mn.json",
		203
	],
	"./nb.json": [
		"./node_modules/i18n-iso-countries/langs/nb.json",
		204
	],
	"./nl.json": [
		"./node_modules/i18n-iso-countries/langs/nl.json",
		205
	],
	"./nn.json": [
		"./node_modules/i18n-iso-countries/langs/nn.json",
		206
	],
	"./pl.json": [
		"./node_modules/i18n-iso-countries/langs/pl.json",
		207
	],
	"./pt.json": [
		"./node_modules/i18n-iso-countries/langs/pt.json",
		208
	],
	"./ro.json": [
		"./node_modules/i18n-iso-countries/langs/ro.json",
		209
	],
	"./ru.json": [
		"./node_modules/i18n-iso-countries/langs/ru.json",
		210
	],
	"./sk.json": [
		"./node_modules/i18n-iso-countries/langs/sk.json",
		211
	],
	"./sl.json": [
		"./node_modules/i18n-iso-countries/langs/sl.json",
		212
	],
	"./sr.json": [
		"./node_modules/i18n-iso-countries/langs/sr.json",
		213
	],
	"./sv.json": [
		"./node_modules/i18n-iso-countries/langs/sv.json",
		214
	],
	"./tr.json": [
		"./node_modules/i18n-iso-countries/langs/tr.json",
		215
	],
	"./uk.json": [
		"./node_modules/i18n-iso-countries/langs/uk.json",
		216
	],
	"./uz.json": [
		"./node_modules/i18n-iso-countries/langs/uz.json",
		217
	],
	"./zh.json": [
		"./node_modules/i18n-iso-countries/langs/zh.json",
		218
	]
};
function webpackAsyncContext(req) {
	var ids = map[req];
	if(!ids) {
		return Promise.resolve().then(function() {
			var e = new Error("Cannot find module '" + req + "'");
			e.code = 'MODULE_NOT_FOUND';
			throw e;
		});
	}
	return __webpack_require__.e(ids[1]).then(function() {
		var id = ids[0];
		return __webpack_require__.t(id, 3);
	});
}
webpackAsyncContext.keys = function webpackAsyncContextKeys() {
	return Object.keys(map);
};
webpackAsyncContext.id = "./node_modules/i18n-iso-countries/langs lazy recursive ^\\.\\/.*\\.json$";
module.exports = webpackAsyncContext;

/***/ }),

/***/ "./src/$$_lazy_route_resource lazy recursive":
/*!**********************************************************!*\
  !*** ./src/$$_lazy_route_resource lazy namespace object ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var map = {
	"./pages/main/main.module": [
		"./src/app/pages/main/main.module.ts",
		"pages-main-main-module"
	]
};
function webpackAsyncContext(req) {
	var ids = map[req];
	if(!ids) {
		return Promise.resolve().then(function() {
			var e = new Error("Cannot find module '" + req + "'");
			e.code = 'MODULE_NOT_FOUND';
			throw e;
		});
	}
	return __webpack_require__.e(ids[1]).then(function() {
		var id = ids[0];
		return __webpack_require__(id);
	});
}
webpackAsyncContext.keys = function webpackAsyncContextKeys() {
	return Object.keys(map);
};
webpackAsyncContext.id = "./src/$$_lazy_route_resource lazy recursive";
module.exports = webpackAsyncContext;

/***/ }),

/***/ "./src/app/app-routing.module.ts":
/*!***************************************!*\
  !*** ./src/app/app-routing.module.ts ***!
  \***************************************/
/*! exports provided: AppRoutingModule */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AppRoutingModule", function() { return AppRoutingModule; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};


var routes = [
    // {
    //   path: 'main',
    //   loadChildren: './pages/main/main.module#MainPageModule'
    // },
    // {
    //   path: 'poi',
    //   loadChildren: './pages/main/main.module#MainPageModule'
    // },
    // {
    //   path: 'track',
    //   loadChildren: './pages/main/main.module#MainPageModule'
    // },
    {
        path: '',
        loadChildren: './pages/main/main.module#MainPageModule'
    },
    {
        path: '**',
        redirectTo: '',
        pathMatch: 'full'
    }
];
var AppRoutingModule = /** @class */ (function () {
    function AppRoutingModule() {
    }
    AppRoutingModule = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["NgModule"])({
            imports: [_angular_router__WEBPACK_IMPORTED_MODULE_1__["RouterModule"].forRoot(routes, { useHash: false, initialNavigation: false })],
            exports: [_angular_router__WEBPACK_IMPORTED_MODULE_1__["RouterModule"]]
        })
    ], AppRoutingModule);
    return AppRoutingModule;
}());



/***/ }),

/***/ "./src/app/app.component.html":
/*!************************************!*\
  !*** ./src/app/app.component.html ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = "<ion-app>\n  <ion-router-outlet main></ion-router-outlet>\n  <div id=\"defaultMapContainer\">\n    <div id=\"map\"></div>\n  </div>\n</ion-app>\n"

/***/ }),

/***/ "./src/app/app.component.ts":
/*!**********************************!*\
  !*** ./src/app/app.component.ts ***!
  \**********************************/
/*! exports provided: AppComponent */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AppComponent", function() { return AppComponent; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _services_device_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./services/device.service */ "./src/app/services/device.service.ts");
/* harmony import */ var _services_languages_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./services/languages.service */ "./src/app/services/languages.service.ts");
/* harmony import */ var _services_config_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./services/config.service */ "./src/app/services/config.service.ts");
/* harmony import */ var _services_geolocation_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./services/geolocation.service */ "./src/app/services/geolocation.service.ts");
/* harmony import */ var _services_model_service__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./services/model.service */ "./src/app/services/model.service.ts");
/* harmony import */ var _services_theme_service__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./services/theme.service */ "./src/app/services/theme.service.ts");
/* harmony import */ var _services_map_service__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./services/map.service */ "./src/app/services/map.service.ts");
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! rxjs/operators */ "./node_modules/rxjs/_esm5/operators/index.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var _services_router_service__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./services/router.service */ "./src/app/services/router.service.ts");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};











var AppComponent = /** @class */ (function () {
    function AppComponent(_deviceService, _mapService, _modelService, _languagesService, _configService, _geolocationService, _router, _routerService, _themeService, _ngZone) {
        this._deviceService = _deviceService;
        this._mapService = _mapService;
        this._modelService = _modelService;
        this._languagesService = _languagesService;
        this._configService = _configService;
        this._geolocationService = _geolocationService;
        this._router = _router;
        this._routerService = _routerService;
        this._themeService = _themeService;
        this._ngZone = _ngZone;
        this.initializeApp();
    }
    AppComponent.prototype.initializeApp = function () {
        var _this = this;
        var startUrl = this._configService.getStartUrl();
        this._routerService.navigate([this._configService.getStartUrl()]);
        this._mapService.onReady
            .pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_8__["filter"])(function (ready) { return ready; }), Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_8__["take"])(1))
            .subscribe(function () {
            setTimeout(function () {
                if (startUrl.indexOf('/poi/') !== -1) {
                    var id = startUrl.split('/poi/')[1];
                    _this._mapService.centerOnFeature(id, true);
                }
                else {
                    if (!_this._configService.areMapExtentDefined())
                        _this._mapService.centerFeatureLayer();
                    else
                        _this._mapService.fitExtent();
                }
            }, 0);
        });
    };
    AppComponent = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Component"])({
            selector: 'app-root',
            template: __webpack_require__(/*! ./app.component.html */ "./src/app/app.component.html")
        }),
        __metadata("design:paramtypes", [_services_device_service__WEBPACK_IMPORTED_MODULE_1__["DeviceService"],
            _services_map_service__WEBPACK_IMPORTED_MODULE_7__["MapService"],
            _services_model_service__WEBPACK_IMPORTED_MODULE_5__["ModelService"],
            _services_languages_service__WEBPACK_IMPORTED_MODULE_2__["LanguagesService"],
            _services_config_service__WEBPACK_IMPORTED_MODULE_3__["ConfigService"],
            _services_geolocation_service__WEBPACK_IMPORTED_MODULE_4__["GeolocationService"],
            _angular_router__WEBPACK_IMPORTED_MODULE_9__["Router"],
            _services_router_service__WEBPACK_IMPORTED_MODULE_10__["RouterService"],
            _services_theme_service__WEBPACK_IMPORTED_MODULE_6__["ThemeService"],
            _angular_core__WEBPACK_IMPORTED_MODULE_0__["NgZone"]])
    ], AppComponent);
    return AppComponent;
}());



/***/ }),

/***/ "./src/app/app.module.ts":
/*!*******************************!*\
  !*** ./src/app/app.module.ts ***!
  \*******************************/
/*! exports provided: HttpLoaderFactory, initConfig, setUpI18nCountrySelect, AppModule */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "HttpLoaderFactory", function() { return HttpLoaderFactory; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "initConfig", function() { return initConfig; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "setUpI18nCountrySelect", function() { return setUpI18nCountrySelect; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AppModule", function() { return AppModule; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_platform_browser__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/platform-browser */ "./node_modules/@angular/platform-browser/fesm5/platform-browser.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var _angular_common_http__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @angular/common/http */ "./node_modules/@angular/common/fesm5/http.js");
/* harmony import */ var _ionic_angular__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @ionic/angular */ "./node_modules/@ionic/angular/dist/fesm5.js");
/* harmony import */ var _app_component__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./app.component */ "./src/app/app.component.ts");
/* harmony import */ var _app_routing_module__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./app-routing.module */ "./src/app/app-routing.module.ts");
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var _ngx_translate_http_loader__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @ngx-translate/http-loader */ "./node_modules/@ngx-translate/http-loader/fesm5/ngx-translate-http-loader.js");
/* harmony import */ var ngx_i18n_country_select__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ngx-i18n-country-select */ "./node_modules/ngx-i18n-country-select/fesm5/ngx-i18n-country-select.js");
/* harmony import */ var _ionic_storage__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @ionic/storage */ "./node_modules/@ionic/storage/fesm5/ionic-storage.js");
/* harmony import */ var _ionic_native_background_geolocation_ngx__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @ionic-native/background-geolocation/ngx */ "./node_modules/@ionic-native/background-geolocation/ngx/index.js");
/* harmony import */ var ngx_clipboard__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ngx-clipboard */ "./node_modules/ngx-clipboard/fesm5/ngx-clipboard.js");
/* harmony import */ var _ionic_native_device_orientation_ngx__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @ionic-native/device-orientation/ngx */ "./node_modules/@ionic-native/device-orientation/ngx/index.js");
/* harmony import */ var _ionic_native_file_ngx__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @ionic-native/file/ngx */ "./node_modules/@ionic-native/file/ngx/index.js");
/* harmony import */ var _ionic_native_geolocation_ngx__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @ionic-native/geolocation/ngx */ "./node_modules/@ionic-native/geolocation/ngx/index.js");
/* harmony import */ var _ionic_native_in_app_browser_ngx__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @ionic-native/in-app-browser/ngx */ "./node_modules/@ionic-native/in-app-browser/ngx/index.js");
/* harmony import */ var _ionic_native_keyboard_ngx__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! @ionic-native/keyboard/ngx */ "./node_modules/@ionic-native/keyboard/ngx/index.js");
/* harmony import */ var _ionic_native_launch_navigator_ngx__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @ionic-native/launch-navigator/ngx */ "./node_modules/@ionic-native/launch-navigator/ngx/index.js");
/* harmony import */ var _ionic_native_sqlite_ngx__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @ionic-native/sqlite/ngx */ "./node_modules/@ionic-native/sqlite/ngx/index.js");
/* harmony import */ var _ionic_native_ionic_webview_ngx__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @ionic-native/ionic-webview/ngx */ "./node_modules/@ionic-native/ionic-webview/ngx/index.js");
/* harmony import */ var _services_config_service__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./services/config.service */ "./src/app/services/config.service.ts");
/* harmony import */ var _services_router_service__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./services/router.service */ "./src/app/services/router.service.ts");
/* harmony import */ var _ionic_native_diagnostic_ngx__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @ionic-native/diagnostic/ngx */ "./node_modules/@ionic-native/diagnostic/ngx/index.js");
/* harmony import */ var _angular_common__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @angular/common */ "./node_modules/@angular/common/fesm5/common.js");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};










// Ionic modules

//Ionic native modules
//Ionic native plugins - use /ngx if available














function HttpLoaderFactory(http) {
    return new _ngx_translate_http_loader__WEBPACK_IMPORTED_MODULE_8__["TranslateHttpLoader"](http, "/wp-content/plugins/wm-embedmaps/assets/js/core/assets/i18n/", ".json");
}
function initConfig(configService) {
    return function () { return configService.initialize(); };
}
function setUpI18nCountrySelect(service) {
    return function () { return service.use(['de', 'en', 'es', 'fr', 'it']); };
}
var AppModule = /** @class */ (function () {
    function AppModule() {
    }
    AppModule = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["NgModule"])({
            declarations: [_app_component__WEBPACK_IMPORTED_MODULE_5__["AppComponent"]],
            entryComponents: [],
            imports: [
                _angular_platform_browser__WEBPACK_IMPORTED_MODULE_1__["BrowserModule"],
                _ionic_angular__WEBPACK_IMPORTED_MODULE_4__["IonicModule"].forRoot(),
                _angular_common_http__WEBPACK_IMPORTED_MODULE_3__["HttpClientModule"],
                _ngx_translate_core__WEBPACK_IMPORTED_MODULE_7__["TranslateModule"].forRoot({
                    loader: {
                        provide: _ngx_translate_core__WEBPACK_IMPORTED_MODULE_7__["TranslateLoader"],
                        useFactory: HttpLoaderFactory,
                        deps: [_angular_common_http__WEBPACK_IMPORTED_MODULE_3__["HttpClient"]]
                    }
                }),
                _ionic_storage__WEBPACK_IMPORTED_MODULE_10__["IonicStorageModule"].forRoot({
                    name: '__wmdb',
                    driverOrder: ['indexeddb', 'sqlite', 'websql', 'localstorage']
                }),
                _app_routing_module__WEBPACK_IMPORTED_MODULE_6__["AppRoutingModule"]
            ],
            providers: [
                { provide: _angular_common__WEBPACK_IMPORTED_MODULE_24__["APP_BASE_HREF"], useValue: '/' },
                { provide: _angular_router__WEBPACK_IMPORTED_MODULE_2__["RouteReuseStrategy"], useClass: _ionic_angular__WEBPACK_IMPORTED_MODULE_4__["IonicRouteStrategy"] },
                { provide: _angular_core__WEBPACK_IMPORTED_MODULE_0__["APP_INITIALIZER"], useFactory: initConfig, deps: [_services_config_service__WEBPACK_IMPORTED_MODULE_21__["ConfigService"], _services_router_service__WEBPACK_IMPORTED_MODULE_22__["RouterService"]], multi: true },
                { provide: _angular_core__WEBPACK_IMPORTED_MODULE_0__["APP_INITIALIZER"], useFactory: setUpI18nCountrySelect, deps: [ngx_i18n_country_select__WEBPACK_IMPORTED_MODULE_9__["I18nCountrySelectService"]], multi: true },
                _ionic_native_background_geolocation_ngx__WEBPACK_IMPORTED_MODULE_11__["BackgroundGeolocation"],
                ngx_clipboard__WEBPACK_IMPORTED_MODULE_12__["ClipboardModule"],
                _ionic_native_diagnostic_ngx__WEBPACK_IMPORTED_MODULE_23__["Diagnostic"],
                _ionic_native_device_orientation_ngx__WEBPACK_IMPORTED_MODULE_13__["DeviceOrientation"],
                _ionic_native_file_ngx__WEBPACK_IMPORTED_MODULE_14__["File"],
                _ionic_native_geolocation_ngx__WEBPACK_IMPORTED_MODULE_15__["Geolocation"],
                _ionic_native_in_app_browser_ngx__WEBPACK_IMPORTED_MODULE_16__["InAppBrowser"],
                _ionic_native_keyboard_ngx__WEBPACK_IMPORTED_MODULE_17__["Keyboard"],
                _ionic_native_launch_navigator_ngx__WEBPACK_IMPORTED_MODULE_18__["LaunchNavigator"],
                _ionic_native_sqlite_ngx__WEBPACK_IMPORTED_MODULE_19__["SQLite"],
                _ionic_native_ionic_webview_ngx__WEBPACK_IMPORTED_MODULE_20__["WebView"],
                ngx_i18n_country_select__WEBPACK_IMPORTED_MODULE_9__["I18nCountrySelectService"],
                ngx_i18n_country_select__WEBPACK_IMPORTED_MODULE_9__["I18nCountrySelectModule"]
            ],
            bootstrap: [_app_component__WEBPACK_IMPORTED_MODULE_5__["AppComponent"]]
        })
    ], AppModule);
    return AppModule;
}());



/***/ }),

/***/ "./src/app/classes/clocation.ts":
/*!**************************************!*\
  !*** ./src/app/classes/clocation.ts ***!
  \**************************************/
/*! exports provided: CLocation */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CLocation", function() { return CLocation; });
var CLocation = /** @class */ (function () {
    function CLocation(longitude, latitude, altitude, accuracy, speed, bearing) {
        this.longitude = Math.round(longitude * 100000) / 100000;
        this.latitude = Math.round(latitude * 100000) / 100000;
        this.altitude = Math.round(altitude) || undefined;
        this.accuracy = Math.round(accuracy) || undefined;
        this.speed = Math.round(speed * 100) / 100 || undefined;
        this.bearing = Math.round(bearing) || undefined;
        this.timestamp = Date.now();
    }
    CLocation.prototype.getLatLng = function () {
        return [this.latitude, this.longitude];
    };
    return CLocation;
}());



/***/ }),

/***/ "./src/app/classes/ctaxonomies.ts":
/*!****************************************!*\
  !*** ./src/app/classes/ctaxonomies.ts ***!
  \****************************************/
/*! exports provided: CTaxonomies */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CTaxonomies", function() { return CTaxonomies; });
var CTaxonomies = /** @class */ (function () {
    function CTaxonomies() {
    }
    return CTaxonomies;
}());



/***/ }),

/***/ "./src/app/classes/elocation-state.enum.ts":
/*!*************************************************!*\
  !*** ./src/app/classes/elocation-state.enum.ts ***!
  \*************************************************/
/*! exports provided: ELocationState */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ELocationState", function() { return ELocationState; });
var ELocationState;
(function (ELocationState) {
    ELocationState[ELocationState["ENABLED"] = 0] = "ENABLED";
    ELocationState[ELocationState["ENABLED_WHEN_IN_USE"] = 1] = "ENABLED_WHEN_IN_USE";
    ELocationState[ELocationState["NOT_ENABLED"] = 2] = "NOT_ENABLED";
    ELocationState[ELocationState["NOT_AUTHORIZED"] = 4] = "NOT_AUTHORIZED";
    ELocationState[ELocationState["SETTINGS"] = 5] = "SETTINGS";
})(ELocationState || (ELocationState = {}));


/***/ }),

/***/ "./src/app/classes/etaxonomy.enum.ts":
/*!*******************************************!*\
  !*** ./src/app/classes/etaxonomy.enum.ts ***!
  \*******************************************/
/*! exports provided: ETaxonomy */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ETaxonomy", function() { return ETaxonomy; });
var ETaxonomy;
(function (ETaxonomy) {
    ETaxonomy["WEBMAPP_CATEGORY"] = "webmapp_category";
    ETaxonomy["ACTIVITY"] = "activity";
    ETaxonomy["THEME"] = "theme";
    ETaxonomy["WHEN"] = "when";
    ETaxonomy["WHERE"] = "where";
    ETaxonomy["WHO"] = "who";
})(ETaxonomy || (ETaxonomy = {}));


/***/ }),

/***/ "./src/app/constants.js":
/*!******************************!*\
  !*** ./src/app/constants.js ***!
  \******************************/
/*! exports provided: WEBAPP_HOST, SINGLE_MAP_ID, POI, TRACK, ROUTE, COMPASS_ROTATION_TIMEOUT, CURRENT_SPEED_TIME_WINDOW, GEOLOCATION_TIMEOUT_TIME, MIN_SPEED_FOR_GPS_BEARING, OUT_OF_TRACK_TOAST_DELAY, MAX_SYNC_IMG_DOWNLOAD, RETRY_DELAY, RETRY_TIMES, FORCE_POST_RETRY_DELAY, MERGE_LENGTH_LIMIT, DEF_FEATURE_COLOR, DEF_FEATURE_FILL_COLOR, DEF_FEATURE_FILL_OPACITY, DEF_TRACK_STROKE_WIDTH, DEF_POLYGON_STROKE_WIDTH, DEF_FEATURE_STROKE_OPACITY, DEF_CONFIG, MAP_DEF_ZOOM, MAP_DEF_CENTER, MAP_DEF_FIT_PADDING, MAP_DEF_ANIMATION_DURATION, MAP_DEF_EXTENT, DEF_OVERLAY_CONFIG */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "WEBAPP_HOST", function() { return WEBAPP_HOST; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SINGLE_MAP_ID", function() { return SINGLE_MAP_ID; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "POI", function() { return POI; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TRACK", function() { return TRACK; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ROUTE", function() { return ROUTE; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "COMPASS_ROTATION_TIMEOUT", function() { return COMPASS_ROTATION_TIMEOUT; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CURRENT_SPEED_TIME_WINDOW", function() { return CURRENT_SPEED_TIME_WINDOW; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "GEOLOCATION_TIMEOUT_TIME", function() { return GEOLOCATION_TIMEOUT_TIME; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MIN_SPEED_FOR_GPS_BEARING", function() { return MIN_SPEED_FOR_GPS_BEARING; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "OUT_OF_TRACK_TOAST_DELAY", function() { return OUT_OF_TRACK_TOAST_DELAY; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MAX_SYNC_IMG_DOWNLOAD", function() { return MAX_SYNC_IMG_DOWNLOAD; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RETRY_DELAY", function() { return RETRY_DELAY; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RETRY_TIMES", function() { return RETRY_TIMES; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "FORCE_POST_RETRY_DELAY", function() { return FORCE_POST_RETRY_DELAY; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MERGE_LENGTH_LIMIT", function() { return MERGE_LENGTH_LIMIT; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_FEATURE_COLOR", function() { return DEF_FEATURE_COLOR; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_FEATURE_FILL_COLOR", function() { return DEF_FEATURE_FILL_COLOR; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_FEATURE_FILL_OPACITY", function() { return DEF_FEATURE_FILL_OPACITY; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_TRACK_STROKE_WIDTH", function() { return DEF_TRACK_STROKE_WIDTH; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_POLYGON_STROKE_WIDTH", function() { return DEF_POLYGON_STROKE_WIDTH; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_FEATURE_STROKE_OPACITY", function() { return DEF_FEATURE_STROKE_OPACITY; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_CONFIG", function() { return DEF_CONFIG; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MAP_DEF_ZOOM", function() { return MAP_DEF_ZOOM; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MAP_DEF_CENTER", function() { return MAP_DEF_CENTER; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MAP_DEF_FIT_PADDING", function() { return MAP_DEF_FIT_PADDING; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MAP_DEF_ANIMATION_DURATION", function() { return MAP_DEF_ANIMATION_DURATION; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MAP_DEF_EXTENT", function() { return MAP_DEF_EXTENT; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_OVERLAY_CONFIG", function() { return DEF_OVERLAY_CONFIG; });
// WEBAPP HOST
var WEBAPP_HOST = 'wa.webmapp.it';
// DATA
var SINGLE_MAP_ID = 'wm-map';
var POI = 'poi';
var TRACK = 'track';
var ROUTE = 'route';
// GEOLOCATION
var COMPASS_ROTATION_TIMEOUT = 8000; // Time in milliseconds to wait before switching from gps rotation to compass rotation
var CURRENT_SPEED_TIME_WINDOW = 10000; // Time in milliseconds window of positions to calculate currentSpeed with
var GEOLOCATION_TIMEOUT_TIME = 60000;
var MIN_SPEED_FOR_GPS_BEARING = 1; // Speed in km/h needed to switch from compass bearing (<) to gps bearing (>)
var OUT_OF_TRACK_TOAST_DELAY = 8000; // Time in milliseconds to wait before switching from gps rotation to compass rotation
// OFFLINE
var MAX_SYNC_IMG_DOWNLOAD = 10;
var RETRY_DELAY = 5000;
var RETRY_TIMES = 20;
// REPORT
var FORCE_POST_RETRY_DELAY = 25000;
var MERGE_LENGTH_LIMIT = 1;
// MAP
var DEF_FEATURE_COLOR = '#000000';
var DEF_FEATURE_FILL_COLOR = '#000000';
var DEF_FEATURE_FILL_OPACITY = 0.2;
var DEF_TRACK_STROKE_WIDTH = 2.5;
var DEF_POLYGON_STROKE_WIDTH = 1;
var DEF_FEATURE_STROKE_OPACITY = 1;
// CONFIG
var DEF_CONFIG = {
    MAP: {
        layers: [
            {
                label: "Mappa",
                type: "maptile",
                tilesUrl: "https://api.webmapp.it/tiles/",
                default: false
            }
        ]
    },
    OPTIONS: {
        openWebLinkFromPopup: true
    },
    GEOLOCATION: {
        disable: true
    }
};
var MAP_DEF_ZOOM = 11;
var MAP_DEF_CENTER = [0, 0];
var MAP_DEF_FIT_PADDING = [15, 15, 15, 15];
var MAP_DEF_ANIMATION_DURATION = 500;
var MAP_DEF_EXTENT = [-180, -85, 180, 85];
var DEF_OVERLAY_CONFIG = {
    id: '',
    type: 'geojson',
    color: '#f00',
    icon: 'wm-icon-generic'
};
//# sourceMappingURL=constants.js.map

/***/ }),

/***/ "./src/app/constants.ts":
/*!******************************!*\
  !*** ./src/app/constants.ts ***!
  \******************************/
/*! exports provided: WEBAPP_HOST, SINGLE_MAP_ID, POI, TRACK, ROUTE, COMPASS_ROTATION_TIMEOUT, CURRENT_SPEED_TIME_WINDOW, GEOLOCATION_TIMEOUT_TIME, MIN_SPEED_FOR_GPS_BEARING, OUT_OF_TRACK_TOAST_DELAY, MAX_SYNC_IMG_DOWNLOAD, RETRY_DELAY, RETRY_TIMES, FORCE_POST_RETRY_DELAY, MERGE_LENGTH_LIMIT, DEF_FEATURE_COLOR, DEF_FEATURE_FILL_COLOR, DEF_FEATURE_FILL_OPACITY, DEF_TRACK_STROKE_WIDTH, DEF_POLYGON_STROKE_WIDTH, DEF_FEATURE_STROKE_OPACITY, DEF_CONFIG, MAP_DEF_ZOOM, MAP_DEF_CENTER, MAP_DEF_FIT_PADDING, MAP_DEF_ANIMATION_DURATION, MAP_DEF_EXTENT, DEF_OVERLAY_CONFIG */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "WEBAPP_HOST", function() { return WEBAPP_HOST; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SINGLE_MAP_ID", function() { return SINGLE_MAP_ID; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "POI", function() { return POI; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TRACK", function() { return TRACK; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ROUTE", function() { return ROUTE; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "COMPASS_ROTATION_TIMEOUT", function() { return COMPASS_ROTATION_TIMEOUT; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CURRENT_SPEED_TIME_WINDOW", function() { return CURRENT_SPEED_TIME_WINDOW; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "GEOLOCATION_TIMEOUT_TIME", function() { return GEOLOCATION_TIMEOUT_TIME; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MIN_SPEED_FOR_GPS_BEARING", function() { return MIN_SPEED_FOR_GPS_BEARING; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "OUT_OF_TRACK_TOAST_DELAY", function() { return OUT_OF_TRACK_TOAST_DELAY; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MAX_SYNC_IMG_DOWNLOAD", function() { return MAX_SYNC_IMG_DOWNLOAD; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RETRY_DELAY", function() { return RETRY_DELAY; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RETRY_TIMES", function() { return RETRY_TIMES; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "FORCE_POST_RETRY_DELAY", function() { return FORCE_POST_RETRY_DELAY; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MERGE_LENGTH_LIMIT", function() { return MERGE_LENGTH_LIMIT; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_FEATURE_COLOR", function() { return DEF_FEATURE_COLOR; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_FEATURE_FILL_COLOR", function() { return DEF_FEATURE_FILL_COLOR; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_FEATURE_FILL_OPACITY", function() { return DEF_FEATURE_FILL_OPACITY; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_TRACK_STROKE_WIDTH", function() { return DEF_TRACK_STROKE_WIDTH; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_POLYGON_STROKE_WIDTH", function() { return DEF_POLYGON_STROKE_WIDTH; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_FEATURE_STROKE_OPACITY", function() { return DEF_FEATURE_STROKE_OPACITY; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_CONFIG", function() { return DEF_CONFIG; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MAP_DEF_ZOOM", function() { return MAP_DEF_ZOOM; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MAP_DEF_CENTER", function() { return MAP_DEF_CENTER; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MAP_DEF_FIT_PADDING", function() { return MAP_DEF_FIT_PADDING; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MAP_DEF_ANIMATION_DURATION", function() { return MAP_DEF_ANIMATION_DURATION; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MAP_DEF_EXTENT", function() { return MAP_DEF_EXTENT; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEF_OVERLAY_CONFIG", function() { return DEF_OVERLAY_CONFIG; });
// WEBAPP HOST
var WEBAPP_HOST = 'wa.webmapp.it';
// DATA
var SINGLE_MAP_ID = 'wm-map';
var POI = 'poi';
var TRACK = 'track';
var ROUTE = 'route';
// GEOLOCATION
var COMPASS_ROTATION_TIMEOUT = 8000; // Time in milliseconds to wait before switching from gps rotation to compass rotation
var CURRENT_SPEED_TIME_WINDOW = 10000; // Time in milliseconds window of positions to calculate currentSpeed with
var GEOLOCATION_TIMEOUT_TIME = 60000;
var MIN_SPEED_FOR_GPS_BEARING = 1; // Speed in km/h needed to switch from compass bearing (<) to gps bearing (>)
var OUT_OF_TRACK_TOAST_DELAY = 8000; // Time in milliseconds to wait before switching from gps rotation to compass rotation
// OFFLINE
var MAX_SYNC_IMG_DOWNLOAD = 10;
var RETRY_DELAY = 5000;
var RETRY_TIMES = 20;
// REPORT
var FORCE_POST_RETRY_DELAY = 25000;
var MERGE_LENGTH_LIMIT = 1;
// MAP
var DEF_FEATURE_COLOR = '#000000';
var DEF_FEATURE_FILL_COLOR = '#000000';
var DEF_FEATURE_FILL_OPACITY = 0.2;
var DEF_TRACK_STROKE_WIDTH = 2.5;
var DEF_POLYGON_STROKE_WIDTH = 1;
var DEF_FEATURE_STROKE_OPACITY = 1;
// CONFIG
var DEF_CONFIG = {
    MAP: {
        layers: [
            {
                label: "Mappa",
                type: "maptile",
                tilesUrl: "https://api.webmapp.it/tiles/",
                default: false
            }
        ]
    },
    OPTIONS: {
        openWebLinkFromPopup: true
    },
    GEOLOCATION: {
        disable: true
    }
};
var MAP_DEF_ZOOM = 11;
var MAP_DEF_CENTER = [0, 0];
var MAP_DEF_FIT_PADDING = [15, 15, 15, 15];
var MAP_DEF_ANIMATION_DURATION = 500;
var MAP_DEF_EXTENT = [-180, -85, 180, 85];
var DEF_OVERLAY_CONFIG = {
    id: '',
    type: 'geojson',
    color: '#f00',
    icon: 'wm-icon-generic'
};


/***/ }),

/***/ "./src/app/services/communication.service.ts":
/*!***************************************************!*\
  !*** ./src/app/services/communication.service.ts ***!
  \***************************************************/
/*! exports provided: CommunicationService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CommunicationService", function() { return CommunicationService; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_common_http__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/common/http */ "./node_modules/@angular/common/fesm5/http.js");
/**
 * Communication Service
 *
 * It provides all the functions to communicate using http
 *
 * */
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};


var CommunicationService = /** @class */ (function () {
    function CommunicationService(_http) {
        this._http = _http;
    }
    /**
     * Perform a GET request and get the result
     *
     * @param url
     */
    CommunicationService.prototype.get = function (url, options) {
        return this._http.get(url, options);
    };
    /**
     * Perform a request using POST and get the result
     *
     * @param url
     */
    CommunicationService.prototype.post = function (url, data, options) {
        return this._http.post(url, data, options);
    };
    CommunicationService = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [_angular_common_http__WEBPACK_IMPORTED_MODULE_1__["HttpClient"]])
    ], CommunicationService);
    return CommunicationService;
}());



/***/ }),

/***/ "./src/app/services/config.service.ts":
/*!********************************************!*\
  !*** ./src/app/services/config.service.ts ***!
  \********************************************/
/*! exports provided: ConfigService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ConfigService", function() { return ConfigService; });
/* harmony import */ var _config_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../config.json */ "./config.json");
var _config_json__WEBPACK_IMPORTED_MODULE_0___namespace = /*#__PURE__*/__webpack_require__.t(/*! ../../../config.json */ "./config.json", 1);
/* harmony import */ var version_json__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! version.json */ "./version.json");
var version_json__WEBPACK_IMPORTED_MODULE_1___namespace = /*#__PURE__*/__webpack_require__.t(/*! version.json */ "./version.json", 1);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _communication_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./communication.service */ "./src/app/services/communication.service.ts");
/* harmony import */ var _storage_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./storage.service */ "./src/app/services/storage.service.ts");
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");
/* harmony import */ var _constants_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../constants.js */ "./src/app/constants.js");
/**
 * Config Service
 *
 * It makes the configuration accessible from all the app
 *
 * */
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};





// TODO find a way to type the config


var ConfigService = /** @class */ (function () {
    function ConfigService(_communicationService, _storageService) {
        this._communicationService = _communicationService;
        this._storageService = _storageService;
        console.info("Core version " + version_json__WEBPACK_IMPORTED_MODULE_1__["version"]);
        this.onMapConfigChange = new rxjs__WEBPACK_IMPORTED_MODULE_5__["ReplaySubject"](1);
        this.onHomeConfigChange = new rxjs__WEBPACK_IMPORTED_MODULE_5__["ReplaySubject"](1);
        this._offlineConfigVersion = 0;
        this.isEmbedded = true; //false;
        this.onMapConfigChange.next(this._offlineConfigVersion);
        this.onHomeConfigChange.next(this._offlineConfigVersion);
    }
    /**
     * Function called during app initialization, to update the configuration
     */
    ConfigService.prototype.initialize = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            // prevent problems when in local server and parameters are not set
            var tmp = _config_json__WEBPACK_IMPORTED_MODULE_0___namespace;
            _this._config = tmp.default;
            var url = '/config.json', startUrl = '/', params = window.location.search.split('?');
            if (params.length > 1) {
                params = params[1].split('&');
                for (var _i = 0, params_1 = params; _i < params_1.length; _i++) {
                    var param = params_1[_i];
                    var name_1 = param.split('=')[0], value = param.split('=')[1];
                    if (name_1 === 'config_json') {
                        url = value;
                        if (url.substring(0, 4) !== 'http')
                            url = 'http://' + url;
                    }
                }
            }
            var elem = document.getElementsByTagName('wm-map-container')[0];
            if (elem) {
                url = elem.getAttribute('configJsonUrl');
                startUrl = elem.getAttribute('startUrl');
                startUrl = startUrl ? startUrl : '/';
                _this.isEmbedded = true;
                if (url) {
                    _this._communicationService.get(url + '?t=' + Date.now()).subscribe(function (response) {
                        _this._config = response;
                        if (!_this._config.OPTIONS)
                            _this._config.OPTIONS = {};
                        if (_this._config.OPTIONS.baseUrl[_this._config.OPTIONS.baseUrl.length - 1] !== '/')
                            _this._config.OPTIONS.baseUrl += '/';
                        _this._config.OPTIONS.startUrl = startUrl;
                        resolve();
                    }, function (err) {
                        console.error(err);
                        resolve();
                    });
                }
                else {
                    _this._config = _constants_js__WEBPACK_IMPORTED_MODULE_6__["DEF_CONFIG"];
                    resolve();
                }
            }
            else {
                _this._communicationService.get(url + '?t=' + Date.now()).subscribe(function (response) {
                    _this._config = response;
                    if (!_this._config.OPTIONS)
                        _this._config.OPTIONS = {};
                    if (_this._config.OPTIONS.baseUrl[_this._config.OPTIONS.baseUrl.length - 1] !== '/')
                        _this._config.OPTIONS.baseUrl += '/';
                    _this._config.OPTIONS.startUrl = startUrl;
                    resolve();
                }, function (err) {
                    console.error(err);
                    resolve();
                });
            }
        });
    };
    ConfigService.prototype.getVersion = function () {
        return version_json__WEBPACK_IMPORTED_MODULE_1__["version"];
    };
    ConfigService.prototype.getAppName = function () {
        return this._config.APP ? this._config.APP.name : 'Webmapp';
    };
    ConfigService.prototype.getAppId = function () {
        return this._config.APP && this._config.APP.id ? this._config.APP.id : '';
    };
    ConfigService.prototype.getCustomerName = function () {
        return this._config.APP && this._config.APP.customerName ? this._config.APP.customerName : 'Webmapp';
    };
    ConfigService.prototype.getPrivacyUrl = function () {
        return this._config.OPTIONS && this._config.OPTIONS.privacyUrl ? this._config.OPTIONS.privacyUrl : 'https://webmapp.it/privacy';
    };
    ConfigService.prototype.getStartUrl = function () {
        return this._config.OPTIONS && this._config.OPTIONS.startUrl ? this._config.OPTIONS.startUrl : '/';
    };
    ConfigService.prototype.openWebLinkFromPopup = function () {
        return this._config.OPTIONS && this._config.OPTIONS.openWebLinkFromPopup ? true : false;
    };
    ConfigService.prototype.isGeolocationAvailable = function () {
        return this._config && this._config.GEOLOCATION && this._config.GEOLOCATION.disable ? false : true;
    };
    ConfigService.prototype.hasK = function () {
        return this._config && this._config.OPTIONS && this._config.OPTIONS.baseUrl ? true : false;
    };
    /**
     * MAP
     */
    ConfigService.prototype.hasMap = function () {
        var valid = false;
        if (this._config.MAP && this._config.MAP.layers && this._config.MAP.layers.length > 0) {
            this._config.MAP.layers.forEach(function (layer) {
                if (typeof layer.tilesUrl === 'string' &&
                    layer.tilesUrl !== '' &&
                    typeof layer.type === 'string' &&
                    layer.type !== '')
                    valid = true;
            });
        }
        return valid;
    };
    ConfigService.prototype.getMapMaxZoom = function () {
        if (this._offlineMapConfig && this._offlineMapConfig.maxZoom && typeof this._offlineMapConfig.maxZoom === 'number')
            return this._offlineMapConfig.maxZoom;
        else
            return this._config.MAP.maxZoom && typeof this._config.MAP.maxZoom === 'number' ? this._config.MAP.maxZoom : 17;
    };
    ConfigService.prototype.getMapMinZoom = function () {
        if (this._offlineMapConfig && this._offlineMapConfig.minZoom && typeof this._offlineMapConfig.minZoom === 'number')
            return this._offlineMapConfig.minZoom;
        else
            return this._config.MAP.minZoom && typeof this._config.MAP.minZoom === 'number' ? this._config.MAP.minZoom : 1;
    };
    ConfigService.prototype.getMapDefZoom = function () {
        if (this._offlineMapConfig && this._offlineMapConfig.defZoom && typeof this._offlineMapConfig.defZoom === 'number')
            return this._offlineMapConfig.defZoom;
        else
            return this._config.MAP.defZoom && typeof this._config.MAP.defZoom === 'number' ? this._config.MAP.defZoom : undefined;
    };
    ConfigService.prototype.getMapCenter = function () {
        var valid = true;
        if (this._offlineMapConfig && this._offlineMapConfig.center && this._offlineMapConfig.center.length === 2) {
            this._offlineMapConfig.center.forEach(function (item) {
                if (typeof item !== 'number')
                    valid = false;
            });
            if (valid)
                return [this._offlineMapConfig.center[0], this._offlineMapConfig.center[1]];
        }
        valid = true;
        if (this._config.MAP.center && this._config.MAP.center.length === 2) {
            this._config.MAP.center.forEach(function (item) {
                if (typeof item !== 'number')
                    valid = false;
            });
        }
        else
            valid = false;
        return valid ? [this._config.MAP.center[0], this._config.MAP.center[1]] : undefined;
    };
    ConfigService.prototype.areMapExtentDefined = function () {
        var extent = this.getMapExtent();
        return extent[0] === _constants_js__WEBPACK_IMPORTED_MODULE_6__["MAP_DEF_EXTENT"][0]
            && extent[1] === _constants_js__WEBPACK_IMPORTED_MODULE_6__["MAP_DEF_EXTENT"][1]
            && extent[2] === _constants_js__WEBPACK_IMPORTED_MODULE_6__["MAP_DEF_EXTENT"][2]
            && extent[3] === _constants_js__WEBPACK_IMPORTED_MODULE_6__["MAP_DEF_EXTENT"][3]
            ? false : true;
    };
    ConfigService.prototype.getMapExtent = function () {
        var extent;
        if (this._offlineMapConfig && this._offlineMapConfig.bbox && this._offlineMapConfig.bbox.length && this._offlineMapConfig.bbox.length === 4)
            extent = [this._offlineMapConfig.bbox[0], this._offlineMapConfig.bbox[1], this._offlineMapConfig.bbox[2], this._offlineMapConfig.bbox[3]];
        else if (this._config.MAP.bbox && this._config.MAP.bbox.length && this._config.MAP.bbox.length === 4)
            extent = [this._config.MAP.bbox[0], this._config.MAP.bbox[1], this._config.MAP.bbox[2], this._config.MAP.bbox[3]];
        else
            extent = _constants_js__WEBPACK_IMPORTED_MODULE_6__["MAP_DEF_EXTENT"];
        return extent;
    };
    ConfigService.prototype.getBaseLayers = function () {
        var layers = [];
        if (this.hasMap()) {
            this._config.MAP.layers.forEach(function (layer) {
                if (typeof layer.tilesUrl === 'string' &&
                    layer.tilesUrl !== '' &&
                    typeof layer.type === 'string' &&
                    layer.type !== '')
                    layers.push(layer);
            });
        }
        return layers;
    };
    ConfigService.prototype.getOverlayLayers = function () {
        var layers = [];
        if (this._offlineMapConfig && this._offlineMapConfig.overlays) {
            this._offlineMapConfig.overlays.forEach(function (layer) {
                if (typeof layer.type === 'string' &&
                    layer.type !== '')
                    layers.push(layer);
            });
        }
        else if (this._config.MAP.overlays) {
            this._config.MAP.overlays.forEach(function (layer) {
                if (typeof layer.type === 'string' &&
                    layer.type !== '')
                    layers.push(layer);
            });
        }
        return layers;
    };
    ConfigService.prototype.addArrowsOverTracks = function () {
        return this._config.OPTIONS && this._config.OPTIONS.addArrowsOverTracks ? true : false;
    };
    ConfigService.prototype.getPoiPin = function () {
        if (!this._config.OPTIONS || !this._config.OPTIONS.poiPinImage || this._config.OPTIONS.poiPinImage === 'webmapp_pin') {
            return {
                src: '/wp-content/plugins/wm-embedmaps/assets/js/core/assets/images/webmapp_pin.png',
                scale: 0.2
            };
        }
        else if (this._config.OPTIONS && this._config.OPTIONS.poiPinImage === 'rt_pin') {
            return {
                src: '/wp-content/plugins/wm-embedmaps/assets/js/core/assets/images/rt_pin.png',
                scale: 0.18
            };
        }
        // else if (this._config.OPTIONS.poiPinImage.substring(0, 4) === 'http') {
        //   return {
        //     src: this._config.OPTIONS.poiPinImage,
        //     scale: this._config.OPTIONS.poiPinScale ? this._config.OPTIONS.poiPinScale : 0.2
        //   }
        // }
        else {
            return {
                src: '/wp-content/plugins/wm-embedmaps/assets/js/core/assets/images/webmapp_pin.png',
                scale: 0.2
            };
        }
    };
    ConfigService.prototype.getPoiMaxRadius = function () {
        return this._config.OPTIONS && this._config.OPTIONS.poiMaxRadius ? this._config.OPTIONS.poiMaxRadius : 1.7;
    };
    ConfigService.prototype.getPoiMinRadius = function () {
        return this._config.OPTIONS && this._config.OPTIONS.poiMinRadius && this._config.OPTIONS.poiMinRadius <= this.getPoiMaxRadius() ? this._config.OPTIONS.poiMinRadius : 0.2;
    };
    ConfigService.prototype.getPoiMinZoom = function () {
        return this._config.OPTIONS && this._config.OPTIONS.poiMinZoom && this._config.OPTIONS.poiMinZoom > this.getMapMinZoom() ? this._config.OPTIONS.poiMinZoom : this.getMapMinZoom();
    };
    ConfigService.prototype.getPoiIconRadius = function () {
        return this._config.OPTIONS && this._config.OPTIONS.poiIconRadius && this._config.OPTIONS.poiIconRadius >= 1.7 && this._config.OPTIONS.poiIconRadius >= this.getPoiMaxRadius() ? this._config.OPTIONS.poiIconRadius
            : Math.max(1.7, this.getPoiMaxRadius());
    };
    ConfigService.prototype.getIconPoiZoom = function () {
        return this._config.OPTIONS && this._config.OPTIONS.poiIconZoom ? this._config.OPTIONS.poiIconZoom : 15;
    };
    ConfigService.prototype.getPoiSelectedRadius = function () {
        return this._config.OPTIONS && this._config.OPTIONS.poiSelectedRadius && this._config.OPTIONS.poiSelectedRadius >= 2.5 && this._config.OPTIONS.poiSelectedRadius > this.getPoiIconRadius() ? this._config.OPTIONS.poiSelectedRadius
            : Math.max(2.5, this.getPoiIconRadius() + 0.3);
    };
    ConfigService.prototype.showMapViewfinder = function () {
        return this._config.OPTIONS && this._config.OPTIONS.showMapViewfinder ? true : false;
    };
    /**
     * DATA
     */
    ConfigService.prototype.getTaxonomyUrl = function (type) {
        return this._config.OPTIONS && this._config.OPTIONS.baseUrl + 'taxonomies/' + type + '.json';
    };
    ConfigService.prototype.getFeatureBaseUrl = function () {
        return this._config.OPTIONS && this._config.OPTIONS.baseUrl + 'geojson/';
    };
    ConfigService.prototype.getRouteBaseUrl = function () {
        return this._config.OPTIONS && this._config.OPTIONS.baseUrl + 'routes/';
    };
    ConfigService.prototype.getRouteImageBaseUrl = function (id) {
        return this._config.OPTIONS && this._config.OPTIONS.baseUrl + 'media/route_images/' + id + '_map_400x300.png';
    };
    ConfigService.prototype.getDefaultMapBaseUrl = function () {
        return this._config.OPTIONS && this._config.OPTIONS.baseUrl + 'tiles/';
    };
    ConfigService.prototype.getImageBaseUrl = function () {
        return this._config.OPTIONS && this._config.OPTIONS.baseUrl + 'media/';
    };
    /**
     * LANGUAGES
     */
    ConfigService.prototype.getDefaultLanguage = function () {
        var lang = 'en';
        if (this._config && this._config.LANGUAGES && this._config.LANGUAGES.default)
            lang = this._config.LANGUAGES.default.substring(0, 2);
        return lang;
    };
    ConfigService.prototype.getAvailableLanguages = function () {
        var available = [];
        var def = this.getDefaultLanguage();
        if (this._config && this._config.LANGUAGES) {
            if (this._config.LANGUAGES.available) {
                for (var i in this._config.LANGUAGES.available) {
                    available.push(this._config.LANGUAGES.available[i]);
                }
            }
            var found = false;
            for (var _i = 0, available_1 = available; _i < available_1.length; _i++) {
                var lang = available_1[_i];
                if (lang === def) {
                    found = true;
                    break;
                }
            }
            if (!found)
                available.push(def);
        }
        else
            available.push(def);
        return available;
    };
    /**
     * THEME
     */
    ConfigService.prototype.getStyle = function () {
        return this._config.THEME ? this._config.THEME : {};
    };
    /**
     * TABLES
     */
    ConfigService.prototype.showElevationChart = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.hideElevationChart ? false : true;
    };
    ConfigService.prototype.showAscent = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.hide_ascent ? false : true;
    };
    ConfigService.prototype.showDescent = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.hide_descent ? false : true;
    };
    ConfigService.prototype.showDurationForward = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details["hide_duration:forward"] ? false : true;
    };
    ConfigService.prototype.showDurationBackward = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details["hide_duration:backward"] ? false : true;
    };
    ConfigService.prototype.showEleMax = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details["hide_ele:max"] ? false : true;
    };
    ConfigService.prototype.showEleMin = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details["hide_ele:min"] ? false : true;
    };
    ConfigService.prototype.showEleFrom = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details["hide_ele:from"] ? false : true;
    };
    ConfigService.prototype.showEleTo = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details["hide_ele:to"] ? false : true;
    };
    ConfigService.prototype.showDistance = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.hide_distance ? false : true;
    };
    ConfigService.prototype.showFrom = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.hide_from ? false : true;
    };
    ConfigService.prototype.showTo = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.hide_to ? false : true;
    };
    ConfigService.prototype.showOperator = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.hide_operator ? false : true;
    };
    ConfigService.prototype.showScale = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.hide_scale ? false : true;
    };
    ConfigService.prototype.showCaiScale = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.hide_cai_scale ? false : true;
    };
    ConfigService.prototype.showMtbScale = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.hide_mtb_scale ? false : true;
    };
    ConfigService.prototype.showRef = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.hide_ref ? false : true;
    };
    ConfigService.prototype.showWgs84Coords = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.show_wgs84 ? true : false;
    };
    ConfigService.prototype.showUtmCoords = function () {
        return this._config.TABLES && this._config.TABLES.details && this._config.TABLES.details.show_utm ? true : false;
    };
    ConfigService = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_2__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [_communication_service__WEBPACK_IMPORTED_MODULE_3__["CommunicationService"],
            _storage_service__WEBPACK_IMPORTED_MODULE_4__["StorageService"]])
    ], ConfigService);
    return ConfigService;
}());



/***/ }),

/***/ "./src/app/services/device.service.ts":
/*!********************************************!*\
  !*** ./src/app/services/device.service.ts ***!
  \********************************************/
/*! exports provided: DeviceService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DeviceService", function() { return DeviceService; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");
/* harmony import */ var _ionic_native_diagnostic_ngx__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @ionic-native/diagnostic/ngx */ "./node_modules/@ionic-native/diagnostic/ngx/index.js");
/* harmony import */ var _ionic_angular__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @ionic/angular */ "./node_modules/@ionic/angular/dist/fesm5.js");
/* harmony import */ var _ionic_native_device_orientation_ngx__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @ionic-native/device-orientation/ngx */ "./node_modules/@ionic-native/device-orientation/ngx/index.js");
/* harmony import */ var _storage_service__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./storage.service */ "./src/app/services/storage.service.ts");
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var _classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../classes/elocation-state.enum */ "./src/app/classes/elocation-state.enum.ts");
/* harmony import */ var _ionic_native_keyboard_ngx__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @ionic-native/keyboard/ngx */ "./node_modules/@ionic-native/keyboard/ngx/index.js");
/**
 * Device Service
 *
 * It provides access to all the physical component installed in
 * the device such as compass, gps, camera...
 *
 * */
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};









var DeviceService = /** @class */ (function () {
    function DeviceService(_alertController, _deviceOrientation, _diagnostic, _keyboard, _storageService, _translateService) {
        var _this = this;
        this._alertController = _alertController;
        this._deviceOrientation = _deviceOrientation;
        this._diagnostic = _diagnostic;
        this._keyboard = _keyboard;
        this._storageService = _storageService;
        this._translateService = _translateService;
        this._onResize = new rxjs__WEBPACK_IMPORTED_MODULE_1__["ReplaySubject"](1);
        this._onResize.next({
            width: window.innerWidth,
            height: window.innerHeight
        });
        this.onResize = this._onResize;
        this.isBrowser = !window.cordova || window.cordova.platformId === 'browser' ? true : false;
        this.isAndroid = window.cordova && window.cordova.platformId === 'android' ? true : false;
        this.isIos = window.cordova && window.cordova.platformId === 'ios' ? true : false;
        this.isLgScreen = +window.innerWidth >= 768;
        this.isLocalServer = window.location.href.indexOf('localhost') !== -1;
        window.addEventListener('resize', function () {
            _this.isLgScreen = +window.innerWidth >= 768;
            _this._onResize.next({
                width: +window.innerWidth,
                height: +window.innerHeight
            });
        });
    }
    /**
     * GPS
     */
    DeviceService.prototype._enableGPSPermissions = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            var check = function (authorized, value) {
                if (authorized) {
                    if (typeof value !== 'undefined'
                        && value === _this._diagnostic.permissionStatus.GRANTED_WHEN_IN_USE) {
                        resolve(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].ENABLED_WHEN_IN_USE);
                    }
                    else {
                        resolve(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].ENABLED);
                    }
                }
                else {
                    if (typeof value !== 'undefined'
                        && value === _this._diagnostic.permissionStatus.DENIED_ALWAYS)
                        resolve(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].NOT_AUTHORIZED);
                    else {
                        _this._diagnostic.requestLocationAuthorization(_this._diagnostic.locationAuthorizationMode.ALWAYS).then(function (status) {
                            switch (status) {
                                case _this._diagnostic.permissionStatus.GRANTED:
                                    _this._storageService.setGpsPermissionStatus(_this._diagnostic.permissionStatus.GRANTED);
                                    resolve(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].ENABLED);
                                    break;
                                case _this._diagnostic.permissionStatus.GRANTED_WHEN_IN_USE:
                                    _this._storageService.setGpsPermissionStatus(_this._diagnostic.permissionStatus.GRANTED_WHEN_IN_USE);
                                    resolve(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].ENABLED_WHEN_IN_USE);
                                    break;
                                case _this._diagnostic.permissionStatus.DENIED:
                                    if (_this.isIos)
                                        _this._storageService.setGpsPermissionStatus(_this._diagnostic.permissionStatus.DENIED_ALWAYS);
                                    else
                                        _this._storageService.setGpsPermissionStatus(_this._diagnostic.permissionStatus.DENIED);
                                    resolve(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].NOT_AUTHORIZED);
                                    break;
                                case _this._diagnostic.permissionStatus.DENIED_ALWAYS:
                                    _this._storageService.setGpsPermissionStatus(_this._diagnostic.permissionStatus.DENIED_ALWAYS);
                                    resolve(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].NOT_AUTHORIZED);
                                    break;
                            }
                        }, function (error) {
                            reject(error);
                        });
                    }
                }
            };
            _this._diagnostic.isLocationAuthorized().then(function (authorized) {
                _this._storageService.getGpsPermissionStatus().then(function (value) {
                    check(authorized, value);
                }, function () {
                    check(authorized);
                });
            });
        });
    };
    /**
     * Handle permissions for location and try to activate the location service
     * Emit LocationState.ENABLED or LocationState.ENABLED_WHEN_IN_USE if location is available. For LocationState.NOT_ENABLED and
     * LocationState.SETTINGS values, subscribe to DeviceService.onLocationStateChanged
     *
     * @param force true if the check must trigger the popups
     */
    DeviceService.prototype.enableGPS = function (force) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this._enableGPSPermissions().then(function (authorized) {
                if (authorized === _classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].NOT_AUTHORIZED) {
                    resolve(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].NOT_AUTHORIZED);
                }
                else {
                    _this._diagnostic.isLocationEnabled().then(function (enabled) {
                        if (enabled) {
                            resolve(authorized);
                        }
                        else {
                            if (force) {
                                _this._alertController.create({
                                    header: _this._translateService.instant('alert.warning'),
                                    message: _this._translateService.instant('alert.activateGPS'),
                                    buttons: [
                                        {
                                            text: _this._translateService.instant('buttons.cancel'),
                                            role: 'cancel',
                                            cssClass: 'secondary',
                                            handler: function () {
                                                resolve(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].NOT_ENABLED);
                                            }
                                        }, {
                                            text: _this._translateService.instant('buttons.ok'),
                                            cssClass: 'primary',
                                            handler: function () {
                                                if (_this.isIos) {
                                                    _this._diagnostic.switchToSettings();
                                                }
                                                else {
                                                    _this._diagnostic.switchToLocationSettings();
                                                }
                                                resolve(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].SETTINGS);
                                            }
                                        }
                                    ]
                                }).then(function (alert) {
                                    alert.present();
                                });
                            }
                            else {
                                resolve(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].NOT_ENABLED);
                            }
                        }
                    }, function (error) {
                        reject(error);
                    });
                }
            }, function (error) {
                reject(error);
            });
        });
    };
    /**
     * Listen to GPS toggle and emit true if gps is active and permission are enabled, false otherwise
     */
    // TODO Possible memory leak if registering more than once
    DeviceService.prototype.onLocationStateChange = function () {
        var _this = this;
        return new rxjs__WEBPACK_IMPORTED_MODULE_1__["Observable"](function (observer) {
            _this._diagnostic.registerLocationStateChangeHandler(function (state) {
                if ((_this.isAndroid && state !== _this._diagnostic.locationMode.LOCATION_OFF) ||
                    (_this.isIos && (state === _this._diagnostic.permissionStatus.GRANTED ||
                        state === _this._diagnostic.permissionStatus.GRANTED_WHEN_IN_USE))) {
                    observer.next(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].ENABLED);
                }
                else {
                    observer.next(_classes_elocation_state_enum__WEBPACK_IMPORTED_MODULE_7__["ELocationState"].NOT_ENABLED);
                }
            });
            return { unsubscribe: function () { } };
        });
    };
    /**
     * Compass
     */
    DeviceService.prototype.onCompassOrientationChange = function () {
        var _this = this;
        return new rxjs__WEBPACK_IMPORTED_MODULE_1__["Observable"](function (observer) {
            var orientationWatch;
            try {
                orientationWatch.clearWatch();
            }
            catch (e) { }
            orientationWatch = _this._deviceOrientation.watchHeading({
                frequency: 300
            });
            orientationWatch = orientationWatch.subscribe(function (orientation) {
                observer.next(orientation);
            }, function (error) {
                observer.error(error);
            });
            return {
                unsubscribe: function () {
                    orientationWatch.unsubscribe();
                    orientationWatch = undefined;
                }
            };
        });
    };
    /**
     * Make the keyboard open
     */
    DeviceService.prototype.openKeyboard = function () {
        if (!this.isBrowser && !this._keyboard.isVisible)
            this._keyboard.show();
    };
    /**
     * Make the keyboard close
     */
    DeviceService.prototype.closeKeyboard = function () {
        if (!this.isBrowser && this._keyboard.isVisible)
            this._keyboard.hide();
    };
    DeviceService = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [_ionic_angular__WEBPACK_IMPORTED_MODULE_3__["AlertController"],
            _ionic_native_device_orientation_ngx__WEBPACK_IMPORTED_MODULE_4__["DeviceOrientation"],
            _ionic_native_diagnostic_ngx__WEBPACK_IMPORTED_MODULE_2__["Diagnostic"],
            _ionic_native_keyboard_ngx__WEBPACK_IMPORTED_MODULE_8__["Keyboard"],
            _storage_service__WEBPACK_IMPORTED_MODULE_5__["StorageService"],
            _ngx_translate_core__WEBPACK_IMPORTED_MODULE_6__["TranslateService"]])
    ], DeviceService);
    return DeviceService;
}());



/***/ }),

/***/ "./src/app/services/geolocation.service.ts":
/*!*************************************************!*\
  !*** ./src/app/services/geolocation.service.ts ***!
  \*************************************************/
/*! exports provided: GeolocationService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "GeolocationService", function() { return GeolocationService; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _ionic_angular__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @ionic/angular */ "./node_modules/@ionic/angular/dist/fesm5.js");
/* harmony import */ var _map_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./map.service */ "./src/app/services/map.service.ts");
/* harmony import */ var _device_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./device.service */ "./src/app/services/device.service.ts");
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! rxjs/operators */ "./node_modules/rxjs/_esm5/operators/index.js");
/* harmony import */ var _config_service__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./config.service */ "./src/app/services/config.service.ts");
/* harmony import */ var _classes_clocation__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../classes/clocation */ "./src/app/classes/clocation.ts");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../constants */ "./src/app/constants.ts");
/* harmony import */ var _ionic_native_geolocation_ngx__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @ionic-native/geolocation/ngx */ "./node_modules/@ionic-native/geolocation/ngx/index.js");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};











var GeolocationService = /** @class */ (function () {
    function GeolocationService(_alertController, _configService, _deviceService, _geolocation, _mapService, _ngZone, _platform, _translateService) {
        var _this = this;
        this._alertController = _alertController;
        this._configService = _configService;
        this._deviceService = _deviceService;
        this._geolocation = _geolocation;
        this._mapService = _mapService;
        this._ngZone = _ngZone;
        this._platform = _platform;
        this._translateService = _translateService;
        this._outsideBboxPresented = false;
        this._useGpsBearing = false;
        this._state = {
            isActive: false,
            isLoading: false,
            isFollowing: false,
            isRotating: false
        };
        this._events = {
            onZoom: null,
            onDrag: null,
            onRotate: null
        };
        this.onLocationChange = new rxjs__WEBPACK_IMPORTED_MODULE_4__["ReplaySubject"](1);
        this.onGeolocationStateChange = new rxjs__WEBPACK_IMPORTED_MODULE_4__["ReplaySubject"](1);
        this._platform.ready().then(function () {
            _this._mapService.onReady
                .pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_6__["filter"])(function (ready) { return ready; }), Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_6__["take"])(1)).subscribe(function () {
                _this._start(true);
            });
        });
    }
    /**
     * Check if map has been moved to change the geolocation status
     */
    GeolocationService.prototype._checkMapMovement = function () {
        var center = this._mapService.getCenter();
        if (this._currentLocation && this._currentLocation.latitude && this._currentLocation.longitude) {
            if (this._mapService.getFixedDistance(center, this._currentLocation) > 30) {
                if (this._state.isFollowing || this._state.isRotating) {
                    this._toggleFollow(false);
                    this._toggleRotation(false);
                    this.onGeolocationStateChange.next(this._state);
                    return true;
                }
            }
        }
        else if (this._state.isFollowing || this._state.isRotating) {
            this._toggleFollow(false);
            this._toggleRotation(false);
            this.onGeolocationStateChange.next(this._state);
            return true;
        }
        return false;
    };
    /**
     * Enable the map listeners such as center move or zoom change
     */
    GeolocationService.prototype._enableMapEventListeners = function () {
        var _this = this;
        this._events.onDrag = this._mapService.onDrag.subscribe(function () {
            _this._checkMapMovement();
        });
        this._events.onZoom = this._mapService.onZoom.subscribe(function () {
            _this._checkMapMovement();
        });
        this._events.onRotate = this._mapService.onRotateReset.subscribe(function () {
            _this.switchState({
                isActive: _this._state.isActive,
                isLoading: _this._state.isLoading,
                isFollowing: _this._state.isFollowing,
                isRotating: false
            });
        });
    };
    /**
     * Disable the map listeners
     */
    GeolocationService.prototype._disableMapEventListeners = function () {
        if (this._events && this._events.onDrag && this._events.onDrag.unsubscribe && typeof this._events.onDrag.unsubscribe === 'function')
            this._events.onDrag.unsubscribe();
        this._events.onDrag = null;
        if (this._events && this._events.onDrag && this._events.onZoom.unsubscribe && typeof this._events.onZoom.unsubscribe === 'function')
            this._events.onZoom.unsubscribe();
        this._events.onZoom = null;
    };
    /**
     * Process a new location depending on geolocation status
     *
     * @param rawLocation the new location
     * @param isCached true if the location is an old cached location
     */
    GeolocationService.prototype._locationUpdate = function (rawLocation, isCached) {
        // console.log(rawLocation)
        if (!this._state.isActive || Number.isNaN(rawLocation.latitude) || Number.isNaN(rawLocation.longitude))
            return;
        if (rawLocation.latitude && typeof rawLocation.latitude !== 'number') {
            var integer = parseFloat(rawLocation.latitude);
            var extent = this._configService.getMapExtent();
            if (integer > extent[1] && integer < extent[3])
                rawLocation.latitude = integer;
            else
                return;
        }
        if (rawLocation.longitude && typeof rawLocation.longitude !== 'number') {
            var integer = parseFloat(rawLocation.longitude);
            var extent = this._configService.getMapExtent();
            if (integer > extent[0] && integer < extent[2])
                rawLocation.longitude = integer;
            else
                return;
        }
        var newLocation = new _classes_clocation__WEBPACK_IMPORTED_MODULE_8__["CLocation"](rawLocation.longitude, rawLocation.latitude, rawLocation.altitude && typeof rawLocation.altitude === 'number' && !Number.isNaN(rawLocation.altitude) ? rawLocation.altitude : undefined, rawLocation.accuracy && typeof rawLocation.accuracy === 'number' && !Number.isNaN(rawLocation.accuracy) ? rawLocation.accuracy : undefined, rawLocation.speed && typeof rawLocation.speed === 'number' && !Number.isNaN(rawLocation.speed) ? rawLocation.speed : undefined, rawLocation.bearing && typeof rawLocation.bearing === 'number' && !Number.isNaN(rawLocation.bearing) ? rawLocation.bearing : undefined);
        var movePosition = !this._currentLocation || this._mapService.getDistanceBetweenPoints(this._currentLocation, newLocation) > 4;
        if (this._mapService.isInitialized()) {
            if (!this._mapService.isInsideExtent(newLocation)) {
                if (!isCached) {
                    this._currentLocation = null;
                    this.onLocationChange.next(undefined);
                    if (!this._outsideBboxPresented) {
                        this._alertController.create({
                            header: this._translateService.instant('alert.warning'),
                            message: this._translateService.instant('alert.outsideExtent'),
                            buttons: [
                                {
                                    text: this._translateService.instant('buttons.ok'),
                                    cssClass: 'primary'
                                }
                            ]
                        }).then(function (alert) {
                            alert.present();
                        });
                        this._outsideBboxPresented = true;
                    }
                    this._stop();
                }
                return;
            }
            this._outsideBboxPresented = false;
            if (this._state.isRotating)
                this._handleRotationSwitch(newLocation);
            if (this._state.isFollowing)
                this._mapService.centerOnCoords(newLocation);
        }
        if (this._state.isLoading) {
            this._state.isLoading = false;
            this.onGeolocationStateChange.next(this._state);
        }
        if (movePosition) {
            this._currentLocation = newLocation;
            this.onLocationChange.next(this._currentLocation);
        }
    };
    /**
     * Check permissions, enable GPS and start to track the position showing it in the map
     */
    GeolocationService.prototype._start = function (force) {
        var _this = this;
        if (force)
            this._outsideBboxPresented = false;
        return new Promise(function (resolve, reject) {
            if (_this._state.isActive
                || !_this._configService.isGeolocationAvailable()) {
                resolve(_this._state);
                return;
            }
            if (!_this._deviceService.isLocalServer && (!_this._deviceService.isBrowser || window.location.protocol === "https:")) {
                _this._enableMapEventListeners();
                _this._state.isActive = true;
                _this._state.isLoading = true;
                _this._state.isFollowing = true;
                _this._state.isRotating = false;
                _this.onGeolocationStateChange.next(_this._state);
                _this._geolocation.getCurrentPosition({
                    timeout: _constants__WEBPACK_IMPORTED_MODULE_9__["GEOLOCATION_TIMEOUT_TIME"],
                    enableHighAccuracy: true
                }).then(function (location) {
                    if (location && location.coords) {
                        var rawLocation = {
                            id: -1,
                            longitude: location.coords.longitude,
                            latitude: location.coords.latitude,
                            altitude: location.coords.altitude,
                            accuracy: location.coords.accuracy,
                            speed: location.coords.speed,
                            bearing: location.coords.heading,
                            time: location.timestamp,
                            provider: undefined,
                            locationProvider: undefined
                        };
                        _this._locationUpdate(rawLocation, true);
                    }
                }, function (err) {
                    console.warn(err);
                });
                // if (this._locationWatch) {
                //   try {
                //     this._locationWatch.unsubscribe();
                //   }
                //   catch (e) { }
                // }
                // this._locationWatch = this._geolocation.watchPosition({
                //   timeout: GEOLOCATION_TIMEOUT_TIME,
                //   enableHighAccuracy: true
                // });
                // this._locationWatch.subscribe((location: Geoposition) => {
                //   if (location && location.coords) {
                //     let rawLocation: BackgroundGeolocationResponse = {
                //       id: -1,
                //       longitude: location.coords.longitude,
                //       latitude: location.coords.latitude,
                //       altitude: location.coords.altitude,
                //       accuracy: location.coords.accuracy,
                //       speed: location.coords.speed,
                //       bearing: location.coords.heading,
                //       time: location.timestamp,
                //       provider: undefined,
                //       locationProvider: undefined
                //     };
                //     this._locationUpdate(rawLocation, false);
                //   }
                // }, (err: any) => {
                //   console.warn(err);
                //   this._start();
                // });
            }
            else if (_this._deviceService.isLocalServer) {
                _this._enableMapEventListeners();
                _this._state.isActive = true;
                _this._state.isLoading = true;
                _this._state.isFollowing = true;
                _this._state.isRotating = false;
                _this.onGeolocationStateChange.next(_this._state);
                setInterval(function () {
                    var center = _this._configService.getMapCenter(), extent = _this._configService.getMapExtent();
                    var alt = Math.random() * 5000, lat = center[1], lng = center[0], acc = 5 + Math.random() * 100, speed = 1 + Math.random() * 50, bearing = Math.random() * 360;
                    if (_this._currentLocation) {
                        alt = Math.max(10, _this._currentLocation.altitude + (-25 + Math.random() * 50));
                        lat = Math.max(extent[1], Math.min(extent[3], _this._currentLocation.latitude + (-0.0001 + Math.random() / 5000)));
                        lng = Math.max(extent[0], Math.min(extent[2], _this._currentLocation.longitude + (-0.0001 + Math.random() / 5000)));
                        if (!_this._currentLocation.bearing || Number.isNaN(_this._currentLocation.bearing))
                            bearing = 0;
                        else
                            bearing = _this._currentLocation.bearing + (-10 + Math.random() * 20);
                    }
                    _this._locationUpdate({
                        altitude: alt,
                        latitude: lat,
                        longitude: lng,
                        id: 1,
                        accuracy: acc,
                        time: Date.now(),
                        speed: speed,
                        locationProvider: undefined,
                        provider: undefined,
                        bearing: bearing
                    });
                }, 2000);
            }
            resolve(_this._state);
        });
    };
    /**
     * Stop the geolocation (hide from map and prevent position update)
     */
    GeolocationService.prototype._stop = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this._disableMapEventListeners();
            _this._toggleFollow(false);
            _this._toggleRotation(false);
            _this._state.isActive = false;
            _this._state.isLoading = false;
            _this._state.isFollowing = false;
            _this._state.isRotating = false;
            _this.onGeolocationStateChange.next(_this._state);
            resolve(_this._state);
        });
    };
    /**
     * Perform the geolocation state switch
     * States available
     *   1. active, not following and not rotating
     *   2. active, following and not rotating
     *   3. active, following and rotating
     *
     * Default switch:
     *   1 => 2
     *   2 => 3
     *   3 => 2
     *
     * @param goal the goal state if needed
     */
    GeolocationService.prototype._switchState = function (goal) {
        if (goal) {
            if (goal.isFollowing !== this._state.isFollowing ||
                goal.isRotating !== this._state.isRotating) {
                if (goal.isRotating) {
                    this._toggleFollow(true);
                    this._toggleRotation(true);
                }
                // isRotating || !isFollowing
                else if (goal.isFollowing) {
                    this._toggleFollow(true);
                    this._toggleRotation(false);
                }
                else {
                    this._toggleFollow(false);
                    this._toggleRotation(false);
                }
            }
        }
        else {
            if (this._state.isLoading) {
                //Do nothing
            }
            else if (!this._state.isFollowing)
                this._toggleFollow(true);
            else if (!this._state.isRotating)
                this._toggleRotation(true);
            else
                this._toggleRotation(false);
        }
        this.onGeolocationStateChange.next(this._state);
    };
    /**
     * Cycle between the geolocation state (following - rotating - nothing).
     *
     * States available
     *   1. active, not following and not rotating
     *   2. active, following and not rotating
     *   3. active, following and rotating
     *
     * Default switch:
     *   1 => 2
     *   2 => 3
     *   3 => 2
     *
     * @param goal allow to specify the goal state
     */
    GeolocationService.prototype.switchState = function (goal, forceStart) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            if (!_this._state.isActive) {
                _this._start(forceStart).then(function () {
                    _this._switchState(goal);
                    resolve(_this._state);
                }, function (error) {
                    reject(error);
                });
            }
            else {
                _this._switchState(goal);
                resolve(_this._state);
            }
        });
    };
    /**
     * Toggle the follow of the position in the map
     */
    GeolocationService.prototype._toggleFollow = function (enable) {
        if (!this._state.isFollowing && (enable || typeof enable === 'undefined')) {
            this._state.isFollowing = true;
            if (this._currentLocation && this._currentLocation.latitude && this._currentLocation.longitude)
                this._mapService.centerOnCoords(this._currentLocation);
        }
        else if (this._state.isFollowing && (!enable || typeof enable === 'undefined'))
            this._state.isFollowing = false;
    };
    /**
     * Toggle the rotation of the map based on compass
     */
    GeolocationService.prototype._toggleRotation = function (enable) {
        if (!this._state.isRotating && (enable || typeof enable === 'undefined')) {
            this._state.isRotating = true;
            if (this._currentLocation && this._currentLocation.bearing && this._currentLocation.speed && this._currentLocation.speed > _constants__WEBPACK_IMPORTED_MODULE_9__["MIN_SPEED_FOR_GPS_BEARING"])
                this._toggleRotationType('gps');
            else
                this._toggleRotationType('compass');
        }
        else if (this._state.isRotating && (!enable || typeof enable === 'undefined')) {
            if (this._rotationSwitchTimeout) {
                clearTimeout(this._rotationSwitchTimeout);
                this._rotationSwitchTimeout = undefined;
                this._toggleRotationType('compass');
                this._useGpsBearing = false;
            }
            this._state.isRotating = false;
            this._mapService.rotate(0, 500);
            this._toggleCompassRotation(false);
        }
    };
    /**
     * Toggle the compass interval
     *
     * @param enable true if compass need to be active
     */
    GeolocationService.prototype._toggleCompassRotation = function (enable) {
        var _this = this;
        if (enable || typeof enable === 'undefined') {
            if (typeof this._rotationWatch === 'undefined' || typeof this._rotationWatch.unsubscribe !== 'function') {
                this._rotationWatch = this._deviceService.onCompassOrientationChange()
                    .subscribe(function (orientation) {
                    _this._mapService.rotate(-orientation.trueHeading, 300);
                });
            }
        }
        else if (!enable || typeof enable === 'undefined') {
            if (typeof this._rotationWatch !== 'undefined' && typeof this._rotationWatch.unsubscribe === 'function') {
                this._rotationWatch.unsubscribe();
                this._rotationWatch = undefined;
            }
        }
    };
    /**
     * Check when rotation type need to be switched
     *
     * @param newLocation the new location
     */
    GeolocationService.prototype._handleRotationSwitch = function (newLocation) {
        var _this = this;
        if (newLocation.speed > _constants__WEBPACK_IMPORTED_MODULE_9__["MIN_SPEED_FOR_GPS_BEARING"] && newLocation.bearing) {
            if (!this._useGpsBearing) //first valid position: keep compass
                this._useGpsBearing = true;
            else { //valid position confirmation: change to gps
                if (typeof this._rotationSwitchTimeout === 'undefined')
                    this._toggleRotationType('gps');
                this._mapService.rotate(-newLocation.bearing, 600);
                if (this._rotationSwitchTimeout)
                    clearTimeout(this._rotationSwitchTimeout);
                this._rotationSwitchTimeout = setTimeout(function () {
                    _this._toggleRotationType('compass');
                    _this._useGpsBearing = false;
                    _this._rotationSwitchTimeout = undefined;
                }, _constants__WEBPACK_IMPORTED_MODULE_9__["COMPASS_ROTATION_TIMEOUT"]);
            }
        }
        else {
            if (this._rotationSwitchTimeout)
                this._mapService.rotate(-newLocation.bearing, 600);
        }
    };
    /**
     * Perform the switch between the available rotation type
     *
     * @param type can be 'compass' or 'gps'. default 'compass'
     */
    GeolocationService.prototype._toggleRotationType = function (type) {
        switch (type) {
            case 'gps':
                this._toggleCompassRotation(false);
                break;
            case 'compass':
            default:
                this._toggleCompassRotation(true);
                break;
        }
    };
    GeolocationService = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [_ionic_angular__WEBPACK_IMPORTED_MODULE_1__["AlertController"],
            _config_service__WEBPACK_IMPORTED_MODULE_7__["ConfigService"],
            _device_service__WEBPACK_IMPORTED_MODULE_3__["DeviceService"],
            _ionic_native_geolocation_ngx__WEBPACK_IMPORTED_MODULE_10__["Geolocation"],
            _map_service__WEBPACK_IMPORTED_MODULE_2__["MapService"],
            _angular_core__WEBPACK_IMPORTED_MODULE_0__["NgZone"],
            _ionic_angular__WEBPACK_IMPORTED_MODULE_1__["Platform"],
            _ngx_translate_core__WEBPACK_IMPORTED_MODULE_5__["TranslateService"]])
    ], GeolocationService);
    return GeolocationService;
}());



/***/ }),

/***/ "./src/app/services/languages.service.ts":
/*!***********************************************!*\
  !*** ./src/app/services/languages.service.ts ***!
  \***********************************************/
/*! exports provided: LanguagesService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "LanguagesService", function() { return LanguagesService; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");
/* harmony import */ var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @ngx-translate/core */ "./node_modules/@ngx-translate/core/fesm5/ngx-translate-core.js");
/* harmony import */ var _storage_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./storage.service */ "./src/app/services/storage.service.ts");
/* harmony import */ var _config_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./config.service */ "./src/app/services/config.service.ts");
/**
 * Languages Service
 *
 * It provides all the languages feature based on the app configuration,
 * such as default language, current language in use. It also handle the
 * tranlate service (ngx-translate) initialization. The translations are
 * available using the TranslateService
 *
 * */
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};





var LanguagesService = /** @class */ (function () {
    function LanguagesService(_translateService, _storageService, _configService) {
        this._translateService = _translateService;
        this._storageService = _storageService;
        this._configService = _configService;
        this._currentLang$ = new rxjs__WEBPACK_IMPORTED_MODULE_1__["ReplaySubject"](1);
        this._initTranslate();
    }
    /**
     * Initialize the translations and select the language
     */
    LanguagesService.prototype._initTranslate = function () {
        var _this = this;
        this._defaultLang = this._configService.getDefaultLanguage();
        this._available = this._configService.getAvailableLanguages();
        this._translateService.setDefaultLang('en');
        this._storageService.getLanguage().then(function (lang) {
            // First - previously set language
            if (_this.isAvailable(lang)) {
                _this._translateService.use(lang);
                _this._currentLang = lang;
            }
            // Second - browser language
            else if (_this._translateService.getBrowserLang() !== undefined &&
                _this.isAvailable(_this._translateService.getBrowserLang())) {
                _this._translateService.use(_this._translateService.getBrowserLang());
                _this._currentLang = _this._translateService.getBrowserLang().substring(0, 2);
            }
            // Third - default language
            else {
                _this._translateService.use(_this._defaultLang);
                _this._currentLang = _this._defaultLang;
            }
            _this._currentLang$.next(_this._currentLang);
            _this._storageService.setLanguage(_this._currentLang);
        });
    };
    /**
     * Allow to change the app language
     *
     * @param lang string of at least two chars that represent the language to switch
     */
    LanguagesService.prototype.changeLanguage = function (lang) {
        lang = lang.substring(0, 2);
        if (this.isAvailable(lang)) {
            this._translateService.use(lang);
            this._currentLang = lang;
            this._storageService.setLanguage(this._currentLang);
            this._currentLang$.next(this._currentLang);
        }
    };
    /**
     * If lang is available return true
     *
     * @param lang the language to look for
     */
    LanguagesService.prototype.isAvailable = function (lang) {
        if (typeof lang === 'undefined' || lang === null || lang === '' || lang.length < 2)
            return false;
        for (var _i = 0, _a = this._available; _i < _a.length; _i++) {
            var i = _a[_i];
            if (i === lang.substring(0, 2))
                return true;
        }
        return false;
    };
    /**
     * Return the default language
     */
    LanguagesService.prototype.getDefaultLang = function () {
        return this._defaultLang;
    };
    /**
     * Trigger on current language change
     */
    LanguagesService.prototype.onCurrentLangChange = function () {
        return this._currentLang$;
    };
    /**
     * Return the current language
     */
    LanguagesService.prototype.getCurrentLang = function () {
        return this._currentLang;
    };
    LanguagesService = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [_ngx_translate_core__WEBPACK_IMPORTED_MODULE_2__["TranslateService"],
            _storage_service__WEBPACK_IMPORTED_MODULE_3__["StorageService"],
            _config_service__WEBPACK_IMPORTED_MODULE_4__["ConfigService"]])
    ], LanguagesService);
    return LanguagesService;
}());



/***/ }),

/***/ "./src/app/services/map.service.ts":
/*!*****************************************!*\
  !*** ./src/app/services/map.service.ts ***!
  \*****************************************/
/*! exports provided: MapService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MapService", function() { return MapService; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! rxjs/operators */ "./node_modules/rxjs/_esm5/operators/index.js");
/* harmony import */ var ol_extent__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ol/extent */ "./node_modules/ol/extent.js");
/* harmony import */ var ol_source_UTFGrid__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ol/source/UTFGrid */ "./node_modules/ol/source/UTFGrid.js");
/* harmony import */ var ol_interaction__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ol/interaction */ "./node_modules/ol/interaction.js");
/* harmony import */ var ol_sphere_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ol/sphere.js */ "./node_modules/ol/sphere.js");
/* harmony import */ var ol_proj__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ol/proj */ "./node_modules/ol/proj.js");
/* harmony import */ var ol_geom_Circle__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ol/geom/Circle */ "./node_modules/ol/geom/Circle.js");
/* harmony import */ var ol_Feature__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ol/Feature */ "./node_modules/ol/Feature.js");
/* harmony import */ var ol_style_Fill__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ol/style/Fill */ "./node_modules/ol/style/Fill.js");
/* harmony import */ var ol_format_Geojson__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ol/format/Geojson */ "./node_modules/ol/format/Geojson.js");
/* harmony import */ var ol_style_Icon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ol/style/Icon */ "./node_modules/ol/style/Icon.js");
/* harmony import */ var ol_geom_LineString__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ol/geom/LineString */ "./node_modules/ol/geom/LineString.js");
/* harmony import */ var ol_Map__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ol/Map */ "./node_modules/ol/Map.js");
/* harmony import */ var ol_Overlay__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ol/Overlay */ "./node_modules/ol/Overlay.js");
/* harmony import */ var ol_OverlayPositioning__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ol/OverlayPositioning */ "./node_modules/ol/OverlayPositioning.js");
/* harmony import */ var ol_geom_Point__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ol/geom/Point */ "./node_modules/ol/geom/Point.js");
/* harmony import */ var ol_control_Rotate__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ol/control/Rotate */ "./node_modules/ol/control/Rotate.js");
/* harmony import */ var ol_control_Scaleline__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ol/control/Scaleline */ "./node_modules/ol/control/Scaleline.js");
/* harmony import */ var ol_style_Stroke__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ol/style/Stroke */ "./node_modules/ol/style/Stroke.js");
/* harmony import */ var ol_style_Style__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ol/style/Style */ "./node_modules/ol/style/Style.js");
/* harmony import */ var ol_source_TileJSON__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ol/source/TileJSON */ "./node_modules/ol/source/TileJSON.js");
/* harmony import */ var ol_layer_Tile__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ol/layer/Tile */ "./node_modules/ol/layer/Tile.js");
/* harmony import */ var ol_TileState__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ol/TileState */ "./node_modules/ol/TileState.js");
/* harmony import */ var ol_layer_Vector__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ol/layer/Vector */ "./node_modules/ol/layer/Vector.js");
/* harmony import */ var ol_source_Vector__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ol/source/Vector */ "./node_modules/ol/source/Vector.js");
/* harmony import */ var ol_View__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ol/View */ "./node_modules/ol/View.js");
/* harmony import */ var ol_source_XYZ__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ol/source/XYZ */ "./node_modules/ol/source/XYZ.js");
/* harmony import */ var ol_control_Zoom__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ol/control/Zoom */ "./node_modules/ol/control/Zoom.js");
/* harmony import */ var proj4__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! proj4 */ "./node_modules/proj4/lib/index.js");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../constants */ "./src/app/constants.ts");
/* harmony import */ var _classes_clocation__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../classes/clocation */ "./src/app/classes/clocation.ts");
/* harmony import */ var _config_service__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./config.service */ "./src/app/services/config.service.ts");
/* harmony import */ var _device_service__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./device.service */ "./src/app/services/device.service.ts");
/* harmony import */ var _model_service__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./model.service */ "./src/app/services/model.service.ts");
/* harmony import */ var _router_service__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./router.service */ "./src/app/services/router.service.ts");
/* harmony import */ var _theme_service__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./theme.service */ "./src/app/services/theme.service.ts");
/**
 * Map Service
 *
 * It control the map, it's initialization and it's status. Provide a way to
 * retrieve and change the map status
 *
 *     LAYER        | Z-INDEX
 * basemap          |     1
 * maptile          |    10
 * utfgrid          |    20
 * fixedDataLayer   |    40
 * dataLayer        |    50
 * customTrack      |   100
 * Polygon          |   110
 * Track            |   130
 * Point            |   150
 * location         |   400
 * selected Polygon |   350
 * selected Track   |   350
 * selected Point   |   450
 * */
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};






 // Throws problems importing normally































var MapService = /** @class */ (function () {
    function MapService(_deviceService, _configService, _modelService, _routerService, _themeService) {
        var _this = this;
        this._deviceService = _deviceService;
        this._configService = _configService;
        this._modelService = _modelService;
        this._routerService = _routerService;
        this._themeService = _themeService;
        this._isReady = false;
        this.onReady = new rxjs__WEBPACK_IMPORTED_MODULE_1__["ReplaySubject"](1);
        this.onReady.next(this._isReady);
        this.onDrag = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onZoom = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onClick = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onPopupChange = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onRotateReset = new _angular_core__WEBPACK_IMPORTED_MODULE_0__["EventEmitter"]();
        this.onTaxonomyFiltersChange = new rxjs__WEBPACK_IMPORTED_MODULE_1__["ReplaySubject"](1);
        this._geolocationIcon = {
            layer: null,
            location: null,
            accuracy: null,
            point: null,
            circle: null,
            icon: "locationIcon"
        };
        this._locationIconArrow = new ol_style_Icon__WEBPACK_IMPORTED_MODULE_12__["default"]({
            src: '/wp-content/plugins/wm-embedmaps/assets/js/core/assets/images/location-icon-arrow.png',
            scale: 0.33,
            size: [125, 125],
            rotateWithView: false
        });
        this._locationIconStyle = new ol_style_Style__WEBPACK_IMPORTED_MODULE_21__["default"]({
            image: new ol_style_Icon__WEBPACK_IMPORTED_MODULE_12__["default"]({
                src: '/wp-content/plugins/wm-embedmaps/assets/js/core/assets/images/location-icon.png',
                scale: 0.29,
                size: [125, 125]
            }),
            zIndex: 600
        });
        this._locationIconArrowStyle = new ol_style_Style__WEBPACK_IMPORTED_MODULE_21__["default"]({
            image: this._locationIconArrow,
            zIndex: 600
        });
        this._isInteractive = true;
        this._gridLayers = {};
        Object(rxjs__WEBPACK_IMPORTED_MODULE_1__["combineLatest"])(this.onReady, this._routerService.onQueryParamsChange)
            .pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["filter"])(function (_a) {
            var ready = _a[0];
            return ready;
        }), Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["take"])(1))
            .subscribe(function () {
            var coords = _this._configService.getMapCenter();
            if (coords)
                _this.centerOnCoords(new _classes_clocation__WEBPACK_IMPORTED_MODULE_32__["CLocation"](coords[0], coords[1]), _this._configService.getMapDefZoom() || _constants__WEBPACK_IMPORTED_MODULE_31__["MAP_DEF_ZOOM"]);
        });
    }
    MapService.prototype._toLonLat = function (coordinates) {
        return Object(ol_proj__WEBPACK_IMPORTED_MODULE_7__["transform"])(coordinates, 'EPSG:3857', 'EPSG:4326');
    };
    MapService.prototype._fromLonLat = function (coordinates) {
        return Object(ol_proj__WEBPACK_IMPORTED_MODULE_7__["transform"])(coordinates, 'EPSG:4326', 'EPSG:3857');
    };
    MapService.prototype._extentToLonLat = function (extent) {
        return Object(ol_proj__WEBPACK_IMPORTED_MODULE_7__["transformExtent"])(extent, 'EPSG:3857', 'EPSG:4326');
    };
    MapService.prototype._extentFromLonLat = function (extent) {
        return Object(ol_proj__WEBPACK_IMPORTED_MODULE_7__["transformExtent"])(extent, 'EPSG:4326', 'EPSG:3857');
    };
    MapService.prototype.getUTMCoords = function (location) {
        var etrs89projection = "+proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs ";
        var etrs89coords = Object(proj4__WEBPACK_IMPORTED_MODULE_30__["default"])(etrs89projection, [location.longitude, location.latitude]);
        etrs89coords[0] = Math.round(etrs89coords[0]);
        etrs89coords[1] = Math.round(etrs89coords[1]);
        return etrs89coords;
    };
    MapService.prototype._getBaseSource = function (layer) {
        var _this = this;
        var tilesUrl = layer.tilesUrl;
        if (tilesUrl[tilesUrl.length - 1] !== '/')
            tilesUrl += '/';
        return new ol_source_XYZ__WEBPACK_IMPORTED_MODULE_28__["default"]({
            maxZoom: 21,
            minZoom: 1,
            tileLoadFunction: function (tile, url) {
                var coords = [0, 0, 0];
                var tmp = url.split('/');
                coords[0] = parseInt(tmp[tmp.length - 3]);
                coords[1] = parseInt(tmp[tmp.length - 2]);
                coords[2] = -parseInt(tmp[tmp.length - 1].split('.')[0]);
                _this._modelService.getTile(coords, tilesUrl).then(function (tileString) {
                    if (layer.grayscale || layer.opacity) {
                        var canvas_1 = document.createElement('canvas'), ctx_1 = canvas_1.getContext('2d'), img_1 = new Image(), grayscalePercentage_1 = layer.grayscale
                            ? (layer.grayscale > 1
                                ? Math.max(0, Math.min(1, layer.grayscale / 100))
                                : Math.max(0, Math.min(1, layer.grayscale)))
                            : 0, opacityPercentage_1 = layer.opacity
                            ? (layer.opacity > 1
                                ? Math.max(0, Math.min(1, layer.opacity / 100))
                                : Math.max(0, Math.min(1, layer.opacity)))
                            : 1;
                        img_1.onload = function () {
                            canvas_1.width = 256;
                            canvas_1.height = 256;
                            ctx_1.drawImage(img_1, 0, 0);
                            var imgData = ctx_1.getImageData(0, 0, 256, 256);
                            for (var i = 0; i + 3 < imgData.data.length; i += 4) {
                                if (grayscalePercentage_1 !== 0) {
                                    var red = imgData.data[i], green = imgData.data[i + 1], blue = imgData.data[i + 2];
                                    var lightness = Math.round(red * 0.3 + green * 0.59 + blue * 0.11);
                                    imgData.data[i] = lightness + (red - lightness) * grayscalePercentage_1;
                                    imgData.data[i + 1] = lightness + (green - lightness) * grayscalePercentage_1;
                                    imgData.data[i + 2] = lightness + (blue - lightness) * grayscalePercentage_1;
                                }
                                if (opacityPercentage_1 !== 1)
                                    imgData.data[i + 3] = 256 * opacityPercentage_1;
                            }
                            ctx_1.putImageData(imgData, 0, 0);
                            tile.getImage().src = canvas_1.toDataURL();
                        };
                        img_1.crossOrigin = "Anonymous";
                        img_1.src = tileString;
                    }
                    else
                        tile.getImage().src = tileString;
                }).catch(function (err) {
                    console.error(err);
                    tile.getImage().src = url;
                });
            },
            tileUrlFunction: function (c) {
                return tilesUrl + c[0] + '/' + c[1] + '/' + c[2] + '.png';
            },
            projection: 'EPSG:3857'
        });
    };
    MapService.prototype._initializeBaseLayers = function () {
        var layers = this._configService.getBaseLayers();
        var defaultSet = false;
        // return;
        for (var i in layers) {
            this._map.addLayer(new ol_layer_Tile__WEBPACK_IMPORTED_MODULE_23__["default"]({
                source: this._getBaseSource(layers[i]),
                visible: layers[i].default && !defaultSet ? true : false,
                zIndex: 1
            }));
            if (layers[i].default && !defaultSet)
                defaultSet = true;
        }
        if (!defaultSet)
            this._map.getLayers().getArray()[0].setVisible(true);
    };
    MapService.prototype._initializeOverlayLayer = function (overlay) {
        var _this = this;
        var tilesUrl, layer;
        switch (overlay.type) {
            case 'utfgrid':
                tilesUrl = overlay.tilesUrl;
                if (tilesUrl[tilesUrl.length - 1] !== '/')
                    tilesUrl += '/';
                layer = new ol_layer_Tile__WEBPACK_IMPORTED_MODULE_23__["default"]({
                    source: new ol_source_TileJSON__WEBPACK_IMPORTED_MODULE_22__["default"]({
                        tileJSON: {
                            tiles: [tilesUrl + '{z}/{x}/{y}.png'],
                            grids: [tilesUrl + '{z}/{x}/{y}.grid.json'],
                            minzoom: overlay.minZoom ? overlay.minZoom : this._configService.getMapMinZoom(),
                            maxzoom: overlay.maxZoom ? overlay.maxZoom : this._configService.getMapMaxZoom()
                        },
                        tileLoadFunction: function (tile, url) {
                            var coords = [0, 0, 0];
                            var tmp = url.split('/');
                            coords[0] = parseInt(tmp[tmp.length - 3]);
                            coords[1] = parseInt(tmp[tmp.length - 2]);
                            coords[2] = parseInt(tmp[tmp.length - 1].split('.')[0]) + 1;
                            _this._modelService.getTile(coords, tilesUrl, overlay.id).then(function (tileString) {
                                tile.getImage().src = tileString;
                            }).catch(function () {
                                tile.getImage().src = url;
                            });
                        }
                    }),
                    visible: true,
                    zIndex: 20
                });
                this._map.addLayer(layer);
                this._gridLayers[overlay.id] = layer;
                break;
            case 'maptile':
                tilesUrl = overlay.tilesUrl;
                if (tilesUrl[tilesUrl.length - 1] !== '/')
                    tilesUrl += '/';
                layer = new ol_layer_Tile__WEBPACK_IMPORTED_MODULE_23__["default"]({
                    source: new ol_source_XYZ__WEBPACK_IMPORTED_MODULE_28__["default"]({
                        tileLoadFunction: function (tile, url) {
                            var coords = [0, 0, 0];
                            var tmp = url.split('/');
                            coords[0] = parseInt(tmp[tmp.length - 3]);
                            coords[1] = parseInt(tmp[tmp.length - 2]);
                            coords[2] = -parseInt(tmp[tmp.length - 1].split('.')[0]);
                            _this._modelService.getTile(coords, tilesUrl, overlay.id).then(function (tileString) {
                                tile.getImage().src = tileString;
                            }).catch(function (err) {
                                console.error(err);
                                tile.getImage().src = url;
                            });
                        },
                        tileUrlFunction: function (c) {
                            return tilesUrl + c[0] + '/' + c[1] + '/' + c[2] + '.png';
                        },
                        projection: 'EPSG:3857',
                        minZoom: overlay.minZoom ? overlay.minZoom : this._configService.getMapMinZoom(),
                        maxZoom: overlay.maxZoom ? overlay.maxZoom : this._configService.getMapMaxZoom()
                    }),
                    visible: true,
                    zIndex: 10
                });
                this._map.addLayer(layer);
                break;
            default:
                break;
        }
    };
    MapService.prototype._initializeOverlayLayers = function () {
        for (var i_1 in this._gridLayers) {
            this._map.removeLayer(this._gridLayers[i_1]);
        }
        this._gridLayers = {};
        var layers = this._configService.getOverlayLayers();
        if (layers) {
            for (var i in layers) {
                this._initializeOverlayLayer(layers[i]);
            }
        }
    };
    /**
     * Return a grid object with the grid.json attributes corresponding to the requested coordinates
     *
     * @param coordinate the coordinates
     */
    MapService.prototype.getUTFGridInfo = function (coordinate) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            var promises = [], layers = _this._configService.getOverlayLayers();
            for (var i in layers) {
                if (_this._gridLayers[layers[i].id]) {
                    var coord = _this._gridLayers[layers[i].id].getSource().getTileGrid().getTileCoordForCoordAndResolution(coordinate, _this._view.getResolution());
                    promises.push(_this._modelService.getGridJson([coord[0], coord[1], -coord[2]], layers[i].tilesUrl, layers[i].id));
                }
            }
            if (promises.length === 0) {
                resolve(undefined);
                return;
            }
            Promise.all(promises).then(function (values) {
                for (var i in layers) {
                    if (values[i]) {
                        var coord = _this._gridLayers[layers[i].id].getSource().getTileGrid().getTileCoordForCoordAndResolution(coordinate, _this._view.getResolution());
                        var tmp = new ol_source_UTFGrid__WEBPACK_IMPORTED_MODULE_4__["CustomTile"](coord, ol_TileState__WEBPACK_IMPORTED_MODULE_24__["default"].LOADED, layers[i].tilesUrl + coord[0] + '/' + coord[1] + '/' + -coord[2] + '.grid.json', _this._gridLayers[layers[i].id].getSource().getTileGrid().getTileCoordExtent(coord), true, false);
                        tmp.keys_ = values[i].keys;
                        tmp.data_ = values[i].data;
                        tmp.grid_ = values[i].grid;
                        var tile = tmp;
                        resolve(tile.getData(coordinate));
                        break;
                    }
                }
            }, function () {
                resolve(undefined);
            });
        });
    };
    /**
     * Initialize the map using the configuration prodvided
     */
    MapService.prototype.initialize = function () {
        var _this = this;
        if (this._configService.hasMap()) {
            var rotateIcon = document.createElement('ion-icon');
            var divRotateIcon = document.createElement('div');
            rotateIcon.setAttribute('name', 'compass');
            rotateIcon.setAttribute('mode', 'ios');
            rotateIcon.style.transform = 'rotate(-45deg)';
            divRotateIcon.appendChild(rotateIcon);
            var defZoom = this._configService.getMapDefZoom(), center = this._configService.getMapCenter();
            this._view = new ol_View__WEBPACK_IMPORTED_MODULE_27__["default"]({
                center: this._fromLonLat(center || _constants__WEBPACK_IMPORTED_MODULE_31__["MAP_DEF_CENTER"]),
                zoom: defZoom || _constants__WEBPACK_IMPORTED_MODULE_31__["MAP_DEF_ZOOM"],
                maxZoom: this._configService.getMapMaxZoom(),
                minZoom: this._configService.getMapMinZoom(),
                projection: 'EPSG:3857',
                extent: this._extentFromLonLat(this._configService.getMapExtent())
            });
            this._map = new ol_Map__WEBPACK_IMPORTED_MODULE_14__["default"]({
                target: 'map',
                view: this._view,
                controls: [
                    new ol_control_Zoom__WEBPACK_IMPORTED_MODULE_29__["default"](),
                    new ol_control_Rotate__WEBPACK_IMPORTED_MODULE_18__["default"]({
                        label: divRotateIcon,
                        autoHide: true,
                        resetNorth: function () {
                            _this.onRotateReset.emit();
                            _this.rotate(0, 500);
                        }
                    }),
                    new ol_control_Scaleline__WEBPACK_IMPORTED_MODULE_19__["default"]({
                        units: 'metric',
                        minWidth: 50
                    })
                ],
                interactions: Object(ol_interaction__WEBPACK_IMPORTED_MODULE_5__["defaults"])({
                    mouseWheelZoom: this._deviceService.isLocalServer || window.location.hostname === _constants__WEBPACK_IMPORTED_MODULE_31__["WEBAPP_HOST"] ? true : false
                }),
                moveTolerance: 3,
                loadTilesWhileAnimating: true,
                loadTilesWhileInteracting: this._deviceService.isBrowser ? true : false
            });
            this._initializeBaseLayers();
            this._initializeOverlayLayers();
            this._map.on('pointerdrag', function (event) {
                var tmp = event;
                _this.onDrag.emit(tmp.coordinate);
            });
            this._deviceService.onResize
                .pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["auditTime"])(30))
                .subscribe(function () {
                _this.adjust();
            });
            this._view.on('change:resolution', function (event) {
                var tmp = event;
                _this.onZoom.emit(tmp.target.values_);
            });
            this._dataSource = new ol_source_Vector__WEBPACK_IMPORTED_MODULE_26__["default"]({
                format: new ol_format_Geojson__WEBPACK_IMPORTED_MODULE_11__["default"]()
            });
            this._dataLayer = new ol_layer_Vector__WEBPACK_IMPORTED_MODULE_25__["default"]({
                source: this._dataSource,
                style: function (feature, resolution) {
                    return _this._style(feature);
                },
                updateWhileAnimating: true,
                updateWhileInteracting: true,
                zIndex: 50
            });
            this._modelService.onReady
                .pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["filter"])(function (ready) { return ready; }), Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["take"])(1))
                .subscribe(function () {
                _this._modelService.getFeatures()
                    .pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["debounceTime"])(400))
                    .subscribe(function (features) {
                    if (Object.keys(features).length)
                        _this._updateFeatures(features);
                });
                _this._modelService.getTaxonomies()
                    .pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["debounceTime"])(400))
                    .subscribe(function (taxonomies) {
                    var filt = {};
                    for (var i in taxonomies) {
                        for (var j in taxonomies[i]) {
                            filt[j] = _this._taxonomyFilters && typeof _this._taxonomyFilters[j] !== 'undefined' ? _this._taxonomyFilters[j] : true;
                        }
                    }
                    _this._taxonomyFilters = filt;
                    _this.onTaxonomyFiltersChange.next(_this._taxonomyFilters);
                });
            });
            this._map.addLayer(this._dataLayer);
            this._map.on('click', function (event) {
                if (_this._previousClickTimeout) {
                    clearInterval(_this._previousClickTimeout);
                    _this._previousClickTimeout = undefined;
                    return;
                }
                else {
                    _this._previousClickTimeout = setTimeout(function () {
                        if (_this._isInteractive) {
                            _this._checkFeatureClick(event);
                        }
                        _this._previousClickTimeout = undefined;
                    }, 250);
                }
            });
            this._configService.onMapConfigChange.subscribe(function () {
                _this._view = new ol_View__WEBPACK_IMPORTED_MODULE_27__["default"]({
                    center: _this._fromLonLat(_this._configService.getMapCenter() || _constants__WEBPACK_IMPORTED_MODULE_31__["MAP_DEF_CENTER"]),
                    zoom: _this._configService.getMapDefZoom() || _constants__WEBPACK_IMPORTED_MODULE_31__["MAP_DEF_ZOOM"],
                    maxZoom: _this._configService.getMapMaxZoom(),
                    minZoom: _this._configService.getMapMinZoom(),
                    projection: 'EPSG:3857',
                    extent: _this._extentFromLonLat(_this._configService.getMapExtent())
                });
                _this._initializeOverlayLayers();
                _this._map.setView(_this._view);
                _this._map.render();
            });
            this._deviceService.onResize.subscribe(function () {
                _this.adjust();
            });
        }
    };
    /**
     * Return the distance in meters between two locations
     *
     * @param point1 the first location
     * @param point2 the second location
     */
    MapService.prototype.getDistanceBetweenPoints = function (point1, point2) {
        var R = 6371e3;
        var lat1 = point1.latitude * Math.PI / 180;
        var lat2 = point2.latitude * Math.PI / 180;
        var lon1 = point1.longitude * Math.PI / 180;
        var lon2 = point2.longitude * Math.PI / 180;
        var dlat = lat2 - lat1;
        var dlon = lon2 - lon1;
        var a = Math.sin(dlat / 2) * Math.sin(dlat / 2) +
            Math.cos(lat1) * Math.cos(lat2) *
                Math.sin(dlon / 2) * Math.sin(dlon / 2);
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c;
    };
    /**
     * Return a value for the distance between the two point using a screen-fixed unit
     *
     * @param point1 the first location
     * @param point2 the second location
     */
    MapService.prototype.getFixedDistance = function (point1, point2) {
        return Object(ol_sphere_js__WEBPACK_IMPORTED_MODULE_6__["getDistance"])([point1.longitude, point1.latitude], [point2.longitude, point2.latitude]) / this._view.getResolution();
    };
    /**
     * Return the distance in meters between the specified point and the current location
     *
     * @param point the first location
     */
    MapService.prototype.getDistanceFromLocation = function (point) {
        if (this._geolocationIcon.point) {
            var coordinates = this._geolocationIcon.point.getCoordinates();
            coordinates = this._toLonLat(coordinates);
            return this.getDistanceBetweenPoints(point, new _classes_clocation__WEBPACK_IMPORTED_MODULE_32__["CLocation"](coordinates[0], coordinates[1]));
        }
        else
            return -1;
    };
    MapService.prototype._triggerMapClick = function () {
        if (!this._deviceService.isLgScreen) {
            if (typeof this._selectedFeatureId !== 'undefined')
                this.deselectFeature();
            else {
                this.onClick.emit();
                this.showPopup();
            }
        }
        else {
            if (typeof this._selectedFeatureId !== 'undefined')
                this.deselectFeature();
            this.onClick.emit();
        }
    };
    MapService.prototype._triggerUtfGridClick = function (info) {
        for (var i in this._gridLayers) {
            if (this._features[i + '-' + info.id]) {
                this.selectFeature(i + '-' + info.id, !this._features[i + '-' + info.id].properties.noInteraction);
                break;
            }
        }
    };
    MapService.prototype._checkFeatureClick = function (event) {
        var _this = this;
        var coordinate = this._map.getEventCoordinate(event.originalEvent);
        this.getUTFGridInfo(coordinate).then(function (utfgridInfo) {
            var minPoiDistance = 15, minTrackDistance = 15, minPolygonArea, poi, track, polygon;
            _this._dataSource.forEachFeature(function (feature) {
                if (_this._features[feature.getId() + ''].properties.noInteraction)
                    return;
                if (feature.getGeometry().getType() === 'Point') {
                    var coord = feature.getGeometry().getCoordinates(), l1 = new _classes_clocation__WEBPACK_IMPORTED_MODULE_32__["CLocation"](_this._toLonLat(coord)[0], _this._toLonLat(coord)[1]), l2 = new _classes_clocation__WEBPACK_IMPORTED_MODULE_32__["CLocation"](_this._toLonLat(event.coordinate)[0], _this._toLonLat(event.coordinate)[1]), dist = _this.getFixedDistance(l1, l2);
                    if (dist < minPoiDistance) {
                        minPoiDistance = dist;
                        poi = feature;
                    }
                }
                else if (!poi && feature.getGeometry().getType() === 'LineString' || feature.getGeometry().getType() === 'MultiLineString') {
                    var coord = void 0;
                    if (feature.getGeometry().getType() === 'LineString')
                        coord = feature.getGeometry().getClosestPoint(event.coordinate);
                    else
                        coord = feature.getGeometry().getClosestPoint(event.coordinate);
                    var l1 = new _classes_clocation__WEBPACK_IMPORTED_MODULE_32__["CLocation"](_this._toLonLat(coord)[0], _this._toLonLat(coord)[1]), l2 = new _classes_clocation__WEBPACK_IMPORTED_MODULE_32__["CLocation"](_this._toLonLat(event.coordinate)[0], _this._toLonLat(event.coordinate)[1]), dist = _this.getFixedDistance(l1, l2);
                    if (dist < minTrackDistance) {
                        minTrackDistance = dist;
                        track = feature;
                    }
                }
                else if (!poi && !track && feature.getGeometry().getType() === 'Polygon' || feature.getGeometry().getType() === 'MultiPolygon') {
                    var area = void 0, poly = void 0;
                    if (feature.getGeometry().getType() === 'Polygon')
                        poly = feature.getGeometry();
                    else
                        poly = feature.getGeometry();
                    if (poly.containsXY(event.coordinate[0], event.coordinate[1])) {
                        area = poly.getArea();
                        if (area < minPolygonArea || !minPolygonArea) {
                            minPolygonArea = area;
                            polygon = feature;
                        }
                    }
                }
            });
            if (poi)
                _this.selectFeature(poi.get('id'), true);
            else if (track)
                _this.selectFeature(track.get('id'), true);
            else if (utfgridInfo)
                _this._triggerUtfGridClick(utfgridInfo);
            else if (polygon)
                _this.selectFeature(polygon.get('id'), true);
            else
                _this._triggerMapClick();
        });
    };
    /**
     * Change the features shown in map
     *
     * @param features the new list of features
     */
    MapService.prototype._updateFeatures = function (features) {
        this._features = features;
        // Restore current selection
        if (this._selectedFeatureId && typeof features[this._selectedFeatureId] === 'undefined')
            this.deselectFeature();
        this._drawAllFeatures();
        if (!this._isReady) {
            this._isReady = true;
            this.onReady.next(this._isReady);
        }
    };
    /**
     * Draw all the current features, cleaning unexisting features
     */
    MapService.prototype._drawAllFeatures = function () {
        var _this = this;
        // Remove unwanted features
        if (this._fixedDataSource) {
            for (var _i = 0, _a = this._fixedDataSource.getFeatures(); _i < _a.length; _i++) {
                var feature = _a[_i];
                if (typeof this._features[feature.getId()] === 'undefined'
                    || !this._features[feature.getId()].properties.invert
                    || ['Polygon', 'MultiPolygon'].indexOf(this._features[feature.getId()].geometry.type) === -1)
                    this._fixedDataSource.removeFeature(feature);
            }
        }
        if (this._dataSource) {
            for (var _b = 0, _c = this._dataSource.getFeatures(); _b < _c.length; _b++) {
                var feature = _c[_b];
                if (typeof this._features[feature.getId()] === 'undefined'
                    || (this._features[feature.getId()].properties.invert && ['Polygon', 'MultiPolygon'].indexOf(this._features[feature.getId()].geometry.type) !== -1))
                    this._dataSource.removeFeature(feature);
            }
        }
        // Add/update existing features
        for (var id in this._features) {
            if (!this._features[id].properties.hide
                && !(this._features[id].properties.invert && ['Polygon', 'MultiPolygon'].indexOf(this._features[id].geometry.type) !== -1))
                this._addFeature(id, this._dataSource);
            else if (!this._features[id].properties.hide
                && this._features[id].properties.invert
                && ['Polygon', 'MultiPolygon'].indexOf(this._features[id].geometry.type) !== -1) {
                if (!this._fixedDataSource || !this._fixedDataLayer) {
                    this._fixedDataSource = new ol_source_Vector__WEBPACK_IMPORTED_MODULE_26__["default"]({
                        format: new ol_format_Geojson__WEBPACK_IMPORTED_MODULE_11__["default"]()
                    });
                    this._fixedDataLayer = new ol_layer_Vector__WEBPACK_IMPORTED_MODULE_25__["default"]({
                        source: this._fixedDataSource,
                        style: function (feature, resolution) {
                            return _this._style(feature);
                        },
                        updateWhileAnimating: true,
                        updateWhileInteracting: false,
                        zIndex: 40
                    });
                    this._map.addLayer(this._fixedDataLayer);
                }
                this._addFeature(id, this._fixedDataSource);
            }
        }
        if (typeof this._activeFeatures !== 'undefined')
            this.filterFeatures(this._activeFeatures);
    };
    /**
     * If the map has already been initialized it returns true
     */
    MapService.prototype.isInitialized = function () {
        return this._isReady;
    };
    /**
     * Make the map adapt when the container is moved
     */
    MapService.prototype.adjust = function () {
        if (this.isInitialized())
            this._map.updateSize();
    };
    /**
     * Change the container of the map
     * Do not use outside src/app/components/map/map-component.ts
     *
     * @param node the new container
     */
    MapService.prototype.moveContainer = function (node) {
        this._map.setTarget(node);
        this.adjust();
    };
    /**
     * Center the view of the map on the location at a specific zoom level
     *
     * @param location the desired location
     * @param zoom optional, the desired zoom (if not set use the current zoom)
     */
    MapService.prototype.centerOnCoords = function (location, zoom) {
        if (location
            && location.latitude && location.longitude
            && typeof location.latitude === 'number' && typeof location.longitude === 'number'
            && !Number.isNaN(location.latitude) && !Number.isNaN(location.longitude)) {
            this._view.animate({
                center: this._fromLonLat([location.longitude, location.latitude]),
                duration: 500,
                zoom: typeof zoom === 'number' ? Math.min(this._view.getMaxZoom(), Math.max(this._view.getMinZoom(), zoom)) : this._view.getZoom()
            });
        }
    };
    /**
     * Center the view of the map on a feature
     *
     * @param id the id of the feature to use as center
     */
    MapService.prototype.centerOnFeature = function (id, force) {
        if (force)
            this._view.cancelAnimations();
        if (this._dataSource.getFeatureById(id))
            this._view.fit(this._dataSource.getFeatureById(id).getGeometry().getExtent());
    };
    /**
     * Center the map to the extent of the current features layer
     */
    MapService.prototype.centerFeatureLayer = function () {
        if (this._dataSource.getFeatures().length > 0)
            this.fitExtent(this._extentToLonLat(this._dataSource.getExtent()));
    };
    /**
     * Center the map to the specified extent
     *
     * @param extent the extent to fit in lon/lat
     * @param padding the resulting padding
     * @param duration the duration of the animation
     */
    MapService.prototype.fitExtent = function (extent, padding, duration) {
        extent = this._extentFromLonLat(extent || this._configService.getMapExtent());
        padding = padding || _constants__WEBPACK_IMPORTED_MODULE_31__["MAP_DEF_FIT_PADDING"];
        duration = duration || _constants__WEBPACK_IMPORTED_MODULE_31__["MAP_DEF_ANIMATION_DURATION"];
        this._view.fit(extent, {
            padding: padding,
            duration: duration
        });
    };
    /**
     * Show in the map the current location using the blue circle and the semi-transparent accuracy circle
     *
     * @param location the location
     */
    MapService.prototype.setLocation = function (location) {
        var mapLocation = this._fromLonLat([location.longitude, location.latitude]);
        // Handle point
        if (!this._geolocationIcon.location) {
            this._geolocationIcon.location = new ol_Feature__WEBPACK_IMPORTED_MODULE_9__["default"]();
            this._geolocationIcon.point = new ol_geom_Point__WEBPACK_IMPORTED_MODULE_17__["default"](mapLocation);
            this._geolocationIcon.location.setGeometry(this._geolocationIcon.point);
            this._geolocationIcon.location.setStyle(this._locationIconStyle);
        }
        else
            this._geolocationIcon.point.setCoordinates(mapLocation);
        // Handle accuracy
        if (!this._geolocationIcon.accuracy) {
            this._geolocationIcon.accuracy = new ol_Feature__WEBPACK_IMPORTED_MODULE_9__["default"]();
            this._geolocationIcon.circle = new ol_geom_Circle__WEBPACK_IMPORTED_MODULE_8__["default"](mapLocation, location.accuracy);
            this._geolocationIcon.accuracy.setGeometry(this._geolocationIcon.circle);
        }
        else
            this._geolocationIcon.circle.setCenterAndRadius(mapLocation, location.accuracy);
        if (!this._geolocationIcon.layer) {
            this._geolocationIcon.layer = new ol_layer_Vector__WEBPACK_IMPORTED_MODULE_25__["default"]({
                source: new ol_source_Vector__WEBPACK_IMPORTED_MODULE_26__["default"]({
                    features: [this._geolocationIcon.location, this._geolocationIcon.accuracy]
                }),
                updateWhileAnimating: true,
                updateWhileInteracting: true,
                zIndex: 200
            });
            this._map.addLayer(this._geolocationIcon.layer);
        }
        // try to force location update
        this._geolocationIcon.location.changed();
        this._geolocationIcon.accuracy.changed();
        this._geolocationIcon.point.changed();
        this._geolocationIcon.circle.changed();
        this._geolocationIcon.layer.changed();
        this._map.render();
    };
    /**
     * Change the accuracy around the location visible in the map
     *
     * @param accuracy the accuracy of the position
     */
    MapService.prototype.setLocationAccuracy = function (accuracy) {
        if (!this._geolocationIcon.accuracy)
            return;
        if (typeof accuracy !== 'undefined')
            this._geolocationIcon.circle.setRadius(accuracy);
        else
            this._geolocationIcon.circle.setRadius(50); // Default precision
    };
    /**
     * Change the location icon visible in them map, between the circle and the arrow
     *
     * @param icon a string between 'location' and 'arrow'
     */
    MapService.prototype.toggleLocationIcon = function (icon) {
        if (this._geolocationIcon.location && (typeof icon === 'undefined' || (typeof icon === 'string' && icon !== this._geolocationIcon.icon))) {
            switch (this._geolocationIcon.icon) {
                case 'location':
                    this._geolocationIcon.location.setStyle(this._locationIconArrowStyle);
                    this._geolocationIcon.icon = 'arrow';
                    break;
                case 'arrow':
                default:
                    this._geolocationIcon.location.setStyle(this._locationIconStyle);
                    this._geolocationIcon.icon = 'location';
                    break;
            }
        }
    };
    /**
     * Remove the location marker from the map
     */
    MapService.prototype.removeLocation = function () {
        this._map.removeLayer(this._geolocationIcon.layer);
        this._geolocationIcon.layer = null;
        this._geolocationIcon.point = null;
        this._geolocationIcon.circle = null;
        this._geolocationIcon.location = null;
        this._geolocationIcon.accuracy = null;
        this._geolocationIcon.icon = 'location';
    };
    /**
     * Check if a specific location is inside the current extent
     *
     * @param location the location
     */
    MapService.prototype.isInsideExtent = function (location) {
        return this._map
            ? Object(ol_extent__WEBPACK_IMPORTED_MODULE_3__["containsCoordinate"])(this._extentFromLonLat(this._configService.getMapExtent()), this._fromLonLat([location.longitude, location.latitude]))
            : true;
    };
    /**
     * Rotate the map
     *
     * @param bearing the angle
     * @param duration the duration for the animation if the rotation should be animated
     */
    MapService.prototype.rotate = function (bearing, duration) {
        if (bearing && typeof bearing !== 'number' || Number.isNaN(bearing) || (bearing !== 0 && Math.abs(bearing - (this._view.getRotation() * 180 / Math.PI)) <= 10))
            return;
        if (typeof duration === 'undefined' || duration === 0)
            this._view.rotate(bearing * Math.PI / 180);
        else {
            this._view.animate({
                rotation: bearing * Math.PI / 180,
                duration: duration
            });
        }
    };
    /**
     * Return the current center of the map
     */
    MapService.prototype.getCenter = function () {
        var center = this._toLonLat(this._view.getCenter());
        return new _classes_clocation__WEBPACK_IMPORTED_MODULE_32__["CLocation"](center[0], center[1]);
    };
    /**
     * Return the current zoom of the map
     */
    MapService.prototype.getZoom = function () {
        return this._view.getZoom();
    };
    MapService.prototype._addIconOverlay = function (id) {
        if (this._map.getOverlayById('icon-' + id))
            return;
        var feature = this._dataSource.getFeatureById(id);
        if (feature.getGeometry().getType() === 'Point') {
            var icon = this._modelService.getFeatureIcon(id);
            if (icon !== '') {
                var element = void 0;
                if (icon.substring(0, 3) === 'wm-') {
                    element = document.createElement('i');
                    element.className = icon;
                    element.style.fontSize = '16px';
                    element.style.color = '#fff';
                    element.style.height = 'inherit';
                }
                else {
                    element = document.createElement('div');
                    var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg'), path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    path.setAttribute('d', icon.replace(' ', ','));
                    svg.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns', 'http://www.w3.org/2000/svg');
                    svg.setAttribute('viewBox', '0 0 512 512');
                    svg.setAttribute('width', '16px');
                    svg.setAttribute('height', '16px');
                    svg.appendChild(path);
                    document.body.appendChild(svg);
                    if (path.getBBox())
                        svg.setAttribute('viewBox', '0 0 ' + path.getBBox().width + ' ' + path.getBBox().height);
                    svg.remove();
                    element.appendChild(svg);
                    element.style.fill = '#fff';
                }
                element.style.zIndex = '500';
                element.style.position = 'relative';
                element.style.top = '1px';
                element.style.display = 'block';
                element.style.margin = '0';
                var coordinates = this._features[id].geometry.coordinates;
                this._map.addOverlay(new ol_Overlay__WEBPACK_IMPORTED_MODULE_15__["default"]({
                    id: 'icon-' + id,
                    element: element,
                    stopEvent: false,
                    autoPan: false,
                    position: this._fromLonLat(coordinates),
                    positioning: ol_OverlayPositioning__WEBPACK_IMPORTED_MODULE_16__["default"].CENTER_CENTER
                }));
            }
        }
    };
    MapService.prototype._removeIconOverlay = function (id) {
        if (this._map.getOverlayById('icon-' + id))
            this._map.removeOverlay(this._map.getOverlayById('icon-' + id));
    };
    MapService.prototype._style = function (feature) {
        if (typeof feature.getProperties()['minZoom'] === 'undefined' || this._view.getZoom() >= feature.getProperties()['minZoom']) {
            if (feature.getGeometry().getType() === 'Point')
                return this._getPoiStyle('' + feature.getId());
            else if (feature.getGeometry().getType() === 'LineString' || feature.getGeometry().getType() === 'MultiLineString')
                return this._getLineStyle('' + feature.getId());
            else if (feature.getGeometry().getType() === 'Polygon' || feature.getGeometry().getType() === 'MultiPolygon')
                return this._getPolygonStyle('' + feature.getId());
            else
                return [];
        }
        else
            return [];
    };
    /**
     * Return the style for the polygon
     *
     * @param id the feature id
     */
    MapService.prototype._getPolygonStyle = function (id) {
        var style = [], selected = false, feature = this._dataSource.getFeatureById(id)
            ? this._dataSource.getFeatureById(id)
            : (this._fixedDataSource.getFeatureById(id)
                ? this._fixedDataSource.getFeatureById(id)
                : undefined);
        if (!feature)
            return [new ol_style_Style__WEBPACK_IMPORTED_MODULE_21__["default"]()];
        var color = this._modelService.getFeatureColor(id), fillColor = this._modelService.getFeatureFillColor(id), fillOpacity = this._modelService.getFeatureFillOpacity(id), strokeWidth = this._modelService.getFeatureStrokeWidth(id), strokeOpacity = this._modelService.getFeatureStrokeOpacity(id);
        if ('' + this._selectedFeatureId === '' + id) {
            selected = true;
            fillOpacity = Math.min(1, fillOpacity + 0.1);
            strokeWidth = Math.min(5, strokeWidth + 2);
            strokeOpacity = Math.min(1, strokeOpacity + 0.1);
            color = this._themeService.getTertiaryColor();
        }
        fillColor = 'rgba(' + this._themeService.getRgb(fillColor) + ',' + fillOpacity + ')';
        color = 'rgba(' + this._themeService.getRgb(color) + ',' + strokeOpacity + ')';
        style.push(new ol_style_Style__WEBPACK_IMPORTED_MODULE_21__["default"]({
            fill: new ol_style_Fill__WEBPACK_IMPORTED_MODULE_10__["default"]({
                color: fillColor,
            }),
            stroke: new ol_style_Stroke__WEBPACK_IMPORTED_MODULE_20__["default"]({
                color: color,
                width: strokeWidth
            }),
            zIndex: selected ? 400 : 100
        }));
        return style;
    };
    /**
     * Return a style object for the specified tracks
     */
    MapService.prototype._getLineStyle = function (id) {
        var style = [], selected = false, feature = this._dataSource.getFeatureById(id)
            ? this._dataSource.getFeatureById(id)
            : undefined;
        if (!feature)
            return [new ol_style_Style__WEBPACK_IMPORTED_MODULE_21__["default"]()];
        var color = this._modelService.getFeatureColor(id), strokeWidth = this._modelService.getFeatureStrokeWidth(id), strokeOpacity = this._modelService.getFeatureStrokeOpacity(id);
        if ('' + this._selectedFeatureId === '' + id) {
            selected = true;
            strokeWidth = Math.min(5, strokeWidth + 2);
            strokeOpacity = Math.min(1, strokeOpacity + 0.1);
            color = this._themeService.getTertiaryColor();
        }
        color = 'rgba(' + this._themeService.getRgb(color) + ',' + strokeOpacity + ')';
        if (((typeof this._features[id].properties.showArrows === 'undefined' && this._configService.addArrowsOverTracks()) ||
            this._features[id].properties.showArrows === true) && this._view.getZoom() > 12)
            style = this._getArrowStyle(this._dataSource.getFeatureById(id), this._view.getResolution(), color, selected ? 410 : 110);
        style.push(new ol_style_Style__WEBPACK_IMPORTED_MODULE_21__["default"]({
            stroke: new ol_style_Stroke__WEBPACK_IMPORTED_MODULE_20__["default"]({
                color: color,
                width: strokeWidth
            }),
            zIndex: selected ? 400 : 100
        }));
        return style;
    };
    /**
     * Return a style object for the specified poi
     */
    MapService.prototype._getPoiStyle = function (id) {
        var style, selected = false, color = this._modelService.getFeatureColor(id), feature = this._dataSource.getFeatureById(id)
            ? this._dataSource.getFeatureById(id)
            : undefined;
        if (!feature)
            return [new ol_style_Style__WEBPACK_IMPORTED_MODULE_21__["default"]()];
        if ('' + this._selectedFeatureId === '' + id)
            selected = true;
        if (!selected) {
            var maxRadius = this._configService.getPoiMaxRadius(), minRadius = this._configService.getPoiMinRadius(), iconZoom = this._configService.getIconPoiZoom(), iconRadius = this._configService.getPoiIconRadius(), minZoom = this._configService.getPoiMinZoom(), currentZoom = this._view.getZoom();
            var zoomFactor = currentZoom >= iconZoom ? iconRadius
                : (currentZoom < minZoom ? minRadius : ((maxRadius - minRadius) / (iconZoom - minZoom)) * (currentZoom - minZoom) + minRadius);
            var pin = this._configService.getPoiPin();
            style = [
                new ol_style_Style__WEBPACK_IMPORTED_MODULE_21__["default"]({
                    image: new ol_style_Icon__WEBPACK_IMPORTED_MODULE_12__["default"]({
                        src: pin.src,
                        scale: pin.scale * zoomFactor,
                        color: color
                    }),
                    zIndex: 150
                })
            ];
            if (this._view.getZoom() > this._configService.getIconPoiZoom())
                this._addIconOverlay(id);
            else
                this._removeIconOverlay(id);
        }
        else {
            this._removeIconOverlay(id);
            var pin = this._configService.getPoiPin();
            style = [
                new ol_style_Style__WEBPACK_IMPORTED_MODULE_21__["default"]({
                    image: new ol_style_Icon__WEBPACK_IMPORTED_MODULE_12__["default"]({
                        src: pin.src,
                        scale: pin.scale * this._configService.getPoiSelectedRadius(),
                        color: '#fff'
                    }),
                    zIndex: 499
                })
            ];
        }
        return style;
    };
    /**
     * Function dedicated to draw arrows on linestring
     *
     * @param geometry the geometry of the line
     * @param minSegmentLength length of segment
     * @param options options
     */
    MapService.prototype._splitLineString = function (geometry, minSegmentLength, options) {
        var calculatePointsDistance = function (coord1, coord2) {
            var dx = coord1[0] - coord2[0];
            var dy = coord1[1] - coord2[1];
            return Math.sqrt(dx * dx + dy * dy);
        };
        var calculateSplitPointCoords = function (startNode, nextNode, distanceBetweenNodes, distanceToSplitPoint) {
            var d = distanceToSplitPoint / distanceBetweenNodes;
            var x = nextNode[0] + (startNode[0] - nextNode[0]) * d;
            var y = nextNode[1] + (startNode[1] - nextNode[1]) * d;
            return [x, y];
        };
        var calculateAngle = function (startNode, nextNode, alwaysUp) {
            var x = (nextNode[0] - startNode[0]);
            var y = (nextNode[1] - startNode[1]);
            var angle = Math.atan2(y, x);
            if (!alwaysUp) {
                angle = y < 0 && x < 0 ? angle * -1 : y < 0 && x == 0 ? Math.PI * 2 - angle : y < 0 && x > 0 ? angle * -1 : angle * -1;
            }
            return angle;
        };
        var splitPoints = [];
        var coords = geometry.getCoordinates();
        if (coords.length === 0) {
            return;
        }
        var coordIndex = 0;
        var startPoint = coords[coordIndex];
        var nextPoint = coords[coordIndex + 1];
        var angle = options.vertices || calculateAngle(startPoint, nextPoint, options.alwaysUp);
        var n = Math.ceil(geometry.getLength() / minSegmentLength);
        var segmentLength = geometry.getLength() / n;
        var midPoints = (options.midPoints && !options.vertices);
        var currentSegmentLength = midPoints ? segmentLength / 2 : segmentLength;
        for (var i = 0; i <= n; i++) {
            var distanceBetweenPoints = calculatePointsDistance(startPoint, nextPoint);
            currentSegmentLength += distanceBetweenPoints;
            if (currentSegmentLength < segmentLength) {
                coordIndex++;
                if (coordIndex < coords.length - 1) {
                    startPoint = coords[coordIndex];
                    nextPoint = coords[coordIndex + 1];
                    angle = options.vertices || calculateAngle(startPoint, nextPoint, options.alwaysUp);
                    if (options.vertices && (!options.extent || Object(ol_extent__WEBPACK_IMPORTED_MODULE_3__["containsCoordinate"])(options.extent, startPoint))) {
                        splitPoints.push(startPoint);
                    }
                    i--;
                    continue;
                }
                else {
                    if (!midPoints) {
                        var splitPointCoords = nextPoint;
                        if (!options.extent || Object(ol_extent__WEBPACK_IMPORTED_MODULE_3__["containsCoordinate"])(options.extent, splitPointCoords)) {
                            if (!options.vertices) {
                                splitPointCoords.push(angle);
                            }
                            splitPoints.push(splitPointCoords);
                        }
                    }
                    break;
                }
            }
            else {
                var distanceToSplitPoint = currentSegmentLength - segmentLength;
                var splitPointCoords = calculateSplitPointCoords(startPoint, nextPoint, distanceBetweenPoints, distanceToSplitPoint);
                // startPoint = splitPointCoords.slice();
                startPoint = splitPointCoords;
                if (!options.extent || Object(ol_extent__WEBPACK_IMPORTED_MODULE_3__["containsCoordinate"])(options.extent, splitPointCoords)) {
                    if (!options.vertices) {
                        splitPointCoords.push(angle);
                    }
                    splitPoints.push(splitPointCoords);
                }
                currentSegmentLength = 0;
            }
        }
        return splitPoints;
    };
    /**
     * Return the arrows as style for the feature
     *
     * @param feature the line feature
     * @param resolution the current resolution
     */
    MapService.prototype._getArrowStyle = function (feature, resolution, color, zIndex) {
        var size = 85, scale = 0.20 - ((17 - this._view.getZoom()) / 75), styles = [], mapSize = this._map.getSize(), geom = feature.getGeometry(), extent, splitPoints;
        var n;
        try {
            n = geom.getLength() / (size * resolution);
        }
        catch (e) {
            console.warn('WARNING: wrong geometry in feature ' + feature.getId());
            return styles;
        }
        if (n < 2)
            return styles;
        if (n > 1000000) {
            n = Math.sqrt(n / 100);
            extent = this._view.calculateExtent([mapSize[0] * n, mapSize[1] * n]);
            splitPoints = this._splitLineString(geom, size * resolution * n, { extent: extent, vertices: false });
            geom = new ol_geom_LineString__WEBPACK_IMPORTED_MODULE_13__["default"](splitPoints);
        }
        extent = this._view.calculateExtent([mapSize[0] + (size * 2), mapSize[1] + (size * 2)]);
        splitPoints = this._splitLineString(geom, size * resolution, { alwaysUp: false, midPoints: true, extent: extent });
        splitPoints.forEach(function (point) {
            styles.push(new ol_style_Style__WEBPACK_IMPORTED_MODULE_21__["default"]({
                geometry: new ol_geom_Point__WEBPACK_IMPORTED_MODULE_17__["default"]([point[0], point[1]]),
                image: new ol_style_Icon__WEBPACK_IMPORTED_MODULE_12__["default"]({
                    src: '/wp-content/plugins/wm-embedmaps/assets/js/core/assets/images/line-icon-arrow.png',
                    scale: scale,
                    rotation: point[2],
                    color: color,
                    rotateWithView: true
                }),
                zIndex: zIndex + 1
            }));
        });
        return styles;
    };
    /**
     * Allow to select a feature eventually triggering its popup
     *
     * @param id the id of the feature to select
     * @param showPopup if true make the popup appear
     */
    MapService.prototype.selectFeature = function (id, showPopup) {
        id = '' + id;
        if (this._selectedFeatureId === id) {
            if (showPopup)
                this.showPopup(id);
            else
                this.showPopup();
            return;
        }
        if (this._selectedFeatureId !== undefined)
            this.deselectFeature();
        // WRONG CHECK - if a feature is not in the datasource does not mean is a UTFGRID feature
        if (this._features && this._features[id] && this._features[id].properties.hide) {
            this._addFeature(id, this._dataSource);
            this._utfgridSelectedFeature = this._dataSource.getFeatureById(id);
        }
        if (this._dataSource.getFeatureById(id)) {
            var feature = this._dataSource.getFeatureById(id);
            if (feature.getGeometry().getType() === 'Point') {
                var icon = this._modelService.getFeatureIcon(id);
                if (icon !== '') {
                    var element = void 0;
                    if (icon.substring(0, 3) === 'wm-') {
                        element = document.createElement('i');
                        element.className = icon;
                        element.style.fontSize = '24px';
                        element.style.color = this._modelService.getFeatureColor(id);
                        element.style.height = 'inherit';
                    }
                    else {
                        element = document.createElement('div');
                        var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg'), path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        path.setAttribute('d', icon.replace(' ', ','));
                        svg.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns', 'http://www.w3.org/2000/svg');
                        svg.setAttribute('viewBox', '0 0 512 512');
                        svg.setAttribute('width', '24px');
                        svg.setAttribute('height', '24px');
                        svg.appendChild(path);
                        document.body.appendChild(svg);
                        if (path.getBBox())
                            svg.setAttribute('viewBox', '0 0 ' + path.getBBox().width + ' ' + path.getBBox().height);
                        svg.remove();
                        element.appendChild(svg);
                        element.style.fill = this._modelService.getFeatureColor(id);
                    }
                    element.style.zIndex = '500';
                    element.style.position = 'relative';
                    element.style.top = '1px';
                    element.style.display = 'block';
                    var coordinates = this._features[id].geometry.coordinates;
                    this._map.addOverlay(new ol_Overlay__WEBPACK_IMPORTED_MODULE_15__["default"]({
                        id: 'selected-pin-icon',
                        element: element,
                        stopEvent: false,
                        autoPan: false,
                        position: this._fromLonLat(coordinates),
                        positioning: ol_OverlayPositioning__WEBPACK_IMPORTED_MODULE_16__["default"].CENTER_CENTER
                    }));
                }
            }
            this._selectedFeatureId = id;
            feature.changed();
        }
        this._map.render();
        if (this._selectedFeatureId && showPopup)
            this.showPopup(id);
    };
    /**
     * Clear all selected features and eventually remove the popup
     */
    MapService.prototype.deselectFeature = function () {
        if (this._selectedFeatureId) {
            var feature = void 0;
            if (this._utfgridSelectedFeature) {
                this._dataSource.removeFeature(this._utfgridSelectedFeature);
                this._utfgridSelectedFeature = undefined;
            }
            else {
                if (this._dataSource.getFeatureById(this._selectedFeatureId)) {
                    feature = this._dataSource.getFeatureById(this._selectedFeatureId);
                    if (feature.getGeometry().getType() === 'Point') {
                        if (this._map.getOverlayById('selected-pin-icon'))
                            this._map.removeOverlay(this._map.getOverlayById('selected-pin-icon'));
                    }
                }
            }
            this._selectedFeatureId = undefined;
            if (feature)
                feature.changed();
        }
        this._map.render();
        this.showPopup();
    };
    /**
     * Allow to show the popup for a feature
     *
     * @param id id of the feature to use as popup data
     */
    MapService.prototype.showPopup = function (id) {
        var _this = this;
        if (!this._deviceService.isLgScreen || (id && this._features[id].properties.noDetails) || this._configService.openWebLinkFromPopup())
            this.onPopupChange.emit(id);
        else if (id && !this._features[id].properties.noDetails && !this._features[id].properties.noInteraction) {
            this._routerService.onUrlChange
                .pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["take"])(1))
                .subscribe(function (state) {
                _this._routerService.navigate(['/details/' + id], {
                    replaceUrl: state.urlAfterRedirects.indexOf('details') !== -1
                });
            });
        }
        else
            this.onPopupChange.emit();
    };
    MapService.prototype._addFeature = function (id, source) {
        var feature;
        if (source.getFeatureById(id))
            feature = source.getFeatureById(id);
        else {
            var mapFeatures = [];
            try {
                mapFeatures = (new ol_format_Geojson__WEBPACK_IMPORTED_MODULE_11__["default"]({
                    featureProjection: 'EPSG:3857'
                })).readFeatures(this._features[id]);
            }
            catch (e) {
                return;
            }
            // No features
            if (mapFeatures.length === 0) {
                return;
            }
            feature = mapFeatures[0];
            feature.setId(id);
            source.addFeature(feature);
        }
        this._map.render();
    };
    /**
     * Filter the map showing only the features listed in ids
     *
     * @param ids the array of id of the feature to have in map
     */
    MapService.prototype.filterFeatures = function (ids) {
        for (var i in ids) {
            ids[i] = '' + ids[i];
        }
        var currentFeatures = this._dataSource.getFeatures();
        var todo = {};
        for (var _i = 0, ids_1 = ids; _i < ids_1.length; _i++) {
            var id = ids_1[_i];
            todo[id] = false;
        }
        for (var _a = 0, currentFeatures_1 = currentFeatures; _a < currentFeatures_1.length; _a++) {
            var feature = currentFeatures_1[_a];
            if (ids.indexOf(feature.getId() + '') === -1) {
                if (this._selectedFeatureId === feature.getId() + '')
                    this.deselectFeature();
                try {
                    this._dataSource.removeFeature(feature);
                }
                catch (e) { }
                this._removeIconOverlay(feature.getId() + '');
            }
            else
                todo[feature.getId() + ''] = true;
        }
        for (var id in todo) {
            if (todo[id])
                continue;
            if (this._features[id] && !this._features[id].properties.hide)
                this._addFeature(id, this._dataSource);
            todo[id] = true;
        }
        this._map.render();
        this._activeFeatures = ids;
        if (typeof this._selectedFeatureId !== 'undefined' && this._activeFeatures.indexOf(this._selectedFeatureId) === -1)
            this.showPopup();
    };
    /**
     * Filter the map showing only the features listed in ids
     *
     * @param ids the array of id of the feature to have in map
     */
    MapService.prototype.filterRelatedFeatures = function (id) {
        var feature = this._features[id];
        var pois = [];
        if (!feature)
            return;
        if (feature.properties.related && feature.properties.related.poi && feature.properties.related.poi.related) {
            for (var _i = 0, _a = feature.properties.related.poi.related; _i < _a.length; _i++) {
                var i = _a[_i];
                pois.push(i.toString());
            }
        }
        pois.push(feature.properties.id);
        this.filterFeatures(pois);
    };
    /**
     * Restore all the features in the map
     */
    MapService.prototype.resetFilters = function () {
        this._activeFeatures = undefined;
        // this._drawAllFeatures();
        this._drawTaxonomyFilteredFeatures();
    };
    MapService.prototype._drawTaxonomyFilteredFeatures = function () {
        var allActive = true;
        for (var i in this._taxonomyFilters) {
            allActive = allActive && this._taxonomyFilters[i];
            if (!allActive)
                break;
        }
        if (!this._taxonomyFilters || allActive) {
            this._activeFeatures = undefined;
            this._drawAllFeatures();
            return;
        }
        var ids = [];
        for (var i in this._features) {
            if (this._features[i].properties.preventFilter)
                ids.push(i + '');
            else {
                var found = false;
                for (var tax in this._features[i].properties.taxonomy) {
                    for (var j in this._features[i].properties.taxonomy[tax]) {
                        if (this._taxonomyFilters[this._features[i].properties.taxonomy[tax][j] + '']) {
                            found = true;
                            ids.push(i + '');
                            break;
                        }
                    }
                    if (found)
                        break;
                }
            }
        }
        this.filterFeatures(ids);
    };
    /**
     * Toggle all the features with the specified taxonomy in the
     * map that don't have any of the active taxonomies
     *
     * @param id the id of the taxonomy to toggle
     */
    MapService.prototype.toggleTaxonomyFilter = function (id) {
        if (typeof this._taxonomyFilters[id + ''] !== 'undefined') {
            this._taxonomyFilters[id + ''] = !this._taxonomyFilters[id + ''];
            this._drawTaxonomyFilteredFeatures();
            this.onTaxonomyFiltersChange.next(this._taxonomyFilters);
        }
    };
    MapService.prototype.toggleAllTaxonomyFilters = function () {
        if (typeof this._taxonomyFilters !== 'undefined') {
            var activeNumber = 0;
            for (var i in this._taxonomyFilters) {
                if (this._taxonomyFilters[i])
                    activeNumber++;
            }
            for (var i in this._taxonomyFilters) {
                this._taxonomyFilters[i] = activeNumber === 0;
            }
            this._drawTaxonomyFilteredFeatures();
            this.onTaxonomyFiltersChange.next(this._taxonomyFilters);
        }
    };
    /**
     * Enable all the interaction in the map such as zoom, rotate etc
     */
    MapService.prototype.enableInteraction = function () {
        if (this._isReady) {
            var interactions = this._map.getInteractions();
            interactions.forEach(function (item) {
                item.setActive(true);
            });
            this._isInteractive = true;
        }
    };
    /**
     * Disable all the interaction in the map such as zoom, rotate etc
     */
    MapService.prototype.disableInteraction = function () {
        if (this._isReady) {
            var interactions = this._map.getInteractions();
            interactions.forEach(function (item) {
                item.setActive(false);
            });
            this._isInteractive = false;
        }
    };
    /**
     * Return the closest point to the feature with the specified id. If the id is not set
     * return the closest point to the closest feature in the map
     *
     * @param id the id of the feature
     */
    MapService.prototype.getClosestPoint = function (location, id) {
        var coordinates;
        if (typeof id !== 'undefined') {
            if (this._dataSource.getFeatureById(id)) {
                coordinates = this._toLonLat(this._dataSource.getFeatureById(id).getGeometry().getClosestPoint(this._fromLonLat([location.longitude, location.latitude])));
            }
            else if (this._features && this._features[id]) {
                var feature = (new ol_format_Geojson__WEBPACK_IMPORTED_MODULE_11__["default"]({
                    featureProjection: 'EPSG:3857'
                })).readFeatures(this._features[id])[0];
                coordinates = this._toLonLat(feature.getGeometry().getClosestPoint(this._fromLonLat([location.longitude, location.latitude])));
            }
        }
        else {
            var feature = this._dataSource.getClosestFeatureToCoordinate(this._fromLonLat([location.longitude, location.latitude]));
            if (feature) {
                coordinates = this._toLonLat(feature.getGeometry().getClosestPoint(this._fromLonLat([location.longitude, location.latitude])));
            }
        }
        if (!coordinates || !coordinates[0] || !coordinates[1])
            coordinates = [undefined, undefined];
        return new _classes_clocation__WEBPACK_IMPORTED_MODULE_32__["CLocation"](coordinates[0], coordinates[1]);
    };
    /**
     * Return the current location closest point to the feature specified or to the closest
     * feature in the map
     *
     * @param id the id of the feature
     */
    MapService.prototype.getClosestPointToLocation = function (id) {
        var closest;
        if (this._geolocationIcon.point) {
            var coordinates = this._geolocationIcon.point.getCoordinates();
            coordinates = this._toLonLat(coordinates);
            closest = this.getClosestPoint(new _classes_clocation__WEBPACK_IMPORTED_MODULE_32__["CLocation"](coordinates[0], coordinates[1]), id);
        }
        return closest;
    };
    MapService.prototype.getFeatureLength = function (feature) {
        var length = 0;
        if (feature && feature.geometry && feature.geometry.type === 'LineString') {
            for (var i = 0; i < feature.geometry.coordinates.length - 1; i++) {
                length += this.getDistanceBetweenPoints(new _classes_clocation__WEBPACK_IMPORTED_MODULE_32__["CLocation"](feature.geometry.coordinates[i][0], feature.geometry.coordinates[i][0]), new _classes_clocation__WEBPACK_IMPORTED_MODULE_32__["CLocation"](feature.geometry.coordinates[i + 1][0], feature.geometry.coordinates[i + 1][0]));
            }
        }
        return length;
    };
    MapService = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [_device_service__WEBPACK_IMPORTED_MODULE_34__["DeviceService"],
            _config_service__WEBPACK_IMPORTED_MODULE_33__["ConfigService"],
            _model_service__WEBPACK_IMPORTED_MODULE_35__["ModelService"],
            _router_service__WEBPACK_IMPORTED_MODULE_36__["RouterService"],
            _theme_service__WEBPACK_IMPORTED_MODULE_37__["ThemeService"]])
    ], MapService);
    return MapService;
}());



/***/ }),

/***/ "./src/app/services/model.service.ts":
/*!*******************************************!*\
  !*** ./src/app/services/model.service.ts ***!
  \*******************************************/
/*! exports provided: ModelService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ModelService", function() { return ModelService; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! rxjs/operators */ "./node_modules/rxjs/_esm5/operators/index.js");
/* harmony import */ var _communication_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./communication.service */ "./src/app/services/communication.service.ts");
/* harmony import */ var _config_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./config.service */ "./src/app/services/config.service.ts");
/* harmony import */ var _languages_service__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./languages.service */ "./src/app/services/languages.service.ts");
/* harmony import */ var _classes_etaxonomy_enum__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../classes/etaxonomy.enum */ "./src/app/classes/etaxonomy.enum.ts");
/* harmony import */ var _classes_ctaxonomies__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../classes/ctaxonomies */ "./src/app/classes/ctaxonomies.ts");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../constants */ "./src/app/constants.ts");
/**
 * Model Service
 *
 * It control all the data of the application, such as features, routes and taxonomies.
 * Handle also the download of the routes
 *
 * */
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};









var ModelService = /** @class */ (function () {
    function ModelService(_communicationService, _configService, _languagesService) {
        var _this = this;
        this._communicationService = _communicationService;
        this._configService = _configService;
        this._languagesService = _languagesService;
        this.onReady = new rxjs__WEBPACK_IMPORTED_MODULE_1__["ReplaySubject"](1);
        this.onReady.next(false);
        this.onPagesReady = new rxjs__WEBPACK_IMPORTED_MODULE_1__["ReplaySubject"](1);
        this.onPagesReady.next(false);
        this._taxononmyEvents = {};
        for (var taxonomy in Object.keys(_classes_etaxonomy_enum__WEBPACK_IMPORTED_MODULE_6__["ETaxonomy"])) {
            this._taxononmyEvents[Object.values(_classes_etaxonomy_enum__WEBPACK_IMPORTED_MODULE_6__["ETaxonomy"])[taxonomy]] = new rxjs__WEBPACK_IMPORTED_MODULE_1__["ReplaySubject"](1);
        }
        this._onTaxonomyChange = new rxjs__WEBPACK_IMPORTED_MODULE_1__["ReplaySubject"](1);
        this._onFeaturesChange = new rxjs__WEBPACK_IMPORTED_MODULE_1__["ReplaySubject"](1);
        this._load().then(function () {
            _this.onReady.next(true);
        });
        if (this._configService.isEmbedded) {
            document.addEventListener('wm_overlays_updated', function () {
                _this._load();
            });
        }
    }
    ModelService.prototype.getStartUrl = function () {
        return '/';
    };
    ModelService.prototype._load = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this._taxonomies = new _classes_ctaxonomies__WEBPACK_IMPORTED_MODULE_7__["CTaxonomies"]();
            _this._features = {};
            _this._onTaxonomyChange.next(_this._taxonomies);
            _this._onFeaturesChange.next({});
            _this._getTaxonomies().then(function () {
                _this._loadFeatures().then(function () {
                    _this._onTaxonomyChange.next(_this._taxonomies);
                    _this._onFeaturesChange.next(_this._features);
                    resolve();
                }, function () {
                    resolve();
                });
            }, function () {
                resolve();
            });
        });
    };
    ModelService.prototype._populateTaxonomy = function (taxonomy) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this._communicationService.get(_this._configService.getTaxonomyUrl(Object.values(_classes_etaxonomy_enum__WEBPACK_IMPORTED_MODULE_6__["ETaxonomy"])[taxonomy]) + '?t=' + Date.now()).subscribe(function (json) {
                _this._saveTaxonomy(json, Object.values(_classes_etaxonomy_enum__WEBPACK_IMPORTED_MODULE_6__["ETaxonomy"])[taxonomy]);
                resolve();
            }, function (err) {
                console.warn(err);
                resolve();
            });
        });
    };
    ModelService.prototype._saveTaxonomy = function (json, type) {
        if (typeof json === 'undefined' || json === null || (json && typeof json.length !== 'undefined'))
            json = {};
        for (var id in json) {
            for (var propertyId in json[id]) {
                if (json[id][propertyId] === '' || json[id][propertyId] === null || json[id][propertyId] === false)
                    delete json[id][propertyId];
            }
        }
        this._taxonomies[type] = json;
    };
    ModelService.prototype._getTaxonomies = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            if (!_this._configService.hasK()) {
                resolve();
                return;
            }
            var promises = [];
            for (var taxonomy in Object.keys(_classes_etaxonomy_enum__WEBPACK_IMPORTED_MODULE_6__["ETaxonomy"])) {
                promises.push(_this._populateTaxonomy(taxonomy));
            }
            Promise.all(promises).then(function () {
                _this._onTaxonomyChange.next(_this._taxonomies);
                for (var i in _this._taxononmyEvents) {
                    _this._taxononmyEvents[i].next(_this._taxonomies[i]);
                }
                resolve();
            }, function (err) {
                console.warn(err);
                resolve();
            });
        });
    };
    ModelService.prototype._downloadFeature = function (id) {
        var _this = this;
        id = "" + id;
        return new Promise(function (resolve, reject) {
            if (id.substring(0, 16) === 'wm-custom-track-') {
                resolve();
                return;
            }
            _this._communicationService.get(_this._configService.getFeatureBaseUrl() + id + '.geojson').subscribe(function (geojson) {
                _this._features[id] = geojson;
                _this._onFeaturesChange.next(_this._features);
                resolve();
            }, function (err) {
                console.warn(err);
                resolve();
            });
        });
    };
    ModelService.prototype._loadFeature = function (id) {
        var _this = this;
        id = "" + id;
        return new Promise(function (resolve, reject) {
            _this._downloadFeature(id).then(function () {
                resolve();
            });
        });
    };
    ModelService.prototype._addOverlayFeatureToTaxonomy = function (feature) {
        if (feature.properties.taxonomy) {
            var type = feature.geometry.type === 'LineString' ? 'track' : 'poi';
            for (var taxType in feature.properties.taxonomy) {
                for (var i in feature.properties.taxonomy[taxType]) {
                    if (this._taxonomies[taxType]) {
                        for (var j in this._taxonomies[taxType]) {
                            if (j + '' === feature.properties.taxonomy[taxType][i] + '') {
                                if (!this._taxonomies[taxType][j].items)
                                    this._taxonomies[taxType][j].items = {};
                                if (!this._taxonomies[taxType][j].items[type])
                                    this._taxonomies[taxType][j].items[type] = [];
                                this._taxonomies[taxType][j].items[type].push(feature.properties.id);
                                break;
                            }
                        }
                    }
                }
            }
        }
    };
    ModelService.prototype._loadFeaturesFromOverlay = function (overlayMeta, overlay) {
        var _this = this;
        var addFeature = function (feature) {
            var valid = true;
            valid = feature.geometry && (feature.geometry.type === 'Point'
                || feature.geometry.type === 'LineString'
                || feature.geometry.type === 'MultiLineString'
                || feature.geometry.type === 'Polygon'
                || feature.geometry.type === 'MultiPolygon') && typeof feature.geometry.coordinates !== 'undefined';
            valid = feature.properties && feature.properties.id && typeof feature.properties.name !== 'undefined';
            if (valid) {
                feature.properties.id = overlayMeta.id + '-' + feature.properties.id;
                if (overlayMeta.type === 'utfgrid')
                    feature.properties.hide = true;
                else if (overlayMeta.minZoom && !feature.properties.minZoom)
                    feature.properties.minZoom = overlayMeta.minZoom;
                if (overlayMeta.noDetails && typeof feature.properties.noDetails === 'undefined')
                    feature.properties.noDetails = overlayMeta.noDetails;
                if (overlayMeta.noInteraction && typeof feature.properties.noInteraction === 'undefined')
                    feature.properties.noInteraction = overlayMeta.noInteraction;
                if (overlayMeta.color && feature.properties.color === undefined)
                    feature.properties.color = overlayMeta.color;
                if (overlayMeta.strokeWidth && !feature.properties.strokeWidth)
                    feature.properties.strokeWidth = overlayMeta.strokeWidth;
                if (overlayMeta.strokeOpacity && !feature.properties.strokeOpacity)
                    feature.properties.strokeOpacity = overlayMeta.strokeOpacity;
                if (overlayMeta.icon && feature.properties.icon === undefined)
                    feature.properties.icon = overlayMeta.icon;
                if (overlayMeta.preventFilter && feature.properties.preventFilter !== false && feature.properties.preventFilter !== true)
                    feature.properties.preventFilter = overlayMeta.preventFilter;
                if (['Polygon', 'MultiPolygon'].indexOf(feature.geometry.type) !== -1) {
                    if (feature.properties.invert === undefined && overlayMeta.invertPolygons)
                        feature.properties.invert = overlayMeta.invertPolygons;
                    if (feature.properties.invert)
                        feature = _this.invertPolygon(feature);
                    if (overlayMeta.fillColor && !feature.properties.fillColor)
                        feature.properties.fillColor = overlayMeta.fillColor;
                    if (overlayMeta.fillOpacity && !feature.properties.fillOpacity)
                        feature.properties.fillOpacity = overlayMeta.fillOpacity;
                }
                _this._features[feature.properties.id] = feature;
                _this._addOverlayFeatureToTaxonomy(feature);
            }
        };
        if (overlay && overlay.type) {
            switch (overlay.type) {
                case 'Feature':
                    addFeature(overlay);
                    break;
                case 'FeatureCollection':
                    if (overlay.features) {
                        for (var i in overlay.features) {
                            addFeature(overlay.features[i]);
                        }
                    }
                    break;
                default: break;
            }
        }
    };
    ModelService.prototype._loadOverlayLayer = function (layer) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            if (layer.type === 'utfgrid' || layer.type === 'geojson') {
                if (!layer.geojsonUrl)
                    resolve();
                else {
                    var url = layer.geojsonUrl, options = {};
                    if (url.substr(0, 4) !== 'http')
                        url = _this._configService.getFeatureBaseUrl() + url;
                    if (layer.headers)
                        options = {
                            headers: layer.headers
                        };
                    _this._communicationService.get(url, options).subscribe(function (overlay) {
                        if (!overlay.type)
                            overlay.type = 'FeatureCollection';
                        if (overlay.metadatiSpaziali) {
                            overlay.features = overlay.metadatiSpaziali;
                            delete overlay.metadatiSpaziali;
                        }
                        if (overlay.metadati && overlay.metadati.id) {
                            var term = {
                                id: overlay.metadati.id + '',
                                name: '',
                                locale: _this._languagesService.getDefaultLang()
                            };
                            if (overlay.metadati.name)
                                term.name = overlay.metadati.name;
                            if (overlay.metadati.color)
                                term.color = overlay.metadati.color;
                            else if (overlay.metadati.colore)
                                term.color = overlay.metadati.colore;
                            if (overlay.metadati.fillColor)
                                term.fillColor = overlay.metadati.fillColor;
                            if (overlay.metadati.fillOpacity)
                                term.fillOpacity = overlay.metadati.fillOpacity;
                            if (overlay.metadati.strokeWidth)
                                term.strokeWidth = overlay.metadati.strokeWidth;
                            if (overlay.metadati.strokeOpacity)
                                term.strokeOpacity = overlay.metadati.strokeOpacity;
                            if (overlay.metadati.icon)
                                term.icon = overlay.metadati.icon;
                            else if (overlay.metadati.iconaSvg)
                                term.icon = overlay.metadati.iconaSvg;
                            _this._taxonomies.webmapp_category[term.id] = term;
                            for (var i in overlay.features) {
                                if (!overlay.features[i].properties.taxonomy)
                                    overlay.features[i].properties.taxonomy = {};
                                if (!overlay.features[i].properties.taxonomy.webmapp_category)
                                    overlay.features[i].properties.taxonomy.webmapp_category = [];
                                var wc = overlay.features[i].properties.taxonomy.webmapp_category;
                                wc.push(term.id);
                                overlay.features[i].properties.taxonomy.webmapp_category = wc;
                            }
                            delete overlay.metadati;
                        }
                        _this._loadFeaturesFromOverlay(layer, overlay);
                        _this._onFeaturesChange.next(_this._features);
                        resolve();
                    });
                }
            }
        });
    };
    ModelService.prototype._loadLocalOverlayLayers = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            var overlaysDefinition = JSON.parse(window.localStorage.getItem('wm_overlays_definition')), layers = JSON.parse(window.localStorage.getItem('wm_geojson_layers'));
            for (var i in layers) {
                var overlay = overlaysDefinition && overlaysDefinition[i] ? overlaysDefinition[i] : JSON.parse(JSON.stringify(_constants__WEBPACK_IMPORTED_MODULE_8__["DEF_OVERLAY_CONFIG"]));
                if (!overlaysDefinition || !overlaysDefinition[i])
                    overlay.id = 'wm-default-layer-' + i;
                _this._loadFeaturesFromOverlay(overlay, layers[i]);
            }
            resolve();
        });
    };
    ModelService.prototype._loadFeatures = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            var featuresToDownload = [], routesToDownload = [], promises = [];
            for (var taxonomyType in _this._taxonomies) {
                for (var taxonomyId in _this._taxonomies[taxonomyType]) {
                    if (_this._taxonomies[taxonomyType][taxonomyId].items) {
                        if (_this._taxonomies[taxonomyType][taxonomyId].items.track) {
                            for (var _i = 0, _a = _this._taxonomies[taxonomyType][taxonomyId].items.track; _i < _a.length; _i++) {
                                var id = _a[_i];
                                if (featuresToDownload.indexOf(id) === -1) {
                                    featuresToDownload.push(id);
                                }
                            }
                        }
                        if (_this._taxonomies[taxonomyType][taxonomyId].items.poi) {
                            for (var _b = 0, _c = _this._taxonomies[taxonomyType][taxonomyId].items.poi; _b < _c.length; _b++) {
                                var id = _c[_b];
                                if (featuresToDownload.indexOf(id) === -1) {
                                    featuresToDownload.push(id);
                                }
                            }
                        }
                        if (_this._taxonomies[taxonomyType][taxonomyId].items.route) {
                            for (var _d = 0, _e = _this._taxonomies[taxonomyType][taxonomyId].items.route; _d < _e.length; _d++) {
                                var id = _e[_d];
                                if (routesToDownload.indexOf(id) === -1) {
                                    routesToDownload.push(id);
                                }
                            }
                        }
                    }
                }
            }
            for (var _f = 0, featuresToDownload_1 = featuresToDownload; _f < featuresToDownload_1.length; _f++) {
                var id = featuresToDownload_1[_f];
                promises.push(_this._loadFeature(id));
            }
            var overlays = _this._configService.getOverlayLayers();
            for (var i in overlays) {
                promises.push(_this._loadOverlayLayer(overlays[i]));
            }
            if (_this._configService.isEmbedded) {
                promises.push(_this._loadLocalOverlayLayers());
            }
            var updateFeatureTranslations = function () {
                for (var i in _this._features) {
                    if (_this._features[i].properties.translations && _this._features[i].properties.locale) {
                        if (!_this._features[i].properties.translations[_this._features[i].properties.locale]) {
                            _this._features[i].properties.translations[_this._features[i].properties.locale] = {
                                name: _this._features[i].properties.name,
                                description: _this._features[i].properties.description
                            };
                        }
                        else {
                            if (!_this._features[i].properties.translations[_this._features[i].properties.locale].name)
                                _this._features[i].properties.translations[_this._features[i].properties.locale].name = _this._features[i].properties.name;
                            if (!_this._features[i].properties.translations[_this._features[i].properties.locale].description)
                                _this._features[i].properties.translations[_this._features[i].properties.locale].description = _this._features[i].properties.description;
                        }
                    }
                }
            };
            Promise.all(promises).then(function () {
                updateFeatureTranslations();
                resolve();
            }, function () {
                updateFeatureTranslations();
                resolve();
            });
        });
    };
    /**
     * Invert the area of a polygon
     *
     * @param polygon the polygon to invert
     */
    ModelService.prototype.invertPolygon = function (polygon) {
        if (['Polygon', 'MultiPolygon'].indexOf(polygon.geometry.type) !== -1) {
            var geometry = void 0;
            if (polygon.geometry.type === 'MultiPolygon')
                geometry = polygon.geometry.coordinates;
            else {
                polygon.geometry.type = 'MultiPolygon';
                geometry = [polygon.geometry.coordinates];
            }
            geometry[0].splice(0, 0, [[0, 90], [180, 90], [180, -90], [0, -90], [-180, -90], [-180, 0], [-180, 90], [0, 90]]);
            polygon.geometry.coordinates = geometry;
        }
        return polygon;
    };
    /**
     * DATA RETRIEVE
     */
    /**
     * Subscribe to a taxonomy type
     *
     * @param type the type of taxonomy
     */
    ModelService.prototype.getTaxonomy = function (type) {
        return this._taxononmyEvents[type];
    };
    /**
     * Return the name of a taxonomy term
     *
     * @param id the id of the term
     */
    ModelService.prototype.getTaxonomyName = function (id) {
        id = "" + id;
        for (var i in this._taxonomies) {
            for (var j in this._taxonomies[i]) {
                if (j === "" + id) {
                    if (this._taxonomies[i][j].translations && this._taxonomies[i][j].translations[this._languagesService.getCurrentLang()] && this._taxonomies[i][j].translations[this._languagesService.getCurrentLang()].name)
                        return this._taxonomies[i][j].translations[this._languagesService.getCurrentLang()].name;
                    else if (this._taxonomies[i][j].translations && this._taxonomies[i][j].translations[this._languagesService.getDefaultLang()] && this._taxonomies[i][j].translations[this._languagesService.getDefaultLang()].name)
                        return this._taxonomies[i][j].translations[this._languagesService.getDefaultLang()].name;
                    else if (this._taxonomies[i][j].name)
                        return this._taxonomies[i][j].name;
                    break;
                }
            }
        }
        return '';
    };
    /**
     * Return the long name of a taxonomy term
     *
     * @param id the id of the term
     */
    ModelService.prototype.getTaxonomyLongName = function (id) {
        id = "" + id;
        for (var i in this._taxonomies) {
            for (var j in this._taxonomies[i]) {
                if (j === "" + id) {
                    if (this._taxonomies[i][j].translations && this._taxonomies[i][j].translations[this._languagesService.getCurrentLang()] && this._taxonomies[i][j].translations[this._languagesService.getCurrentLang()].title)
                        return this._taxonomies[i][j].translations[this._languagesService.getCurrentLang()].title;
                    else if (this._taxonomies[i][j].translations && this._taxonomies[i][j].translations[this._languagesService.getDefaultLang()] && this._taxonomies[i][j].translations[this._languagesService.getDefaultLang()].title)
                        return this._taxonomies[i][j].translations[this._languagesService.getDefaultLang()].title;
                    else if (this._taxonomies[i][j].title)
                        return this._taxonomies[i][j].title;
                    break;
                }
            }
        }
        return this.getTaxonomyName(id);
    };
    /**
     * Return the description of a taxonomy term
     *
     * @param id the id of the term
     */
    ModelService.prototype.getTaxonomyDescription = function (id) {
        id = "" + id;
        for (var i in this._taxonomies) {
            for (var j in this._taxonomies[i]) {
                if (j === "" + id) {
                    if (this._taxonomies[i][j].translations && this._taxonomies[i][j].translations[this._languagesService.getCurrentLang()] && this._taxonomies[i][j].translations[this._languagesService.getCurrentLang()].description)
                        return this._taxonomies[i][j].translations[this._languagesService.getCurrentLang()].description;
                    else if (this._taxonomies[i][j].translations && this._taxonomies[i][j].translations[this._languagesService.getDefaultLang()] && this._taxonomies[i][j].translations[this._languagesService.getDefaultLang()].description)
                        return this._taxonomies[i][j].translations[this._languagesService.getDefaultLang()].description;
                    else if (this._taxonomies[i][j].description)
                        return this._taxonomies[i][j].description;
                    break;
                }
            }
        }
        return '';
    };
    /**
     * Return the data of a taxonomy term
     *
     * @param id the id of the term
     */
    ModelService.prototype.getTaxonomyElement = function (id) {
        id = "" + id;
        for (var i in this._taxonomies) {
            if (this._taxonomies[i] && this._taxonomies[i][id]) {
                return this._taxonomies[i][id];
            }
        }
        return undefined;
    };
    /**
     * Return an observable for the feature you want to retrieve
     *
     * @param id The id of the feature to retrieve
     */
    ModelService.prototype.getFeature = function (id) {
        var _this = this;
        id = "" + id;
        return new rxjs__WEBPACK_IMPORTED_MODULE_1__["Observable"](function (observer) {
            var change = _this._onFeaturesChange
                .pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_2__["debounceTime"])(250))
                .subscribe(function () {
                if (_this._features[id])
                    observer.next(_this._features[id]);
                else
                    observer.next(undefined);
            });
            return {
                unsubscribe: function () {
                    change.unsubscribe();
                }
            };
        });
    };
    /**
     * Check if specified feature belong to the specified taxonomy
     *
     * @param featureId the feature id
     * @param taxonomyId the taxonomy id
     */
    ModelService.prototype.hasTaxonomy = function (featureId, taxonomyId) {
        featureId = '' + featureId;
        taxonomyId = '' + taxonomyId;
        if (this._features && this._features[featureId] && this._features[featureId].properties.taxonomy) {
            var found = false;
            for (var j in this._features[featureId].properties.taxonomy) {
                for (var _i = 0, _a = this._features[featureId].properties.taxonomy[j]; _i < _a.length; _i++) {
                    var id = _a[_i];
                    if ('' + id === taxonomyId) {
                        found = true;
                        break;
                    }
                }
                if (found)
                    break;
            }
            return found;
        }
        return false;
    };
    /**
     * Retrieve the list of all the features
     */
    ModelService.prototype.getFeatures = function () {
        return this._onFeaturesChange;
    };
    /**
     * Retrieve the list of all the taxonomies
     */
    ModelService.prototype.getTaxonomies = function () {
        return this._onTaxonomyChange;
    };
    /**
     * Return a string with the name of the feature
     *
     * @param id the id of the feature
     */
    ModelService.prototype.getFeatureName = function (id) {
        id = "" + id;
        if (!this._features[id]) {
            return '';
        }
        if (this._features[id].properties.translations && this._features[id].properties.translations[this._languagesService.getCurrentLang()] && this._features[id].properties.translations[this._languagesService.getCurrentLang()].name)
            return this._features[id].properties.translations[this._languagesService.getCurrentLang()].name;
        else if (this._features[id].properties.translations && this._features[id].properties.translations[this._languagesService.getDefaultLang()] && this._features[id].properties.translations[this._languagesService.getDefaultLang()].name)
            return this._features[id].properties.translations[this._languagesService.getDefaultLang()].name;
        else if (this._features[id].properties.name)
            return this._features[id].properties.name;
    };
    /**
     * Return a string with the url of the image of the feature
     *
     * @param id the id of the feature
     */
    ModelService.prototype.getFeatureImage = function (id) {
        id = "" + id;
        if (!this._features[id] || !this._features[id].properties.image) {
            return '';
        }
        return this._features[id].properties.image;
    };
    /**
     * Return a string with the description of the feature
     *
     * @param id the id of the feature
     */
    ModelService.prototype.getFeatureDescription = function (id) {
        id = "" + id;
        if (!this._features[id]) {
            return '';
        }
        if (this._features[id].properties.translations && this._features[id].properties.translations[this._languagesService.getCurrentLang()] && this._features[id].properties.translations[this._languagesService.getCurrentLang()].description)
            return this._features[id].properties.translations[this._languagesService.getCurrentLang()].description;
        else if (this._features[id].properties.translations && this._features[id].properties.translations[this._languagesService.getDefaultLang()] && this._features[id].properties.translations[this._languagesService.getDefaultLang()].description)
            return this._features[id].properties.translations[this._languagesService.getDefaultLang()].description;
        else
            return this._features[id].properties.description ? this._features[id].properties.description : '';
    };
    /**
     * Return a string with the color of the taxonomy
     *
     * @param id the id of the taxonomy
     */
    ModelService.prototype.getTaxonomyColor = function (id) {
        id = "" + id;
        var color = _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_COLOR"];
        for (var i in this._taxonomies) {
            for (var taxId in this._taxonomies[i]) {
                if (taxId === id) {
                    if (this._taxonomies[i][taxId].color)
                        color = this._taxonomies[i][taxId].color;
                    else if (this._taxonomies[i][taxId].parent)
                        color = this.getTaxonomyColor(this._taxonomies[i][taxId].parent);
                    break;
                }
            }
            if (color !== _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_COLOR"])
                break;
        }
        return color;
    };
    /**
     * Return a string with the color of the feature
     *
     * @param id the id of the feature
     */
    ModelService.prototype.getFeatureColor = function (id) {
        id = "" + id;
        var color = _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_COLOR"];
        if (!this._features[id])
            return color;
        if (this._features[id].properties.color)
            color = this._features[id].properties.color;
        else if (this._features[id].properties.taxonomy) {
            var taxonomyIds = [];
            if (this._features[id].geometry.type === 'Point' && this._features[id].properties.route) {
                for (var i in this._features[id].properties.taxonomy) {
                    if (i !== 'webmapp_category') {
                        for (var j in this._features[id].properties.taxonomy[i]) {
                            taxonomyIds.push("" + this._features[id].properties.taxonomy[i][j]);
                        }
                    }
                }
            }
            else if (this._features[id].geometry.type === 'Point') {
                if (this._features[id].properties.taxonomy.webmapp_category) {
                    for (var i in this._features[id].properties.taxonomy.webmapp_category) {
                        taxonomyIds.push("" + this._features[id].properties.taxonomy.webmapp_category[i]);
                    }
                }
            }
            else {
                if (this._features[id].properties.taxonomy.activity) {
                    for (var i in this._features[id].properties.taxonomy.activity) {
                        taxonomyIds.push("" + this._features[id].properties.taxonomy.activity[i]);
                    }
                }
            }
            if (taxonomyIds.length > 0) {
                for (var _i = 0, taxonomyIds_1 = taxonomyIds; _i < taxonomyIds_1.length; _i++) {
                    var i = taxonomyIds_1[_i];
                    color = this.getTaxonomyColor(i);
                    if (color !== _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_COLOR"])
                        break;
                }
            }
        }
        return color;
    };
    /**
     * Return a string with the fill color of the taxonomy
     *
     * @param id the id of the taxonomy
     */
    ModelService.prototype.getTaxonomyFillColor = function (id) {
        id = "" + id;
        var color = _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_FILL_COLOR"];
        for (var i in this._taxonomies) {
            for (var taxId in this._taxonomies[i]) {
                if (taxId === id) {
                    if (this._taxonomies[i][taxId].fillColor)
                        color = this._taxonomies[i][taxId].fillColor;
                    else if (this._taxonomies[i][taxId].fillColor)
                        color;
                    this.getTaxonomyFillColor(this._taxonomies[i][taxId].parent);
                    break;
                }
            }
            if (color !== _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_FILL_COLOR"])
                break;
        }
        return color;
    };
    /**
     * Return a string with the fill color of the feature
     *
     * @param id the id of the feature
     */
    ModelService.prototype.getFeatureFillColor = function (id) {
        id = "" + id;
        var color = _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_FILL_COLOR"];
        if (!this._features[id])
            return color;
        if (this._features[id].properties.fillColor)
            color = this._features[id].properties.fillColor;
        else {
            if (this._features[id].properties.taxonomy) {
                var taxonomyIds = [];
                if (this._features[id].geometry.type === 'Point' && this._features[id].properties.route) {
                    for (var i in this._features[id].properties.taxonomy) {
                        if (i !== 'webmapp_category') {
                            for (var j in this._features[id].properties.taxonomy[i]) {
                                taxonomyIds.push("" + this._features[id].properties.taxonomy[i][j]);
                            }
                        }
                    }
                }
                else if (this._features[id].geometry.type === 'Point') {
                    if (this._features[id].properties.taxonomy.webmapp_category) {
                        for (var i in this._features[id].properties.taxonomy.webmapp_category) {
                            taxonomyIds.push("" + this._features[id].properties.taxonomy.webmapp_category[i]);
                        }
                    }
                }
                else {
                    if (this._features[id].properties.taxonomy.activity) {
                        for (var i in this._features[id].properties.taxonomy.activity) {
                            taxonomyIds.push("" + this._features[id].properties.taxonomy.activity[i]);
                        }
                    }
                }
                if (taxonomyIds.length > 0) {
                    for (var _i = 0, taxonomyIds_2 = taxonomyIds; _i < taxonomyIds_2.length; _i++) {
                        var i = taxonomyIds_2[_i];
                        color = this.getTaxonomyFillColor(i);
                        if (color !== _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_FILL_COLOR"])
                            break;
                    }
                }
            }
        }
        if (color === _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_FILL_COLOR"])
            color = this.getFeatureColor(id);
        return color;
    };
    /**
     * Return the fill opacity value of the taxonomy
     *
     * @param id the id of the taxonomy
     */
    ModelService.prototype.getTaxonomyFillOpacity = function (id) {
        id = "" + id;
        var opacity = _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_FILL_OPACITY"];
        for (var i in this._taxonomies) {
            for (var taxId in this._taxonomies[i]) {
                if (taxId === id) {
                    if (this._taxonomies[i][taxId].fillOpacity)
                        opacity = this._taxonomies[i][taxId].fillOpacity;
                    else if (this._taxonomies[i][taxId].fillOpacity)
                        opacity = this.getTaxonomyFillOpacity(this._taxonomies[i][taxId].parent);
                    break;
                }
            }
            if (opacity !== _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_FILL_OPACITY"])
                break;
        }
        return opacity > 1 ? Math.max(0, Math.min(100, opacity)) / 100 : Math.max(0, Math.min(1, opacity));
    };
    /**
     * Return the fill opacity value of the feature
     *
     * @param id the id of the feature
     */
    ModelService.prototype.getFeatureFillOpacity = function (id) {
        id = "" + id;
        var opacity = _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_FILL_OPACITY"];
        if (!this._features[id])
            return opacity;
        if (this._features[id].properties.fillOpacity)
            opacity = this._features[id].properties.fillOpacity;
        else if (this._features[id].properties.taxonomy) {
            var taxonomyIds = [];
            if (this._features[id].geometry.type === 'Point' && this._features[id].properties.route) {
                for (var i in this._features[id].properties.taxonomy) {
                    if (i !== 'webmapp_category') {
                        for (var j in this._features[id].properties.taxonomy[i]) {
                            taxonomyIds.push("" + this._features[id].properties.taxonomy[i][j]);
                        }
                    }
                }
            }
            else if (this._features[id].geometry.type === 'Point') {
                if (this._features[id].properties.taxonomy.webmapp_category) {
                    for (var i in this._features[id].properties.taxonomy.webmapp_category) {
                        taxonomyIds.push("" + this._features[id].properties.taxonomy.webmapp_category[i]);
                    }
                }
            }
            else {
                if (this._features[id].properties.taxonomy.activity) {
                    for (var i in this._features[id].properties.taxonomy.activity) {
                        taxonomyIds.push("" + this._features[id].properties.taxonomy.activity[i]);
                    }
                }
            }
            if (taxonomyIds.length > 0) {
                for (var _i = 0, taxonomyIds_3 = taxonomyIds; _i < taxonomyIds_3.length; _i++) {
                    var i = taxonomyIds_3[_i];
                    opacity = this.getTaxonomyFillOpacity(i);
                    if (opacity !== _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_FILL_OPACITY"])
                        break;
                }
            }
        }
        return opacity > 1 ? Math.max(0, Math.min(100, opacity)) / 100 : Math.max(0, Math.min(1, opacity));
    };
    /**
     * Return the stroke width in pixel of the taxonomy
     *
     * @param id the id of the taxonomy
     */
    ModelService.prototype.getTaxonomyStrokeWidth = function (id, defaultWidth) {
        id = "" + id;
        var width = defaultWidth >= 0 ? defaultWidth : _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_TRACK_STROKE_WIDTH"];
        for (var i in this._taxonomies) {
            for (var taxId in this._taxonomies[i]) {
                if (taxId === id) {
                    if (this._taxonomies[i][taxId].strokeWidth)
                        width = this._taxonomies[i][taxId].strokeWidth;
                    else if (this._taxonomies[i][taxId].strokeWidth)
                        width = this.getTaxonomyStrokeWidth(this._taxonomies[i][taxId].parent);
                    break;
                }
            }
            if ((defaultWidth >= 0 && width !== defaultWidth)
                || (typeof defaultWidth === 'undefined' && width !== _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_TRACK_STROKE_WIDTH"]))
                break;
        }
        return width;
    };
    /**
     * Return the stroke width in pixel of the feature
     *
     * @param id the id of the feature
     */
    ModelService.prototype.getFeatureStrokeWidth = function (id) {
        id = "" + id;
        var width = _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_TRACK_STROKE_WIDTH"], defaultWidth = _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_TRACK_STROKE_WIDTH"];
        if (!this._features[id])
            return width;
        else if (['Polygon', 'MultiPolygon'].indexOf(this._features[id].geometry.type) !== -1) {
            width = _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_POLYGON_STROKE_WIDTH"];
            defaultWidth = _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_POLYGON_STROKE_WIDTH"];
        }
        if (this._features[id].properties.strokeWidth)
            width = this._features[id].properties.strokeWidth;
        else if (this._features[id].properties.taxonomy) {
            var taxonomyIds = [];
            if (this._features[id].geometry.type === 'Point' && this._features[id].properties.route) {
                for (var i in this._features[id].properties.taxonomy) {
                    if (i !== 'webmapp_category') {
                        for (var j in this._features[id].properties.taxonomy[i]) {
                            taxonomyIds.push("" + this._features[id].properties.taxonomy[i][j]);
                        }
                    }
                }
            }
            else if (this._features[id].geometry.type === 'Point') {
                if (this._features[id].properties.taxonomy.webmapp_category) {
                    for (var i in this._features[id].properties.taxonomy.webmapp_category) {
                        taxonomyIds.push("" + this._features[id].properties.taxonomy.webmapp_category[i]);
                    }
                }
            }
            else {
                if (this._features[id].properties.taxonomy.activity) {
                    for (var i in this._features[id].properties.taxonomy.activity) {
                        taxonomyIds.push("" + this._features[id].properties.taxonomy.activity[i]);
                    }
                }
            }
            if (taxonomyIds.length > 0) {
                for (var _i = 0, taxonomyIds_4 = taxonomyIds; _i < taxonomyIds_4.length; _i++) {
                    var i = taxonomyIds_4[_i];
                    width = this.getTaxonomyStrokeWidth(i, defaultWidth);
                    if (width !== defaultWidth)
                        break;
                }
            }
        }
        return Math.max(0, Math.round(width));
    };
    /**
     * Return the stroke opacity of the taxonomy
     *
     * @param id the id of the taxonomy
     */
    ModelService.prototype.getTaxonomyStrokeOpacity = function (id) {
        id = "" + id;
        var opacity = _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_STROKE_OPACITY"];
        for (var i in this._taxonomies) {
            for (var taxId in this._taxonomies[i]) {
                if (taxId === id) {
                    if (this._taxonomies[i][taxId].strokeOpacity)
                        opacity = this._taxonomies[i][taxId].strokeOpacity;
                    else if (this._taxonomies[i][taxId].strokeOpacity)
                        opacity = this.getTaxonomyStrokeOpacity(this._taxonomies[i][taxId].parent);
                    break;
                }
            }
            if (opacity !== _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_STROKE_OPACITY"])
                break;
        }
        return opacity > 1 ? Math.max(0, Math.min(100, opacity)) / 100 : Math.max(0, Math.min(1, opacity));
    };
    /**
     * Return the stroke opacity of the feature
     *
     * @param id the id of the feature
     */
    ModelService.prototype.getFeatureStrokeOpacity = function (id) {
        id = "" + id;
        var opacity = _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_STROKE_OPACITY"];
        if (!this._features[id])
            return opacity;
        if (this._features[id].properties.strokeOpacity)
            opacity = this._features[id].properties.strokeOpacity;
        else if (this._features[id].properties.taxonomy) {
            var taxonomyIds = [];
            if (this._features[id].geometry.type === 'Point' && this._features[id].properties.route) {
                for (var i in this._features[id].properties.taxonomy) {
                    if (i !== 'webmapp_category') {
                        for (var j in this._features[id].properties.taxonomy[i]) {
                            taxonomyIds.push("" + this._features[id].properties.taxonomy[i][j]);
                        }
                    }
                }
            }
            else if (this._features[id].geometry.type === 'Point') {
                if (this._features[id].properties.taxonomy.webmapp_category) {
                    for (var i in this._features[id].properties.taxonomy.webmapp_category) {
                        taxonomyIds.push("" + this._features[id].properties.taxonomy.webmapp_category[i]);
                    }
                }
            }
            else {
                if (this._features[id].properties.taxonomy.activity) {
                    for (var i in this._features[id].properties.taxonomy.activity) {
                        taxonomyIds.push("" + this._features[id].properties.taxonomy.activity[i]);
                    }
                }
            }
            if (taxonomyIds.length > 0) {
                for (var _i = 0, taxonomyIds_5 = taxonomyIds; _i < taxonomyIds_5.length; _i++) {
                    var i = taxonomyIds_5[_i];
                    opacity = this.getTaxonomyStrokeOpacity(i);
                    if (opacity !== _constants__WEBPACK_IMPORTED_MODULE_8__["DEF_FEATURE_STROKE_OPACITY"])
                        break;
                }
            }
        }
        return opacity > 1 ? Math.max(0, Math.min(100, opacity)) / 100 : Math.max(0, Math.min(1, opacity));
    };
    /**
     * Return a string with the icon class of the taxonomy
     *
     * @param id the id of the taxonomy
     */
    ModelService.prototype.getTaxonomyIcon = function (id) {
        id = "" + id;
        for (var i in this._taxonomies) {
            for (var taxId in this._taxonomies[i]) {
                if (taxId === id) {
                    if (this._taxonomies[i][taxId].icon)
                        return this._taxonomies[i][taxId].icon;
                    else if (this._taxonomies[i][taxId].parent)
                        return this.getTaxonomyIcon(this._taxonomies[i][taxId].parent);
                    else
                        return '';
                }
            }
        }
        return '';
    };
    /**
     * Return a string with the icon class of the feature
     *
     * @param id the id of the feature
     */
    ModelService.prototype.getFeatureIcon = function (id) {
        id = "" + id;
        if (!this._features[id]) {
            return '';
        }
        var icon = '';
        if (this._features[id].properties.icon)
            icon = this._features[id].properties.icon;
        else {
            if (this._features[id].properties.taxonomy) {
                var taxonomyIds = [];
                for (var i in this._features[id].properties.taxonomy) {
                    for (var j in this._features[id].properties.taxonomy[i]) {
                        taxonomyIds.push("" + this._features[id].properties.taxonomy[i][j]);
                    }
                }
                if (taxonomyIds.length > 0) {
                    for (var _i = 0, taxonomyIds_6 = taxonomyIds; _i < taxonomyIds_6.length; _i++) {
                        var i = taxonomyIds_6[_i];
                        icon = this.getTaxonomyIcon(i);
                        if (icon !== '')
                            break;
                    }
                }
            }
        }
        return icon;
    };
    /**
     * Return a string with the url of the image to use (switching between online and offline)
     *
     * @param id the id of the feature
     */
    ModelService.prototype.getMediaUrl = function (url, type) {
        return url;
    };
    ModelService.prototype.getAudioUrl = function (id) {
        id = '' + id;
        var url = '';
        if (this._features && this._features[id]) {
            if (this._features[id].properties.translations && this._features[id].properties.translations[this._languagesService.getCurrentLang()] && this._features[id].properties.translations[this._languagesService.getCurrentLang()].audio)
                url = this._features[id].properties.translations[this._languagesService.getCurrentLang()].audio;
            else if (this._features[id].properties.translations && this._features[id].properties.translations[this._languagesService.getDefaultLang()] && this._features[id].properties.translations[this._languagesService.getDefaultLang()].audio)
                url = this._features[id].properties.translations[this._languagesService.getDefaultLang()].audio;
            else if (this._features[id].properties.audio)
                url = this._features[id].properties.audio;
        }
        if (url !== '')
            url = this.getMediaUrl(url, 'audio');
        return url;
    };
    /**
     * Return a string with all the taxonomies name concatenated
     *
     * @param id the id of the feature to get the text
     */
    ModelService.prototype.getTaxonomiesText = function (id) {
        id = "" + id;
        if (!this._features[id])
            return '';
        var text = '', feature = this._features[id], categories = [];
        categories.push('webmapp_category');
        categories.push('activity');
        categories.push('theme');
        categories.push('when');
        categories.push('where');
        categories.push('who');
        for (var i in feature.properties.taxonomy) {
            if (categories.indexOf(i) !== -1) {
                for (var j in feature.properties.taxonomy[i]) {
                    var tmp = this.getTaxonomyElement(feature.properties.taxonomy[i][j]);
                    if (tmp) {
                        if (tmp.translations && tmp.translations[this._languagesService.getCurrentLang()] && tmp.translations[this._languagesService.getCurrentLang()].name) {
                            if (text !== "")
                                text += ', ';
                            text += tmp.translations[this._languagesService.getCurrentLang()].name;
                        }
                        else if (tmp.translations && tmp.translations[this._languagesService.getDefaultLang()] && tmp.translations[this._languagesService.getDefaultLang()].name) {
                            if (text !== "")
                                text += ', ';
                            text += tmp.translations[this._languagesService.getDefaultLang()].name;
                        }
                        else if (tmp.name) {
                            if (text !== "")
                                text += ', ';
                            text += tmp.name;
                        }
                    }
                }
            }
        }
        return text;
    };
    /**
     * Given an array of coordinates return the corresponding src for the tile
     *
     * @param coords the coords in [z, x, y]
     * @param baseUrl the baseUrl for the tiles, used if the app is not offline
     */
    ModelService.prototype.getTile = function (coords, baseUrl, id) {
        return new Promise(function (resolve, reject) {
            coords[2] -= 1;
            resolve(baseUrl + coords[0] + '/' + coords[1] + '/' + coords[2] + '.png');
        });
    };
    /**
     * Given an array of coordinates return the corresponding grid json
     *
     * @param coords the coords in [z, x, y]
     * @param baseUrl the baseUrl for the tiles, used if the app is not offline
     * @param overlayId the id of the overlay to locate the grid offline
     */
    ModelService.prototype.getGridJson = function (coords, baseUrl, overlayId) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this._communicationService.get(baseUrl + coords[0] + '/' + coords[1] + '/' + (coords[2] - 1) + '.grid.json')
                .subscribe(function (data) {
                // console.log(data);
                resolve(data);
            }, function (err) {
                reject(err);
            });
        });
    };
    ModelService = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [_communication_service__WEBPACK_IMPORTED_MODULE_3__["CommunicationService"],
            _config_service__WEBPACK_IMPORTED_MODULE_4__["ConfigService"],
            _languages_service__WEBPACK_IMPORTED_MODULE_5__["LanguagesService"]])
    ], ModelService);
    return ModelService;
}());



/***/ }),

/***/ "./src/app/services/router.service.ts":
/*!********************************************!*\
  !*** ./src/app/services/router.service.ts ***!
  \********************************************/
/*! exports provided: RouterService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RouterService", function() { return RouterService; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ "./node_modules/@angular/router/fesm5/router.js");
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! rxjs */ "./node_modules/rxjs/_esm5/index.js");
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! rxjs/operators */ "./node_modules/rxjs/_esm5/operators/index.js");
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};




var RouterService = /** @class */ (function () {
    function RouterService(_router) {
        var _this = this;
        this._router = _router;
        this.onStateChange = new rxjs__WEBPACK_IMPORTED_MODULE_2__["ReplaySubject"](1);
        this.onUrlChange = new rxjs__WEBPACK_IMPORTED_MODULE_2__["ReplaySubject"](1);
        this.onQueryParamsChange = new rxjs__WEBPACK_IMPORTED_MODULE_2__["ReplaySubject"](1);
        this._router.events
            .pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_3__["filter"])(function (event) { return event instanceof _angular_router__WEBPACK_IMPORTED_MODULE_1__["NavigationEnd"]; }))
            .subscribe(function (event) {
            var url = event.urlAfterRedirects.split('?')[0];
            var stateChanged = false;
            if (_this._previousUrl !== url) {
                _this._previousUrl = url;
                _this.onUrlChange.next(event);
                stateChanged = true;
            }
            if (_this._queryParams !== _this._getQueryParams(event.urlAfterRedirects)) {
                _this._queryParams = _this._getQueryParams(event.urlAfterRedirects);
                _this.onQueryParamsChange.next(_this._queryParams);
                stateChanged = true;
            }
            if (stateChanged) {
                _this.onStateChange.next({
                    state: event,
                    params: _this._queryParams
                });
            }
        });
    }
    /**
     * Allow to navigate to other states
     *
     * @param rules the state
     * @param options eventual options
     */
    RouterService.prototype.navigate = function (rules, options) {
        if (!options)
            options = {};
        options.skipLocationChange = true; // force url to not change
        return this._router.navigate(rules, options);
    };
    RouterService.prototype._getQueryParams = function (url) {
        var split = url.split('?'), paramsString = split && split.length === 2 ? split[1] : '', params = {}, paramsArray = paramsString.split('&');
        for (var _i = 0, paramsArray_1 = paramsArray; _i < paramsArray_1.length; _i++) {
            var param = paramsArray_1[_i];
            if (param !== '')
                params[decodeURIComponent(param.split('=')[0])] = decodeURIComponent(param.split('=')[1]);
        }
        return params;
    };
    /**
     * Return the current query params
     */
    RouterService.prototype.getQueryParams = function () {
        return this._queryParams;
    };
    /**
     * Open the system browser and navigate the given url
     *
     * @param url the url to navigate
     */
    RouterService.prototype.openUrl = function (url, self) {
        window.open(url, self ? '_self' : '_system');
    };
    RouterService = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [_angular_router__WEBPACK_IMPORTED_MODULE_1__["Router"]])
    ], RouterService);
    return RouterService;
}());



/***/ }),

/***/ "./src/app/services/storage.service.ts":
/*!*********************************************!*\
  !*** ./src/app/services/storage.service.ts ***!
  \*********************************************/
/*! exports provided: StorageService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "StorageService", function() { return StorageService; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _ionic_storage__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @ionic/storage */ "./node_modules/@ionic/storage/fesm5/ionic-storage.js");
/**
 * Storage Service
 *
 * It provides access to the offline storage for json data
 * */
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};


var StorageService = /** @class */ (function () {
    function StorageService(_storage) {
        var _this = this;
        this._storage = _storage;
        this._ready = false;
        this._storage.ready().then(function () {
            _this._ready = true;
        }, function (err) {
            console.error(err);
        });
    }
    /**
     * Set a value in the storage
     *
     * @param key the key for the value
     * @param value the value to save
     */
    StorageService.prototype._set = function (key, value) {
        var _this = this;
        if (this._ready)
            return this._storage.set(key, value);
        else {
            return new Promise(function (resolve, reject) {
                _this._storage.ready().then(function () {
                    _this._storage.set(key, value).then(function () {
                        _this._ready = true;
                        resolve();
                    }, function () {
                        reject();
                    });
                });
            });
        }
    };
    /**
     * Get the value in the storage linked to the specified key
     *
     * @param key the key of the value to retrieve
     */
    StorageService.prototype._get = function (key) {
        var _this = this;
        if (this._ready)
            return this._storage.get(key);
        else {
            return new Promise(function (resolve, reject) {
                _this._storage.ready().then(function () {
                    _this._storage.get(key).then(function (value) {
                        _this._ready = true;
                        resolve(value);
                    }, function (err) {
                        console.warn(err);
                        reject();
                    });
                }, function (err) {
                    console.warn(err);
                    reject();
                });
            });
        }
    };
    /**
     * Remove the value linked to the key in the storage
     *
     * @param key the key to look for
     */
    StorageService.prototype._remove = function (key) {
        var _this = this;
        if (this._ready)
            return this._storage.remove(key);
        else {
            return new Promise(function (resolve, reject) {
                _this._storage.ready().then(function () {
                    _this._storage.remove(key).then(function () {
                        _this._ready = true;
                        resolve();
                    }, reject);
                });
            });
        }
    };
    StorageService.prototype.setOverlay = function (value, id, routeId) {
        if (routeId)
            return this._set('wm-route_' + routeId + '-overlay_' + id, value);
        else
            return this._set('wm-overlay_' + id, value);
    };
    StorageService.prototype.getOverlay = function (id, routeId) {
        if (routeId)
            return this._get('wm-route_' + routeId + '-overlay_' + id);
        else
            return this._get('wm-overlay_' + id);
    };
    StorageService.prototype.removeOverlay = function (id, routeId) {
        if (routeId)
            return this._remove('wm-route_' + routeId + '-overlay_' + id);
        else
            return this._remove('wm-overlay_' + id);
    };
    StorageService.prototype.setConfig = function (value) {
        return this._set('wm-config_json', value);
    };
    StorageService.prototype.getConfig = function () {
        return this._get('wm-config_json');
    };
    StorageService.prototype.removeConfig = function () {
        return this._remove('wm-config_json');
    };
    StorageService.prototype.setLanguage = function (value) {
        return this._set('wm-lang', value);
    };
    StorageService.prototype.getLanguage = function () {
        return this._get('wm-lang');
    };
    StorageService.prototype.removeLanguage = function () {
        return this._remove('wm-lang');
    };
    StorageService.prototype.setTaxonomy = function (type, value, routeId) {
        if (routeId)
            return this._set('wm-route_' + routeId + '-taxonomy_' + type, value);
        else
            return this._set('wm-taxonomy_' + type, value);
    };
    StorageService.prototype.getTaxonomy = function (type, routeId) {
        if (routeId)
            return this._get('wm-route_' + routeId + '-taxonomy_' + type);
        else
            return this._get('wm-taxonomy_' + type);
    };
    StorageService.prototype.removeTaxonomy = function (type, routeId) {
        if (routeId)
            return this._remove('wm-route_' + routeId + '-taxonomy_' + type);
        else
            return this._remove('wm-taxonomy_' + type);
    };
    StorageService.prototype.setFeature = function (id, value, routeId) {
        if (routeId)
            return this._set('wm-route_' + routeId + '-feature_' + id, value);
        else
            return this._set('wm-feature_' + id, value);
    };
    StorageService.prototype.getFeature = function (id, routeId) {
        if (routeId)
            return this._get('wm-route_' + routeId + '-feature_' + id);
        else
            return this._get('wm-feature_' + id);
    };
    StorageService.prototype.removeFeature = function (id, routeId) {
        if (routeId)
            return this._remove('wm-route_' + routeId + '-feature_' + id);
        else
            return this._remove('wm-feature_' + id);
    };
    StorageService.prototype.setRoute = function (id, value) {
        return this._set('wm-route_' + id, value);
    };
    StorageService.prototype.getRoute = function (id) {
        return this._get('wm-route_' + id);
    };
    StorageService.prototype.removeRoute = function (id) {
        return this._remove('wm-route_' + id);
    };
    StorageService.prototype.setGpsPermissionStatus = function (value) {
        return this._set('wm-gps_permission_status', value);
    };
    StorageService.prototype.getGpsPermissionStatus = function () {
        return this._get('wm-gps_permission_status');
    };
    StorageService.prototype.removeGpsPermissionStatus = function () {
        return this._remove('wm-gps_permission_status');
    };
    StorageService.prototype.setSingleMapStatus = function (value) {
        return this._set('wm-single_map_status', value);
    };
    StorageService.prototype.getSingleMapStatus = function () {
        return this._get('wm-single_map_status');
    };
    StorageService.prototype.removeSingleMapStatus = function () {
        return this._get('wm-single_map_status');
    };
    StorageService.prototype.removeRouteData = function (routeId) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this._storage.keys().then(function (keys) {
                var promises = [];
                for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {
                    var key = keys_1[_i];
                    if (key.indexOf('wm-route_' + routeId) !== -1 && key !== 'wm-route_' + routeId)
                        promises.push(_this._remove(key));
                }
                Promise.all(promises).then(function () {
                    resolve();
                }, function (err) {
                    reject(err);
                });
            });
        });
    };
    StorageService = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [_ionic_storage__WEBPACK_IMPORTED_MODULE_1__["Storage"]])
    ], StorageService);
    return StorageService;
}());



/***/ }),

/***/ "./src/app/services/theme.service.ts":
/*!*******************************************!*\
  !*** ./src/app/services/theme.service.ts ***!
  \*******************************************/
/*! exports provided: ThemeService */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ThemeService", function() { return ThemeService; });
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/common */ "./node_modules/@angular/common/fesm5/common.js");
/* harmony import */ var color__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! color */ "./node_modules/color/index.js");
/* harmony import */ var color__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(color__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _config_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./config.service */ "./src/app/services/config.service.ts");
/**
 * Theme Service
 *
 * It handles the theme of the app. It allow to setup a theme or
 * to change a part of the current theme in use
 *
 * */
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (undefined && undefined.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};




var defaults = {
    primary: '#3880ff',
    secondary: '#0cd1e8',
    tertiary: '#00ffff',
    success: '#10dc60',
    warning: '#ffce00',
    danger: '#f04141',
    dark: '#000000',
    medium: '#989aa2',
    light: '#ffffff',
    fontXxxlg: '28px',
    fontXxlg: '25px',
    fontXlg: '22px',
    fontLg: '20px',
    fontMd: '17px',
    fontSm: '14px',
    fontXsm: '12px',
    fontFamilyHeader: 'Roboto Slab',
    fontFamilyContent: 'Roboto'
};
var ThemeService = /** @class */ (function () {
    function ThemeService(_document, _configService) {
        this._document = _document;
        this._configService = _configService;
        var computedStyle;
        this._style = this._configService.getStyle();
        try {
            this._host = this._document.getElementsByTagName('wm-map-container')[0];
            if (!this._host)
                this._host = this._document.documentElement;
        }
        catch (e) {
            this._host = this._document.documentElement;
        }
        computedStyle = getComputedStyle(this._host);
        if (computedStyle.getPropertyValue('--ion-color-primary'))
            this._style.primary = computedStyle.getPropertyValue('--ion-color-primary').trim();
        if (computedStyle.getPropertyValue('--ion-color-secondary'))
            this._style.secondary = computedStyle.getPropertyValue('--ion-color-secondary').trim();
        if (computedStyle.getPropertyValue('--ion-color-tertiary'))
            this._style.tertiary = computedStyle.getPropertyValue('--ion-color-tertiary').trim();
        if (computedStyle.getPropertyValue('--ion-color-light'))
            this._style.light = computedStyle.getPropertyValue('--ion-color-light').trim();
        if (computedStyle.getPropertyValue('--ion-color-medium'))
            this._style.medium = computedStyle.getPropertyValue('--ion-color-medium').trim();
        if (computedStyle.getPropertyValue('--ion-color-dark'))
            this._style.dark = computedStyle.getPropertyValue('--ion-color-dark').trim();
        if (computedStyle.getPropertyValue('--ion-color-success'))
            this._style.success = computedStyle.getPropertyValue('--ion-color-success').trim();
        if (computedStyle.getPropertyValue('--ion-color-warning'))
            this._style.warning = computedStyle.getPropertyValue('--ion-color-warning').trim();
        if (computedStyle.getPropertyValue('--ion-color-danger'))
            this._style.danger = computedStyle.getPropertyValue('--ion-color-danger').trim();
        if (computedStyle.getPropertyValue('--font-xxxlg'))
            this._style.fontXxxlg = computedStyle.getPropertyValue('--font-xxxlg').trim();
        if (computedStyle.getPropertyValue('--font-xxlg'))
            this._style.fontXxlg = computedStyle.getPropertyValue('--font-xxlg').trim();
        if (computedStyle.getPropertyValue('--font-xlg'))
            this._style.fontXlg = computedStyle.getPropertyValue('--font-xlg').trim();
        if (computedStyle.getPropertyValue('--font-lg'))
            this._style.fontLg = computedStyle.getPropertyValue('--font-lg').trim();
        if (computedStyle.getPropertyValue('--font-md'))
            this._style.fontMd = computedStyle.getPropertyValue('--font-md').trim();
        if (computedStyle.getPropertyValue('--font-sm'))
            this._style.fontSm = computedStyle.getPropertyValue('--font-sm').trim();
        if (computedStyle.getPropertyValue('--font-xsm'))
            this._style.fontXsm = computedStyle.getPropertyValue('--font-xsm').trim();
        if (computedStyle.getPropertyValue('font-family')) {
            this._style.fontFamilyHeader = computedStyle.getPropertyValue('font-family').trim();
            this._style.fontFamilyContent = computedStyle.getPropertyValue('font-family').trim();
        }
        if (computedStyle.getPropertyValue('--font-family-header'))
            this._style.fontFamilyHeader = computedStyle.getPropertyValue('--font-family-header').trim();
        if (computedStyle.getPropertyValue('--font-family-content'))
            this._style.fontFamilyContent = computedStyle.getPropertyValue('--font-family-content').trim();
        this.setTheme(this._style);
    }
    // Override all global variables with a new theme
    ThemeService.prototype.setTheme = function (theme) {
        var cssText = this._CSSTextGenerator(theme);
        this._setGlobalCSS(cssText);
    };
    // Define a single CSS variable
    ThemeService.prototype.setVariable = function (name, value) {
        this._host.style.setProperty(name, value);
    };
    /**
     * Return a contrast color based on the color param
     *
     * @param color the color to get contrast
     * @param ratio the ratio of contrast. Higher value means higher contrast
     */
    ThemeService.prototype.contrast = function (color, ratio) {
        if (ratio === void 0) { ratio = 0.8; }
        if (color === '#000000')
            return '#ffffff';
        if (color === '#ffffff')
            return '#000000';
        color = color__WEBPACK_IMPORTED_MODULE_2__(color);
        return color.isDark() ? color.lighten(ratio).hex() : color.darken(ratio).hex();
    };
    /**
     * Return a darker color based on the color param
     *
     * @param color the color to get the dark version of
     * @param ratio the ratio of dark. Higher value means darker
     */
    ThemeService.prototype.darken = function (color, ratio) {
        if (ratio === void 0) { ratio = 0.8; }
        color = color__WEBPACK_IMPORTED_MODULE_2__(color);
        return color.darken(ratio).hex();
    };
    ThemeService.prototype.lighten = function (color, ratio) {
        if (ratio === void 0) { ratio = 0.8; }
        color = color__WEBPACK_IMPORTED_MODULE_2__(color);
        return color.lighten(ratio).hex();
    };
    ThemeService.prototype.fade = function (color, ratio) {
        if (ratio === void 0) { ratio = 0.8; }
        color = color__WEBPACK_IMPORTED_MODULE_2__(color);
        return color.fade(ratio).hex();
    };
    ThemeService.prototype.getPrimaryColor = function () {
        var color = this._style.primary ? this._style.primary : defaults.primary;
        return color.replace(/ /g, '');
    };
    ThemeService.prototype.getSecondaryColor = function () {
        var color = this._style.secondary ? this._style.secondary : defaults.secondary;
        return color.replace(/ /g, '');
    };
    ThemeService.prototype.getTertiaryColor = function () {
        var color = this._style.tertiary ? this._style.tertiary : defaults.tertiary;
        return color.replace(/ /g, '');
    };
    ThemeService.prototype.getRgb = function (color) {
        var c = color__WEBPACK_IMPORTED_MODULE_2__(color);
        return c.color.join(',');
    };
    ThemeService.prototype.getFontSize = function (type) {
        switch (type.toLowerCase()) {
            case 'xxxlg':
                return parseInt(getComputedStyle(this._host).getPropertyValue('--font-xxxlg').replace(/px/g, ''));
            case 'xxlg':
                return parseInt(getComputedStyle(this._host).getPropertyValue('--font-xxlg').replace(/px/g, ''));
            case 'xlg':
                return parseInt(getComputedStyle(this._host).getPropertyValue('--font-xlg').replace(/px/g, ''));
            case 'lg':
                return parseInt(getComputedStyle(this._host).getPropertyValue('--font-lg').replace(/px/g, ''));
            case 'md':
            default:
                return parseInt(getComputedStyle(this._host).getPropertyValue('--font-md').replace(/px/g, ''));
            case 'sm':
                return parseInt(getComputedStyle(this._host).getPropertyValue('--font-sm').replace(/px/g, ''));
            case 'xsm':
                return parseInt(getComputedStyle(this._host).getPropertyValue('--font-xsm').replace(/px/g, ''));
        }
    };
    ThemeService.prototype._setGlobalCSS = function (css) {
        for (var i in css) {
            this._host.style.setProperty(css[i][0], css[i][1]);
        }
    };
    ThemeService.prototype._CSSTextGenerator = function (colors) {
        colors = __assign({}, defaults, colors);
        var primary = colors.primary, secondary = colors.secondary, tertiary = colors.tertiary, success = colors.success, warning = colors.warning, danger = colors.danger, dark = colors.dark, medium = colors.medium, light = colors.light, fontXxxlg = colors.fontXxxlg, fontXxlg = colors.fontXxlg, fontXlg = colors.fontXlg, fontLg = colors.fontLg, fontMd = colors.fontMd, fontSm = colors.fontSm, fontXsm = colors.fontXsm, fontFamilyHeader = colors.fontFamilyHeader, fontFamilyContent = colors.fontFamilyContent;
        var shadeRatio = 0.1;
        var tintRatio = 0.1;
        return [
            ['--ion-color-base', light],
            ['--ion-color-contrast', dark],
            ['--ion-background-color', light],
            ['--ion-text-color', dark],
            ['--ion-toolbar-background-color', this.contrast(light, 0.1)],
            ['--ion-toolbar-text-color', this.contrast(dark, 0.1)],
            ['--ion-item-background-color', this.contrast(light, 0.3)],
            ['--ion-item-text-color', this.contrast(dark, 0.3)],
            ['--ion-color-primary', primary],
            ['--ion-color-primary-rgb', color__WEBPACK_IMPORTED_MODULE_2__(primary).array().toString()],
            ['--ion-color-primary-contrast', this.contrast(primary)],
            ['--ion-color-primary-contrast-rgb', color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(primary)).array().toString()],
            ['--ion-color-primary-shade', color__WEBPACK_IMPORTED_MODULE_2__(primary).darken(shadeRatio)],
            ['--ion-color-primary-tint', color__WEBPACK_IMPORTED_MODULE_2__(primary).lighten(tintRatio)],
            ['--ion-color-secondary', secondary],
            ['--ion-color-secondary-rgb', color__WEBPACK_IMPORTED_MODULE_2__(secondary).array().toString()],
            ['--ion-color-secondary-contrast', this.contrast(secondary)],
            ['--ion-color-secondary-contrast-rgb', color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(secondary)).array().toString()],
            ['--ion-color-secondary-shade', color__WEBPACK_IMPORTED_MODULE_2__(secondary).darken(shadeRatio)],
            ['--ion-color-secondary-tint', color__WEBPACK_IMPORTED_MODULE_2__(secondary).lighten(tintRatio)],
            ['--ion-color-tertiary', tertiary],
            ['--ion-color-tertiary-rgb', color__WEBPACK_IMPORTED_MODULE_2__(tertiary).array().toString()],
            ['--ion-color-tertiary-contrast', this.contrast(tertiary)],
            ['--ion-color-tertiary-contrast-rgb', color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(tertiary)).array().toString()],
            ['--ion-color-tertiary-shade', color__WEBPACK_IMPORTED_MODULE_2__(tertiary).darken(shadeRatio)],
            ['--ion-color-tertiary-tint', color__WEBPACK_IMPORTED_MODULE_2__(tertiary).lighten(tintRatio)],
            ['--ion-color-success', success],
            ['--ion-color-success-rgb', color__WEBPACK_IMPORTED_MODULE_2__(success).array().toString()],
            ['--ion-color-success-contrast', this.contrast(success)],
            ['--ion-color-success-contrast-rgb', color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(success)).array().toString()],
            ['--ion-color-success-shade', color__WEBPACK_IMPORTED_MODULE_2__(success).darken(shadeRatio)],
            ['--ion-color-success-tint', color__WEBPACK_IMPORTED_MODULE_2__(success).lighten(tintRatio)],
            ['--ion-color-warning', warning],
            ['--ion-color-warning-rgb', color__WEBPACK_IMPORTED_MODULE_2__(warning).array().toString()],
            ['--ion-color-warning-contrast', this.contrast(warning)],
            ['--ion-color-warning-contrast-rgb', color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(warning)).array().toString()],
            ['--ion-color-warning-shade', color__WEBPACK_IMPORTED_MODULE_2__(warning).darken(shadeRatio)],
            ['--ion-color-warning-tint', color__WEBPACK_IMPORTED_MODULE_2__(warning).lighten(tintRatio)],
            ['--ion-color-danger', danger],
            ['--ion-color-danger-rgb', color__WEBPACK_IMPORTED_MODULE_2__(danger).array().toString()],
            ['--ion-color-danger-contrast', this.contrast(danger)],
            ['--ion-color-danger-contrast-rgb', color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(danger)).array().toString()],
            ['--ion-color-danger-shade', color__WEBPACK_IMPORTED_MODULE_2__(danger).darken(shadeRatio)],
            ['--ion-color-danger-tint', color__WEBPACK_IMPORTED_MODULE_2__(danger).lighten(tintRatio)],
            ['--ion-color-dark', dark],
            ['--ion-color-dark-rgb', color__WEBPACK_IMPORTED_MODULE_2__(dark).array().toString()],
            ['--ion-color-dark-contrast', this.contrast(dark)],
            ['--ion-color-dark-contrast-rgb', color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(dark)).array().toString()],
            ['--ion-color-dark-shade', color__WEBPACK_IMPORTED_MODULE_2__(dark).darken(shadeRatio)],
            ['--ion-color-dark-tint', color__WEBPACK_IMPORTED_MODULE_2__(dark).lighten(tintRatio)],
            ['--ion-color-medium', medium],
            ['--ion-color-medium-rgb', color__WEBPACK_IMPORTED_MODULE_2__(medium).array().toString()],
            ['--ion-color-medium-contrast', this.contrast(medium)],
            ['--ion-color-medium-contrast-rgb', color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(medium)).array().toString()],
            ['--ion-color-medium-shade', color__WEBPACK_IMPORTED_MODULE_2__(medium).darken(shadeRatio)],
            ['--ion-color-medium-tint', color__WEBPACK_IMPORTED_MODULE_2__(medium).lighten(tintRatio)],
            ['--ion-color-light', light],
            ['--ion-color-light-rgb', color__WEBPACK_IMPORTED_MODULE_2__(light).array().toString()],
            ['--ion-color-light-contrast', this.contrast(light)],
            ['--ion-color-light-contrast-rgb', color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(light)).array().toString()],
            ['--ion-color-light-shade', color__WEBPACK_IMPORTED_MODULE_2__(light).darken(shadeRatio)],
            ['--ion-color-light-tint', color__WEBPACK_IMPORTED_MODULE_2__(light).lighten(tintRatio)],
            ['--font-xxxlg', fontXxxlg],
            ['--font-xxlg', fontXxlg],
            ['--font-xlg', fontXlg],
            ['--font-lg', fontLg],
            ['--font-md', fontMd],
            ['--font-sm', fontSm],
            ['--font-xsm', fontXsm],
            ['--font-family-header', fontFamilyHeader],
            ['--font-family-content', fontFamilyContent]
        ];
    };
    ThemeService.prototype._getCSSVariables = function (colors) {
        colors = __assign({}, defaults, colors);
        var primary = colors.primary, secondary = colors.secondary, tertiary = colors.tertiary, success = colors.success, warning = colors.warning, danger = colors.danger, dark = colors.dark, medium = colors.medium, light = colors.light, fontXxxlg = colors.fontXxxlg, fontXxlg = colors.fontXxlg, fontXlg = colors.fontXlg, fontLg = colors.fontLg, fontMd = colors.fontMd, fontSm = colors.fontSm, fontXsm = colors.fontXsm, fontFamilyHeader = colors.fontFamilyHeader, fontFamilyContent = colors.fontFamilyContent;
        var shadeRatio = 0.1;
        var tintRatio = 0.1;
        return {
            '--ion-color-base': light,
            '--ion-color-contrast': dark,
            '--ion-background-color': light,
            '--ion-text-color': dark,
            '--ion-toolbar-background-color': this.contrast(light, 0.1),
            '--ion-toolbar-text-color': this.contrast(dark, 0.1),
            '--ion-item-background-color': this.contrast(light, 0.3),
            '--ion-item-text-color': this.contrast(dark, 0.3),
            '--ion-color-primary': primary,
            '--ion-color-primary-rgb': color__WEBPACK_IMPORTED_MODULE_2__(primary).array().toString(),
            '--ion-color-primary-contrast': this.contrast(primary),
            '--ion-color-primary-contrast-rgb': color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(primary)).array().toString(),
            '--ion-color-primary-shade': color__WEBPACK_IMPORTED_MODULE_2__(primary).darken(shadeRatio),
            '--ion-color-primary-tint': color__WEBPACK_IMPORTED_MODULE_2__(primary).lighten(tintRatio),
            '--ion-color-secondary': secondary,
            '--ion-color-secondary-rgb': color__WEBPACK_IMPORTED_MODULE_2__(secondary).array().toString(),
            '--ion-color-secondary-contrast': this.contrast(secondary),
            '--ion-color-secondary-contrast-rgb': color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(secondary)).array().toString(),
            '--ion-color-secondary-shade': color__WEBPACK_IMPORTED_MODULE_2__(secondary).darken(shadeRatio),
            '--ion-color-secondary-tint': color__WEBPACK_IMPORTED_MODULE_2__(secondary).lighten(tintRatio),
            '--ion-color-tertiary': tertiary,
            '--ion-color-tertiary-rgb': color__WEBPACK_IMPORTED_MODULE_2__(tertiary).array().toString(),
            '--ion-color-tertiary-contrast': this.contrast(tertiary),
            '--ion-color-tertiary-contrast-rgb': color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(tertiary)).array().toString(),
            '--ion-color-tertiary-shade': color__WEBPACK_IMPORTED_MODULE_2__(tertiary).darken(shadeRatio),
            '--ion-color-tertiary-tint': color__WEBPACK_IMPORTED_MODULE_2__(tertiary).lighten(tintRatio),
            '--ion-color-success': success,
            '--ion-color-success-rgb': color__WEBPACK_IMPORTED_MODULE_2__(success).array().toString(),
            '--ion-color-success-contrast': this.contrast(success),
            '--ion-color-success-contrast-rgb': color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(success)).array().toString(),
            '--ion-color-success-shade': color__WEBPACK_IMPORTED_MODULE_2__(success).darken(shadeRatio),
            '--ion-color-success-tint': color__WEBPACK_IMPORTED_MODULE_2__(success).lighten(tintRatio),
            '--ion-color-warning': warning,
            '--ion-color-warning-rgb': color__WEBPACK_IMPORTED_MODULE_2__(warning).array().toString(),
            '--ion-color-warning-contrast': this.contrast(warning),
            '--ion-color-warning-contrast-rgb': color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(warning)).array().toString(),
            '--ion-color-warning-shade': color__WEBPACK_IMPORTED_MODULE_2__(warning).darken(shadeRatio),
            '--ion-color-warning-tint': color__WEBPACK_IMPORTED_MODULE_2__(warning).lighten(tintRatio),
            '--ion-color-danger': danger,
            '--ion-color-danger-rgb': color__WEBPACK_IMPORTED_MODULE_2__(danger).array().toString(),
            '--ion-color-danger-contrast': this.contrast(danger),
            '--ion-color-danger-contrast-rgb': color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(danger)).array().toString(),
            '--ion-color-danger-shade': color__WEBPACK_IMPORTED_MODULE_2__(danger).darken(shadeRatio),
            '--ion-color-danger-tint': color__WEBPACK_IMPORTED_MODULE_2__(danger).lighten(tintRatio),
            '--ion-color-dark': dark,
            '--ion-color-dark-rgb': color__WEBPACK_IMPORTED_MODULE_2__(dark).array().toString(),
            '--ion-color-dark-contrast': this.contrast(dark),
            '--ion-color-dark-contrast-rgb': color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(dark)).array().toString(),
            '--ion-color-dark-shade': color__WEBPACK_IMPORTED_MODULE_2__(dark).darken(shadeRatio),
            '--ion-color-dark-tint': color__WEBPACK_IMPORTED_MODULE_2__(dark).lighten(tintRatio),
            '--ion-color-medium': medium,
            '--ion-color-medium-rgb': color__WEBPACK_IMPORTED_MODULE_2__(medium).array().toString(),
            '--ion-color-medium-contrast': this.contrast(medium),
            '--ion-color-medium-contrast-rgb': color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(medium)).array().toString(),
            '--ion-color-medium-shade': color__WEBPACK_IMPORTED_MODULE_2__(medium).darken(shadeRatio),
            '--ion-color-medium-tint': color__WEBPACK_IMPORTED_MODULE_2__(medium).lighten(tintRatio),
            '--ion-color-light': light,
            '--ion-color-light-rgb': color__WEBPACK_IMPORTED_MODULE_2__(light).array().toString(),
            '--ion-color-light-contrast': this.contrast(light),
            '--ion-color-light-contrast-rgb': color__WEBPACK_IMPORTED_MODULE_2__(this.contrast(light)).array().toString(),
            '--ion-color-light-shade': color__WEBPACK_IMPORTED_MODULE_2__(light).darken(shadeRatio),
            '--ion-color-light-tint': color__WEBPACK_IMPORTED_MODULE_2__(light).lighten(tintRatio),
            '--font-xxxlg': fontXxxlg,
            '--font-xxlg': fontXxlg,
            '--font-xlg': fontXlg,
            '--font-lg': fontLg,
            '--font-md': fontMd,
            '--font-sm': fontSm,
            '--font-xsm': fontXsm,
            '--font-family-header': fontFamilyHeader,
            '--font-family-content': fontFamilyContent
        };
    };
    ThemeService = __decorate([
        Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Injectable"])({
            providedIn: 'root'
        }),
        __param(0, Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["Inject"])(_angular_common__WEBPACK_IMPORTED_MODULE_1__["DOCUMENT"])),
        __metadata("design:paramtypes", [Document,
            _config_service__WEBPACK_IMPORTED_MODULE_3__["ConfigService"]])
    ], ThemeService);
    return ThemeService;
}());



/***/ }),

/***/ "./src/environments/environment.ts":
/*!*****************************************!*\
  !*** ./src/environments/environment.ts ***!
  \*****************************************/
/*! exports provided: environment */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "environment", function() { return environment; });
// This file can be replaced during build by using the `fileReplacements` array.
// `ng build --prod` replaces `environment.ts` with `environment.prod.ts`.
// The list of file replacements can be found in `angular.json`.
var environment = {
    production: false
};
/*
 * For easier debugging in development mode, you can import the following file
 * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.
 *
 * This import should be commented out in production mode because it will have a negative impact
 * on performance if an error is thrown.
 */
// import 'zone.js/dist/zone-error';  // Included with Angular CLI.


/***/ }),

/***/ "./src/main.ts":
/*!*********************!*\
  !*** ./src/main.ts ***!
  \*********************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ "./node_modules/@angular/core/fesm5/core.js");
/* harmony import */ var _angular_platform_browser_dynamic__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/platform-browser-dynamic */ "./node_modules/@angular/platform-browser-dynamic/fesm5/platform-browser-dynamic.js");
/* harmony import */ var _app_app_module__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./app/app.module */ "./src/app/app.module.ts");
/* harmony import */ var _environments_environment__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./environments/environment */ "./src/environments/environment.ts");




if (_environments_environment__WEBPACK_IMPORTED_MODULE_3__["environment"].production) {
    Object(_angular_core__WEBPACK_IMPORTED_MODULE_0__["enableProdMode"])();
}
Object(_angular_platform_browser_dynamic__WEBPACK_IMPORTED_MODULE_1__["platformBrowserDynamic"])().bootstrapModule(_app_app_module__WEBPACK_IMPORTED_MODULE_2__["AppModule"])
    .catch(function (err) { return console.log(err); });


/***/ }),

/***/ "./version.json":
/*!**********************!*\
  !*** ./version.json ***!
  \**********************/
/*! exports provided: version, default */
/***/ (function(module) {

module.exports = {"version":"1.6.9"};

/***/ }),

/***/ 0:
/*!***************************!*\
  !*** multi ./src/main.ts ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(/*! /Users/dvdpzzt/Documents/elbrus-app/core/src/main.ts */"./src/main.ts");


/***/ })

},[[0,"runtime","vendor"]]]);
//# sourceMappingURL=main.js.map